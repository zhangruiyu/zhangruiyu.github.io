<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>My New Post | å¼ å¤§å¤´çš„åšå®¢ | ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="sql,java">
    <meta name="description" content="BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£  ä½œè€…: é—²å¤§èµ‹,Gavin.King,Sue,Zhoupan,woate,Darren ç¤¾åŒº http://ibeetl.com qqç¾¤ 219324263 å½“å‰ç‰ˆæœ¬ 2.8.9   1. BeetlSQL ç‰¹ç‚¹BeetSqlæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½DAOå·¥å…·ï¼Œ åŒæ—¶å…·æœ‰Hibernate ä¼˜ç‚¹ &amp;amp; Mybatisä¼˜ç‚¹åŠŸèƒ½ï¼Œé€‚ç”¨äºæ‰¿è®¤ä»¥SQLä¸ºä¸­å¿ƒï¼ŒåŒæ—¶åˆéœ€æ±‚å·¥å…·èƒ½è‡ª">
<meta name="keywords" content="sql,java">
<meta property="og:type" content="article">
<meta property="og:title" content="My New Post">
<meta property="og:url" content="http://yoursite.com/2017/04/19/beetlsql/index.html">
<meta property="og:site_name" content="å¼ å¤§å¤´çš„åšå®¢">
<meta property="og:description" content="BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£  ä½œè€…: é—²å¤§èµ‹,Gavin.King,Sue,Zhoupan,woate,Darren ç¤¾åŒº http://ibeetl.com qqç¾¤ 219324263 å½“å‰ç‰ˆæœ¬ 2.8.9   1. BeetlSQL ç‰¹ç‚¹BeetSqlæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½DAOå·¥å…·ï¼Œ åŒæ—¶å…·æœ‰Hibernate ä¼˜ç‚¹ &amp;amp; Mybatisä¼˜ç‚¹åŠŸèƒ½ï¼Œé€‚ç”¨äºæ‰¿è®¤ä»¥SQLä¸ºä¸­å¿ƒï¼ŒåŒæ—¶åˆéœ€æ±‚å·¥å…·èƒ½è‡ª">
<meta property="og:image" content="http://yoursite.com/2017/04/19/beetlsql/static/beetlsql1.png">
<meta property="og:updated_time" content="2017-04-19T12:55:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My New Post">
<meta name="twitter:description" content="BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£  ä½œè€…: é—²å¤§èµ‹,Gavin.King,Sue,Zhoupan,woate,Darren ç¤¾åŒº http://ibeetl.com qqç¾¤ 219324263 å½“å‰ç‰ˆæœ¬ 2.8.9   1. BeetlSQL ç‰¹ç‚¹BeetSqlæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½DAOå·¥å…·ï¼Œ åŒæ—¶å…·æœ‰Hibernate ä¼˜ç‚¹ &amp;amp; Mybatisä¼˜ç‚¹åŠŸèƒ½ï¼Œé€‚ç”¨äºæ‰¿è®¤ä»¥SQLä¸ºä¸­å¿ƒï¼ŒåŒæ—¶åˆéœ€æ±‚å·¥å…·èƒ½è‡ª">
<meta name="twitter:image" content="http://yoursite.com/2017/04/19/beetlsql/static/beetlsql1.png">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">å¼ ç‘å®‡</h5>
          <a href="mailto:634206017@qq.com" title="634206017@qq.com" class="mail">634206017@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                ä¸»é¡µ
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/yscoder" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/ysweb" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/custom"  >
                <i class="icon icon-lg icon-link"></i>
                æµ‹è¯•
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">My New Post</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="è¾“å…¥æ„Ÿå…´è¶£çš„å…³é”®å­—">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">My New Post</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-04-19T12:03:55.000Z" itemprop="datePublished" class="page-time">
  2017-04-19
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#BeetlSQL2-8ä¸­æ–‡æ–‡æ¡£"><span class="post-toc-number">1.</span> <span class="post-toc-text">BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-BeetlSQL-ç‰¹ç‚¹"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1. BeetlSQL ç‰¹ç‚¹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-5åˆ†é’Ÿä¾‹å­"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2. 5åˆ†é’Ÿä¾‹å­</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-å®‰è£…"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">2.1. å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-å‡†å¤‡å·¥ä½œ"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">2.2. å‡†å¤‡å·¥ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-ä»£ç ä¾‹å­"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">2.3. ä»£ç ä¾‹å­</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-SQLæ–‡ä»¶ä¾‹å­"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">2.4. SQLæ–‡ä»¶ä¾‹å­</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-5-ä»£ç -amp-sqlç”Ÿæˆ"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">2.5. ä»£ç &sqlç”Ÿæˆ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„"><span class="post-toc-number">1.2.6.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-1"><span class="post-toc-number">1.2.7.</span> <span class="post-toc-text">æ³¨æ„</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-BeetlSQL-è¯´æ˜"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3. BeetlSQL è¯´æ˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-è·å¾—SQLManager"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">3.1. è·å¾—SQLManager</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-æŸ¥è¯¢API"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">3.2. æŸ¥è¯¢API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-1-æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰"><span class="post-toc-number">1.3.2.1.</span> <span class="post-toc-text">3.2.1. æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-2-é€šè¿‡sqlidæŸ¥è¯¢-sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ"><span class="post-toc-number">1.3.2.2.</span> <span class="post-toc-text">3.2.2. é€šè¿‡sqlidæŸ¥è¯¢,sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-ç¿»é¡µæŸ¥è¯¢API"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">3.3. ç¿»é¡µæŸ¥è¯¢API</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è·¨æ•°æ®åº“æ”¯æŒ"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">è·¨æ•°æ®åº“æ”¯æŒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4-æ›´æ–°API"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">3.4. æ›´æ–°API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-4-1-è‡ªåŠ¨ç”Ÿæˆsql"><span class="post-toc-number">1.3.5.1.</span> <span class="post-toc-text">3.4.1. è‡ªåŠ¨ç”Ÿæˆsql</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-4-2-é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰"><span class="post-toc-number">1.3.5.2.</span> <span class="post-toc-text">3.4.2. é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-5-ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿"><span class="post-toc-number">1.3.6.</span> <span class="post-toc-text">3.5. ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-5-1-ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥"><span class="post-toc-number">1.3.6.1.</span> <span class="post-toc-text">3.5.1. ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-5-2-ç›´æ¥æ‰§è¡ŒJDBC-sqlè¯­å¥"><span class="post-toc-number">1.3.7.</span> <span class="post-toc-text">3.5.2. ç›´æ¥æ‰§è¡ŒJDBC sqlè¯­å¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-6-å…¶ä»–"><span class="post-toc-number">1.3.8.</span> <span class="post-toc-text">3.6. å…¶ä»–</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-6-1-å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»"><span class="post-toc-number">1.3.8.1.</span> <span class="post-toc-text">3.6.1. å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-6-2-ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ"><span class="post-toc-number">1.3.8.2.</span> <span class="post-toc-text">3.6.2. ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è­¦å‘Š"><span class="post-toc-number">1.3.9.</span> <span class="post-toc-text">è­¦å‘Š</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4. å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-å¤åˆä¸»é”®"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5. å¤åˆä¸»é”®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-ä½¿ç”¨Mapper"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">6. ä½¿ç”¨Mapper</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-BeetlSQL-Annotation"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">7. BeetlSQL Annotation</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-1-AutoID-å’Œ-AssignID-ï¼Œ-SeqID"><span class="post-toc-number">1.7.1.</span> <span class="post-toc-text">7.1. @AutoID å’Œ @AssignID ï¼Œ@SeqID</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å¤‡æ³¨"><span class="post-toc-number">1.7.2.</span> <span class="post-toc-text">å¤‡æ³¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-2-Tail"><span class="post-toc-number">1.7.3.</span> <span class="post-toc-text">7.2. @Tail</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-3-ColumnIgnore"><span class="post-toc-number">1.7.4.</span> <span class="post-toc-text">7.3. @ColumnIgnore</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-4-EnumMapping"><span class="post-toc-number">1.7.5.</span> <span class="post-toc-text">7.4. @EnumMapping</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-5-Table"><span class="post-toc-number">1.7.6.</span> <span class="post-toc-text">7.5. @Table</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-6-TableTemplate"><span class="post-toc-number">1.7.7.</span> <span class="post-toc-text">7.6. @TableTemplate</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-2"><span class="post-toc-number">1.7.8.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-7-Mapperç›¸å…³æ³¨è§£"><span class="post-toc-number">1.7.9.</span> <span class="post-toc-text">7.7. Mapperç›¸å…³æ³¨è§£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-8-ORMQuery"><span class="post-toc-number">1.7.10.</span> <span class="post-toc-text">7.8. ORMQuery</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8-BeetlSQL-æ•°æ®æ¨¡å‹"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">8. BeetlSQL æ•°æ®æ¨¡å‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#9-Markdownæ–¹å¼ç®¡ç†"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">9. Markdownæ–¹å¼ç®¡ç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨"><span class="post-toc-number">1.9.1.</span> <span class="post-toc-text">æ³¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10-SQL-æ³¨é‡Š"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">10. SQL æ³¨é‡Š</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#11-é‡è¦-é…ç½®beetlsql"><span class="post-toc-number">1.11.</span> <span class="post-toc-text">11. (é‡è¦) é…ç½®beetlsql</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-1-å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼"><span class="post-toc-number">1.11.1.</span> <span class="post-toc-text">11.1. å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-2-NameConversion"><span class="post-toc-number">1.11.2.</span> <span class="post-toc-text">11.2. NameConversion</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-3-æ¨¡æ¿å­—ç¬¦é›†"><span class="post-toc-number">1.11.3.</span> <span class="post-toc-text">11.3. æ¨¡æ¿å­—ç¬¦é›†</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-4-ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1"><span class="post-toc-number">1.11.4.</span> <span class="post-toc-text">11.4. ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-5-è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°"><span class="post-toc-number">1.11.5.</span> <span class="post-toc-text">11.5. è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-6-isEmpty-å’Œ-isNotEmpty"><span class="post-toc-number">1.11.6.</span> <span class="post-toc-text">11.6. isEmpty å’Œ isNotEmpty</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#12-SQL-æ¨¡æ¿åŸºäºBeetlå®ç°"><span class="post-toc-number">1.12.</span> <span class="post-toc-text">12. SQL æ¨¡æ¿åŸºäºBeetlå®ç°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#13-Beetl-å…¥é—¨"><span class="post-toc-number">1.13.</span> <span class="post-toc-text">13. Beetl å…¥é—¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-1-å®šç•Œç¬¦å·"><span class="post-toc-number">1.13.1.</span> <span class="post-toc-text">13.1. å®šç•Œç¬¦å·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-2-å˜é‡"><span class="post-toc-number">1.13.2.</span> <span class="post-toc-text">13.2. å˜é‡</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-3-ç®—æ•°è¡¨è¾¾å¼"><span class="post-toc-number">1.13.3.</span> <span class="post-toc-text">13.3. ç®—æ•°è¡¨è¾¾å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-4-é€»è¾‘è¡¨è¾¾å¼"><span class="post-toc-number">1.13.4.</span> <span class="post-toc-text">13.4. é€»è¾‘è¡¨è¾¾å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-5-æ§åˆ¶è¯­å¥"><span class="post-toc-number">1.13.5.</span> <span class="post-toc-text">13.5. æ§åˆ¶è¯­å¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-3"><span class="post-toc-number">1.13.6.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-6-è®¿é—®å˜é‡å±æ€§"><span class="post-toc-number">1.13.7.</span> <span class="post-toc-text">13.6. è®¿é—®å˜é‡å±æ€§</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-7-åˆ¤æ–­å¯¹è±¡éç©ºç©º"><span class="post-toc-number">1.13.8.</span> <span class="post-toc-text">13.7. åˆ¤æ–­å¯¹è±¡éç©ºç©º</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-8-è°ƒç”¨æ–¹æ³•"><span class="post-toc-number">1.13.9.</span> <span class="post-toc-text">13.8. è°ƒç”¨æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-9-è‡ªå®šä¹‰æ–¹æ³•"><span class="post-toc-number">1.13.10.</span> <span class="post-toc-text">13.9. è‡ªå®šä¹‰æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-10-å†…ç½®æ–¹æ³•"><span class="post-toc-number">1.13.11.</span> <span class="post-toc-text">13.10. å†…ç½®æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-11-æ ‡ç­¾åŠŸèƒ½"><span class="post-toc-number">1.13.12.</span> <span class="post-toc-text">13.11. æ ‡ç­¾åŠŸèƒ½</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#14-DebugåŠŸèƒ½"><span class="post-toc-number">1.14.</span> <span class="post-toc-text">14. DebugåŠŸèƒ½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#15-ç¼“å­˜åŠŸèƒ½"><span class="post-toc-number">1.15.</span> <span class="post-toc-text">15. ç¼“å­˜åŠŸèƒ½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#16-InterceptoråŠŸèƒ½"><span class="post-toc-number">1.16.</span> <span class="post-toc-text">16. InterceptoråŠŸèƒ½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#17-å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“"><span class="post-toc-number">1.17.</span> <span class="post-toc-text">17. å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#18-å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘"><span class="post-toc-number">1.18.</span> <span class="post-toc-text">18. å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-4"><span class="post-toc-number">1.18.1.</span> <span class="post-toc-text">æ³¨æ„</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#19-è·¨æ•°æ®åº“å¹³å°"><span class="post-toc-number">1.19.</span> <span class="post-toc-text">19. è·¨æ•°æ®åº“å¹³å°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#20-ä»£ç ç”Ÿæˆ"><span class="post-toc-number">1.20.</span> <span class="post-toc-text">20. ä»£ç ç”Ÿæˆ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#20-1-ç”Ÿæˆpojo-å’Œ-mdæ–‡ä»¶"><span class="post-toc-number">1.20.1.</span> <span class="post-toc-text">20.1. ç”Ÿæˆpojo å’Œ mdæ–‡ä»¶</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#20-2-ç”Ÿæˆæ›´å¤šçš„ä»£ç "><span class="post-toc-number">1.20.2.</span> <span class="post-toc-text">20.2. ç”Ÿæˆæ›´å¤šçš„ä»£ç </span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#21-ç›´æ¥ä½¿ç”¨SQLResult"><span class="post-toc-number">1.21.</span> <span class="post-toc-text">21. ç›´æ¥ä½¿ç”¨SQLResult</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#22-Hibernate-MyBatis-BeetlSQL-å¯¹æ¯”"><span class="post-toc-number">1.22.</span> <span class="post-toc-text">22. Hibernate,MyBatis,BeetlSQL å¯¹æ¯”</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#23-ORM"><span class="post-toc-number">1.23.</span> <span class="post-toc-text">23. ORM</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-5"><span class="post-toc-number">1.23.1.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#23-1-sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢"><span class="post-toc-number">1.23.2.</span> <span class="post-toc-text">23.1. sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-6"><span class="post-toc-number">1.23.3.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#23-2-ORM-æ³¨è§£"><span class="post-toc-number">1.23.4.</span> <span class="post-toc-text">23.2. ORM æ³¨è§£</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#24-é›†æˆå’ŒDemo"><span class="post-toc-number">1.24.</span> <span class="post-toc-text">24. é›†æˆå’ŒDemo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#24-1-Springé›†æˆå’ŒDemo"><span class="post-toc-number">1.24.1.</span> <span class="post-toc-text">24.1. Springé›†æˆå’ŒDemo</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å‚è€ƒ"><span class="post-toc-number">1.24.2.</span> <span class="post-toc-text">å‚è€ƒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#24-2-SpringBooté›†æˆ"><span class="post-toc-number">1.24.3.</span> <span class="post-toc-text">24.2. SpringBooté›†æˆ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#24-3-JFinalé›†æˆå’ŒDemo"><span class="post-toc-number">1.24.4.</span> <span class="post-toc-text">24.3. JFinalé›†æˆå’ŒDemo</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ³¨æ„-7"><span class="post-toc-number">1.24.5.</span> <span class="post-toc-text">æ³¨æ„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å‚è€ƒ-1"><span class="post-toc-number">1.24.6.</span> <span class="post-toc-text">å‚è€ƒ</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#25-é«˜çº§éƒ¨åˆ†"><span class="post-toc-number">1.25.</span> <span class="post-toc-text">25. é«˜çº§éƒ¨åˆ†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-1-ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–"><span class="post-toc-number">1.25.1.</span> <span class="post-toc-text">25.1. ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-2-ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–"><span class="post-toc-number">1.25.2.</span> <span class="post-toc-text">25.2. ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-3-PreparedStatment"><span class="post-toc-number">1.25.3.</span> <span class="post-toc-text">25.3. PreparedStatment</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-4-è‡ªå®šä¹‰BeanProcessor"><span class="post-toc-number">1.25.4.</span> <span class="post-toc-text">25.4. è‡ªå®šä¹‰BeanProcessor</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-5-äº‹åŠ¡ç®¡ç†"><span class="post-toc-number">1.25.5.</span> <span class="post-toc-text">25.5. äº‹åŠ¡ç®¡ç†</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-beetlsql"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">My New Post</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-04-19 20:03:55" datetime="2017-04-19T12:03:55.000Z"  itemprop="datePublished">2017-04-19</time>

            


            
<span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="BeetlSQL2-8ä¸­æ–‡æ–‡æ¡£"><a href="#BeetlSQL2-8ä¸­æ–‡æ–‡æ¡£" class="headerlink" title="BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£"></a>BeetlSQL2.8ä¸­æ–‡æ–‡æ¡£</h2><blockquote>
<ul>
<li>ä½œè€…: é—²å¤§èµ‹,Gavin.King,Sue,Zhoupan,woate,Darren</li>
<li>ç¤¾åŒº <a href="http://ibeetl.com/" target="_blank" rel="external">http://ibeetl.com</a></li>
<li>qqç¾¤ 219324263</li>
<li>å½“å‰ç‰ˆæœ¬ 2.8.9</li>
</ul>
</blockquote>
<h3 id="1-BeetlSQL-ç‰¹ç‚¹"><a href="#1-BeetlSQL-ç‰¹ç‚¹" class="headerlink" title="1. BeetlSQL ç‰¹ç‚¹"></a>1. BeetlSQL ç‰¹ç‚¹</h3><p>BeetSqlæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½DAOå·¥å…·ï¼Œ åŒæ—¶å…·æœ‰Hibernate ä¼˜ç‚¹ &amp; Mybatisä¼˜ç‚¹åŠŸèƒ½ï¼Œé€‚ç”¨äºæ‰¿è®¤ä»¥SQLä¸ºä¸­å¿ƒï¼ŒåŒæ—¶åˆéœ€æ±‚å·¥å…·èƒ½è‡ªåŠ¨èƒ½ç”Ÿæˆå¤§é‡å¸¸ç”¨çš„SQLçš„åº”ç”¨ã€‚</p>
<ul>
<li>å¼€å‘æ•ˆç‡<ul>
<li>æ— éœ€æ³¨è§£ï¼Œè‡ªåŠ¨ä½¿ç”¨å¤§é‡å†…ç½®SQLï¼Œè½»æ˜“å®Œæˆå¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼ŒèŠ‚çœ50%çš„å¼€å‘å·¥ä½œé‡</li>
<li>æ•°æ®æ¨¡å‹æ”¯æŒPojoï¼Œä¹Ÿæ”¯æŒMap/Listè¿™ç§å¿«é€Ÿæ¨¡å‹ï¼Œä¹Ÿæ”¯æŒæ··åˆæ¨¡å‹</li>
<li>SQL æ¨¡æ¿åŸºäºBeetlå®ç°ï¼Œæ›´å®¹æ˜“å†™å’Œè°ƒè¯•ï¼Œä»¥åŠæ‰©å±•</li>
<li>å¯ä»¥é’ˆå¯¹å•ä¸ªè¡¨(æˆ–è€…è§†å›¾ï¼‰ä»£ç ç”Ÿæˆpojoç±»å’Œsqlæ¨¡ç‰ˆï¼Œç”šè‡³æ˜¯æ•´ä¸ªæ•°æ®åº“ã€‚èƒ½å‡å°‘ä»£ç ç¼–å†™å·¥ä½œé‡</li>
</ul>
</li>
<li>ç»´æŠ¤æ€§<ul>
<li>SQL ä»¥æ›´ç®€æ´çš„æ–¹å¼ï¼ŒMarkdownæ–¹å¼é›†ä¸­ç®¡ç†ï¼ŒåŒæ—¶æ–¹ä¾¿ç¨‹åºå¼€å‘å’Œæ•°æ®åº“SQLè°ƒè¯•ã€‚</li>
<li>å¯ä»¥è‡ªåŠ¨å°†sqlæ–‡ä»¶æ˜ å°„ä¸ºdaoæ¥å£ç±»</li>
<li>çµæ´»ç›´è§‚çš„æ”¯æŒæ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šå…³ç³»æ˜ å°„è€Œä¸å¼•å…¥å¤æ‚çš„OR Mappingæ¦‚å¿µå’ŒæŠ€æœ¯ã€‚</li>
<li>å…·å¤‡InterceptoråŠŸèƒ½ï¼Œå¯ä»¥è°ƒè¯•ï¼Œæ€§èƒ½è¯Šæ–­SQLï¼Œä»¥åŠæ‰©å±•å…¶ä»–åŠŸèƒ½</li>
</ul>
</li>
<li>å…¶ä»–<ul>
<li>å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“æ”¯æŒçš„å¼€æºå·¥å…·</li>
<li>æ”¯æŒè·¨æ•°æ®åº“å¹³å°ï¼Œå¼€å‘è€…æ‰€éœ€å·¥ä½œå‡å°‘åˆ°æœ€å°ï¼Œç›®å‰è·¨æ•°æ®åº“æ”¯æŒmysql,postgres,oracle,sqlserver,h2,sqllite,DB2.</li>
</ul>
</li>
</ul>
<h3 id="2-5åˆ†é’Ÿä¾‹å­"><a href="#2-5åˆ†é’Ÿä¾‹å­" class="headerlink" title="2. 5åˆ†é’Ÿä¾‹å­"></a>2. 5åˆ†é’Ÿä¾‹å­</h3><h4 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1. å®‰è£…"></a>2.1. å®‰è£…</h4><p>maven æ–¹å¼:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ibeetl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>beetlsql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æˆ–è€…ä¾æ¬¡ä¸‹è½½beetlsqlï¼Œbeetl æœ€æ–°ç‰ˆæœ¬ åŒ…æ”¾åˆ°classpathé‡Œ</p>
<h4 id="2-2-å‡†å¤‡å·¥ä½œ"><a href="#2-2-å‡†å¤‡å·¥ä½œ" class="headerlink" title="2.2. å‡†å¤‡å·¥ä½œ"></a>2.2. å‡†å¤‡å·¥ä½œ</h4><p>ä¸ºäº†å¿«é€Ÿå°è¯•BeetlSQLï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ªMysqlæ•°æ®åº“æˆ–è€…å…¶ä»–ä»»ä½•beetlsqlæ”¯æŒçš„æ•°æ®åº“ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹sqlè„šæœ¬</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</div><div class="line">	  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">	  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">	  <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">	  <span class="string">`userName`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·åç§°'</span>,</div><div class="line">	  <span class="string">`roleId`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·è§’è‰²'</span>,</div><div class="line">	  <span class="string">`create_date`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">	  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure>
<p>ç¼–å†™ä¸€ä¸ªPojoç±»ï¼Œä¸æ•°æ®åº“è¡¨å¯¹åº”ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡SQLManagerçš„genæ–¹æ³•ç”Ÿæˆæ­¤ç±»ï¼Œå‚è€ƒä¸€ä¸‹èŠ‚ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.math.*;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">*</div><div class="line">* gen by beetlsql 2016-01-06</div><div class="line">*/</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id ;</div><div class="line">	<span class="keyword">private</span> Integer age ;</div><div class="line">	<span class="comment">//ç”¨æˆ·è§’è‰²</span></div><div class="line">	<span class="keyword">private</span> Integer roleId ;</div><div class="line">	<span class="keyword">private</span> String name ;</div><div class="line">	<span class="comment">//ç”¨æˆ·åç§°</span></div><div class="line">	<span class="keyword">private</span> String userName ;</div><div class="line">	<span class="keyword">private</span> Date createDate ;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸»é”®éœ€è¦é€šè¿‡æ³¨è§£æ¥è¯´æ˜ï¼Œå¦‚@AutoIDï¼Œæˆ–è€…@AssingIDç­‰ï¼Œä½†å¦‚æœæ˜¯è‡ªå¢ä¸»é”®ï¼Œä¸”å±æ€§æ˜¯åå­—æ˜¯idï¼Œåˆ™ä¸éœ€è¦æ³¨è§£ï¼Œè‡ªåŠ¨è®¤ä¸ºæ˜¯è‡ªå¢ä¸»é”®</p>
</blockquote>
<h4 id="2-3-ä»£ç ä¾‹å­"><a href="#2-3-ä»£ç ä¾‹å­" class="headerlink" title="2.3. ä»£ç ä¾‹å­"></a>2.3. ä»£ç ä¾‹å­</h4><p>å†™ä¸€ä¸ªjavaçš„Mainæ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">ConnectionSource source = ConnectionSourceHelper.getSimple(driver, url, userName, password);</div><div class="line">DBStyle mysql = <span class="keyword">new</span> MySqlStyle();</div><div class="line"><span class="comment">// sqlè¯­å¥æ”¾åœ¨classpagthçš„/sql ç›®å½•ä¸‹</span></div><div class="line">SQLLoader loader = <span class="keyword">new</span> ClasspathLoader(<span class="string">"/sql"</span>);</div><div class="line"><span class="comment">// æ•°æ®åº“å‘½åè·Ÿjavaå‘½åä¸€æ ·ï¼Œæ‰€ä»¥é‡‡ç”¨DefaultNameConversionï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯UnderlinedNameConversionï¼Œä¸‹åˆ’çº¿é£æ ¼çš„ï¼Œ</span></div><div class="line">UnderlinedNameConversion nc = <span class="keyword">new</span>  UnderlinedNameConversion();</div><div class="line"><span class="comment">// æœ€åï¼Œåˆ›å»ºä¸€ä¸ªSQLManager,DebugInterceptor ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å¯ä»¥é€šè¿‡å®ƒæŸ¥çœ‹sqlæ‰§è¡Œæƒ…å†µ</span></div><div class="line">SQLManager sqlManager = <span class="keyword">new</span> SQLManager(mysql,loader,source,nc,<span class="keyword">new</span> Interceptor[]&#123;<span class="keyword">new</span> DebugInterceptor()&#125;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//ä½¿ç”¨å†…ç½®çš„ç”Ÿæˆçš„sql æ–°å¢ç”¨æˆ·ï¼Œå¦‚æœéœ€è¦è·å–ä¸»é”®ï¼Œå¯ä»¥ä¼ å…¥KeyHolder</span></div><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">user.setAge(<span class="number">19</span>);</div><div class="line">user.setName(<span class="string">"xiandafu"</span>);</div><div class="line">sqlManager.insert(user);</div><div class="line"></div><div class="line"><span class="comment">//ä½¿ç”¨å†…ç½®sqlæŸ¥è¯¢ç”¨æˆ·</span></div><div class="line"><span class="keyword">int</span> id = <span class="number">1</span>;</div><div class="line">user = sqlManager.unique(User.class,id);</div><div class="line"></div><div class="line"><span class="comment">//æ¨¡æ¿æ›´æ–°,ä»…ä»…æ ¹æ®idæ›´æ–°å€¼ä¸ä¸ºnullçš„åˆ—</span></div><div class="line">User newUser = <span class="keyword">new</span> User();</div><div class="line">newUser.setId(<span class="number">1</span>);</div><div class="line">newUser.setAge(<span class="number">20</span>);</div><div class="line">sqlManager.updateTemplateById(newUser);</div><div class="line"></div><div class="line"><span class="comment">//æ¨¡æ¿æŸ¥è¯¢</span></div><div class="line">User query = <span class="keyword">new</span> User();</div><div class="line">query.setName(<span class="string">"xiandafu"</span>);</div><div class="line">List&lt;User&gt; list = sqlManager.template(query);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//ä½¿ç”¨user.md æ–‡ä»¶é‡Œçš„selectè¯­å¥ï¼Œå‚è€ƒä¸‹ä¸€èŠ‚ã€‚</span></div><div class="line">User query2 = <span class="keyword">new</span> User();</div><div class="line">query.setName(<span class="string">"xiandafu"</span>);</div><div class="line">List&lt;User&gt; list2 = sqlManager.select(<span class="string">"user.select"</span>,User.class,query2);</div></pre></td></tr></table></figure>
<h4 id="2-4-SQLæ–‡ä»¶ä¾‹å­"><a href="#2-4-SQLæ–‡ä»¶ä¾‹å­" class="headerlink" title="2.4. SQLæ–‡ä»¶ä¾‹å­"></a>2.4. SQLæ–‡ä»¶ä¾‹å­</h4><p>é€šå¸¸ä¸€ä¸ªé¡¹ç›®è¿˜æ˜¯æœ‰å°‘é‡å¤æ‚sqlï¼Œå¯èƒ½åªæœ‰5ï¼Œ6è¡Œï¼Œä¹Ÿå¯èƒ½æœ‰ä¸Šç™¾è¡Œï¼Œæ”¾åœ¨å•ç‹¬çš„sqlæ–‡ä»¶é‡Œæ›´å®¹æ˜“ç¼–å†™å’Œç»´æŠ¤ï¼Œä¸ºäº†èƒ½æ‰§è¡Œä¸Šä¾‹çš„user.select,éœ€è¦åœ¨classpathé‡Œå»ºç«‹ä¸€ä¸ªsqlç›®å½•ï¼ˆåœ¨srcç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªsqlç›®å½•ï¼Œæˆ–è€…mavenå·¥ç¨‹çš„resourcesç›®å½•ã€‚ClasspathLoader é…ç½®æˆsqlç›®å½•ï¼Œå‚è€ƒä¸Šä¸€èŠ‚ClasspathLoaderåˆå§‹åŒ–çš„ä»£ç ï¼‰ä»¥åŠä¸‹é¢çš„user.md æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="section">select</span></div><div class="line">===</div><div class="line">select * from user where 1=1</div><div class="line">@if(!isEmpty(age))&#123;</div><div class="line">and age = #age#</div><div class="line">@&#125;</div><div class="line">@if(!isEmpty(name))&#123;</div><div class="line">and name = #name#</div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<p>å…³äºå¦‚ä½•å†™sqlæ¨¡æ¿ï¼Œä¼šç¨åç« èŠ‚è¯´æ˜ï¼Œå¦‚ä¸‹æ˜¯ä¸€äº›ç®€å•è¯´æ˜ã€‚</p>
<ul>
<li>é‡‡ç”¨mdæ ¼å¼ï¼Œ===ä¸Šé¢æ˜¯sqlè¯­å¥åœ¨æœ¬æ–‡ä»¶é‡Œçš„å”¯ä¸€æ ‡ç¤ºï¼Œä¸‹é¢åˆ™æ˜¯sqlè¯­å¥ã€‚</li>
<li>@ å’Œå›è½¦ç¬¦å·æ˜¯å®šç•Œç¬¦å·ï¼Œå¯ä»¥åœ¨é‡Œé¢å†™beetlè¯­å¥ã€‚</li>
<li>â€œ#â€ æ˜¯å ä½ç¬¦å·ï¼Œç”Ÿæˆsqlè¯­å¥å¾—æ—¶å€™ï¼Œå°†è¾“å‡ºï¼Ÿï¼Œå¦‚æœä½ æƒ³è¾“å‡ºè¡¨è¾¾å¼å€¼ï¼Œéœ€è¦ç”¨textå‡½æ•°ï¼Œæˆ–è€…ä»»ä½•ä»¥dbå¼€å¤´çš„å‡½æ•°ï¼Œå¼•æ“åˆ™è®¤ä¸ºæ˜¯ç›´æ¥è¾“å‡ºæ–‡æœ¬ã€‚</li>
<li>isEmptyæ˜¯beetlçš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©ºæˆ–è€…æ˜¯å¦ä¸å­˜åœ¨.</li>
<li>æ–‡ä»¶åçº¦å®šä¸ºç±»åï¼Œé¦–å­—æ¯å°å†™ã€‚</li>
</ul>
<p>sqlæ¨¡æ¿é‡‡ç”¨beetlåŸå› æ˜¯å› ä¸ºbeetl è¯­æ³•ç±»ä¼¼jsï¼Œä¸”å¯¹æ¨¡æ¿æ¸²æŸ“åšäº†ç‰¹å®šä¼˜åŒ–ï¼Œç›¸æ¯”äºmybatisï¼Œæ›´åŠ å®¹æ˜“æŒæ¡å’ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯è¯»æ€§æ›´å¥½ï¼Œä¹Ÿå®¹æ˜“åœ¨javaå’Œæ•°æ®åº“ä¹‹é—´è¿ç§»sqlè¯­å¥</p>
<hr>
<p>æ³¨æ„ï¼šsqlId åˆ°sqlæ–‡ä»¶çš„æ˜ å°„æ˜¯é€šè¿‡ç±»SQLIdNameConversionæ¥å®Œæˆçš„ï¼Œé»˜è®¤æä¾›äº†DefaultSQLIdNameConversionå®ç°ï¼Œå³ ä»¥ â€œ.â€ åŒºåˆ†æœ€åä¸€éƒ¨åˆ†æ˜¯sqlç‰‡æ®µåå­—ï¼Œå‰é¢è½¬ä¸ºä¸ºæ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼Œå¦‚sqlIdæ˜¯user.selectï¼Œåˆ™selectæ˜¯sqlç‰‡æ®µåå­—ï¼Œuseræ˜¯æ–‡ä»¶åï¼Œbeetlsqlä¼šåœ¨æ ¹ç›®å½•ä¸‹å¯»æ‰¾/user.sql,/user.md ,ä¹Ÿä¼šæ‰¾æ•°æ®åº“æ–¹è¨€ç›®å½•ä¸‹å¯»æ‰¾ï¼Œæ¯”å¦‚å¦‚æœä½¿ç”¨äº†mysqlæ•°æ®åº“ï¼Œåˆ™ä¼˜å…ˆå¯»æ‰¾/mysql/user.md,/mysql/user.sql ç„¶ååœ¨æ‰¾/user.md,/user.sql.</p>
<p>å¦‚æœsqlæ˜¯ test.user.select,åˆ™ä¼šåœ¨/test/user.md(sql) æˆ–è€… /mysql/test/user.md(sql) ä¸‹å¯»æ‰¾â€œselectâ€ç‰‡æ®µ</p>
<h4 id="2-5-ä»£ç -amp-sqlç”Ÿæˆ"><a href="#2-5-ä»£ç -amp-sqlç”Ÿæˆ" class="headerlink" title="2.5. ä»£ç &amp;sqlç”Ÿæˆ"></a>2.5. ä»£ç &amp;sqlç”Ÿæˆ</h4><p>Userç±»å¹¶ééœ€è¦è‡ªå·±å†™ï¼Œå¥½çš„å®è·µæ˜¯å¯ä»¥åœ¨é¡¹ç›®ä¸­ä¸“é—¨å†™ä¸ªç±»ç”¨æ¥è¾…åŠ©ç”Ÿæˆpojoå’Œsqlç‰‡æ®µï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">	SqlManager sqlManager  = ...... <span class="comment">//åŒä¸Šé¢çš„ä¾‹å­</span></div><div class="line">	sqlManager.genPojoCodeToConsole(<span class="string">"user"</span>);</div><div class="line">	sqlManager.genSQLTemplateToConsole(<span class="string">"user"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>  æ³¨æ„:æˆ‘ç»å¸¸åœ¨æˆ‘çš„é¡¹ç›®é‡Œå†™ä¸€ä¸ªè¿™æ ·çš„è¾…åŠ©ç±»ï¼Œç”¨æ¥æ ¹æ®è¡¨æˆ–è€…è§†å›¾ç”Ÿæˆå„ç§ä»£ç å’Œsqlç‰‡æ®µï¼Œä»¥å¿«é€Ÿå¼€å‘.</p>
</blockquote>
<p>genPojoCodeToConsole æ–¹æ³•å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ç”Ÿæˆç›¸åº”çš„Pojoä»£ç ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è¿™äº›ä»£ç åˆ›å»ºç›¸åº”çš„ç±»ï¼Œå¦‚ä¸Šä¾‹å­ï¼Œæ§åˆ¶å°å°†è¾“å‡º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.test;</div><div class="line"><span class="keyword">import</span> java.math.*;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.sql.Timestamp;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">*</div><div class="line">* gen by beetlsql 2016-01-06</div><div class="line">*/</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id ;</div><div class="line">	<span class="keyword">private</span> Integer age ;</div><div class="line">	<span class="comment">//ç”¨æˆ·è§’è‰²</span></div><div class="line">	<span class="keyword">private</span> Integer roleId ;</div><div class="line">	<span class="keyword">private</span> String name ;</div><div class="line">	<span class="comment">//ç”¨æˆ·åç§°</span></div><div class="line">	<span class="keyword">private</span> String userName ;</div><div class="line">	<span class="keyword">private</span> Date createDate ;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  ç”Ÿæˆå±æ€§çš„æ—¶å€™ï¼Œidæ€»æ˜¯åœ¨å‰é¢ï¼Œåé¢ä¾æ¬¡æ˜¯ç±»å‹ä¸ºIntegerçš„ç±»å‹ï¼Œæœ€åé¢æ˜¯æ—¥æœŸç±»å‹ï¼Œå‰©ä¸‹çš„æŒ‰ç…§å­—æ¯æ’åºæ”¾åˆ°ä¸­é—´ã€‚</p>
</blockquote>
<p>ä¸€æ—¦æœ‰äº†User ç±»ï¼Œå¦‚æœä½ éœ€è¦äº›sqlè¯­å¥ï¼Œé‚£ä¹ˆgenSQLTemplateToConsole å°†æ˜¯ä¸ªå¾ˆå¥½çš„è¾…åŠ©æ–¹æ³•ï¼Œå¯ä»¥è¾“å‡ºä¸€ç³»åˆ—sqlè¯­å¥ç‰‡æ®µï¼Œä½ åŒæ ·å¯ä»¥èµ‹å€¼ç²˜è´´åˆ°ä»£ç æˆ–è€…sqlæ¨¡æ¿æ–‡ä»¶é‡Œï¼ˆuser.md),å¦‚ä¸Šä¾‹æ‰€è¿°ï¼Œå½“è°ƒç”¨genSQLTemplateToConsoleçš„æ—¶å€™ï¼Œç”Ÿæˆå¦‚ä¸‹</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="section">sample</span></div><div class="line">===</div><div class="line"><span class="bullet">* </span>æ³¨é‡Š</div><div class="line"></div><div class="line"><span class="code">	select #use("cols")# from user where #use("condition")#</span></div><div class="line"></div><div class="line"><span class="section">cols</span></div><div class="line">===</div><div class="line"></div><div class="line"><span class="code">	id,name,age,userName,roleId,create_date</span></div><div class="line"></div><div class="line"><span class="section">updateSample</span></div><div class="line">===</div><div class="line"></div><div class="line"><span class="code">	`id`=#id#,`name`=#name#,`age`=#age#,`userName`=#userName#,`roleId`=#roleId#,`create_date`=#date#</span></div><div class="line"></div><div class="line"><span class="section">condition</span></div><div class="line">===</div><div class="line"></div><div class="line"><span class="code">	1 = 1</span></div><div class="line"><span class="code">	@if(!isEmpty(name))&#123;</span></div><div class="line"><span class="code">	 and `name`=#name#</span></div><div class="line"><span class="code">	@&#125;</span></div><div class="line"><span class="code">	@if(!isEmpty(age))&#123;</span></div><div class="line"><span class="code">	 and `age`=#age#</span></div><div class="line"><span class="code">	@&#125;</span></div></pre></td></tr></table></figure>
<p>beetlsqlç”Ÿæˆäº†ç”¨äºæŸ¥è¯¢ï¼Œæ›´æ–°ï¼Œæ¡ä»¶çš„sqlç‰‡æ®µå’Œä¸€ä¸ªç®€å•ä¾‹å­ã€‚ä½ å¯ä»¥æŒ‰ç…§ä½ çš„éœ€è¦copyåˆ°sqlæ¨¡æ¿æ–‡ä»¶é‡Œ.å®é™…ä¸Šï¼Œå¦‚æœä½ ç†Ÿæ‚‰genæ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥genä»£ç å’Œsqlåˆ°ä½ çš„å·¥ç¨‹é‡Œï¼Œç”šè‡³æ˜¯æ•´ä¸ªæ•°æ®åº“éƒ½å¯ä»¥è°ƒç”¨genAllæ¥ä¸€æ¬¡ç”Ÿæˆ</p>
<blockquote>
<h4 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  sql ç‰‡æ®µçš„ç”Ÿæˆé¡ºåºæŒ‰ç…§æ•°æ®åº“è¡¨å®šä¹‰çš„é¡ºåºæ˜¾ç¤º</p>
</blockquote>
<h3 id="3-BeetlSQL-è¯´æ˜"><a href="#3-BeetlSQL-è¯´æ˜" class="headerlink" title="3. BeetlSQL è¯´æ˜"></a>3. BeetlSQL è¯´æ˜</h3><h4 id="3-1-è·å¾—SQLManager"><a href="#3-1-è·å¾—SQLManager" class="headerlink" title="3.1. è·å¾—SQLManager"></a>3.1. è·å¾—SQLManager</h4><p>SQLManager æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä»–æä¾›äº†æ‰€æœ‰çš„daoæ–¹æ³•ã€‚è·å¾—SQLManagerï¼Œå¯ä»¥ç›´æ¥æ„é€ SQLManager.å¹¶é€šè¿‡å•ä¾‹è·å–å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ConnectionSource source = ConnectionSourceHelper.getSimple(driver, url, <span class="string">""</span>, userName, password);</div><div class="line">DBStyle mysql = <span class="keyword">new</span> MySqlStyle();</div><div class="line"><span class="comment">// sqlè¯­å¥æ”¾åœ¨classpagthçš„/sql ç›®å½•ä¸‹</span></div><div class="line">SQLLoader loader = <span class="keyword">new</span> ClasspathLoader(<span class="string">"/sql"</span>);</div><div class="line"><span class="comment">// æ•°æ®åº“å‘½åè·Ÿjavaå‘½åä¸€æ ·ï¼Œæ‰€ä»¥é‡‡ç”¨DefaultNameConversionï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯UnderlinedNameConversionï¼Œä¸‹åˆ’çº¿é£æ ¼çš„</span></div><div class="line">UnderlinedNameConversion nc = <span class="keyword">new</span>  UnderlinedNameConversion();</div><div class="line"><span class="comment">// æœ€åï¼Œåˆ›å»ºä¸€ä¸ªSQLManager,DebugInterceptor ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å¯ä»¥é€šè¿‡å®ƒæŸ¥çœ‹sqlæ‰§è¡Œæƒ…å†µ</span></div><div class="line">SQLManager sqlManager = <span class="keyword">new</span> SQLManager(mysql,loader,source,nc,<span class="keyword">new</span> Interceptor[]&#123;<span class="keyword">new</span> DebugInterceptor()&#125;);</div></pre></td></tr></table></figure>
<p>æ›´å¸¸è§çš„æ˜¯ï¼Œå·²ç»æœ‰äº†DataSourceï¼Œåˆ›å»ºConnectionSource å¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ConnectionSource source = ConnectionSourceHelper.single(datasource);</div></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯ä¸»ä»Datasource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ConnectionSource source = ConnectionSourceHelper.getMasterSlave(master,slaves)</div></pre></td></tr></table></figure>
<h4 id="3-2-æŸ¥è¯¢API"><a href="#3-2-æŸ¥è¯¢API" class="headerlink" title="3.2. æŸ¥è¯¢API"></a>3.2. æŸ¥è¯¢API</h4><h5 id="3-2-1-æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰"><a href="#3-2-1-æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰" class="headerlink" title="3.2.1. æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰"></a>3.2.1. æ¨¡æ¿ç±»æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”Ÿæˆsqlï¼‰</h5><ul>
<li>public <t> List<t> all(Class<t> clazz) æŸ¥è¯¢å‡ºæ‰€æœ‰ç»“æœé›†</t></t></t></li>
<li>public <t> List<t> all(Class<t> clazz, int start, int size) ç¿»é¡µ</t></t></t></li>
<li>public int allCount(Class&lt;?&gt; clazz) æ€»æ•°</li>
<li>public <t> List<t> template(T t) æ ¹æ®æ¨¡æ¿æŸ¥è¯¢ï¼Œè¿”å›æ‰€æœ‰ç¬¦åˆè¿™ä¸ªæ¨¡æ¿çš„æ•°æ®åº“ åŒä¸Šï¼Œmapperå¯ä»¥æä¾›é¢å¤–çš„æ˜ å°„ï¼Œå¦‚å¤„ç†ä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€</t></t></li>
<li>public <t>  T templateOne(T t) æ ¹æ®æ¨¡æ¿æŸ¥è¯¢ï¼Œè¿”å›ä¸€æ¡ç»“æœï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›null</t></li>
<li>public <t> List<t> template(T t,int start,int size) åŒä¸Šï¼Œå¯ä»¥ç¿»é¡µ</t></t></li>
<li>public <t> long templateCount(T t) è·å–ç¬¦åˆæ¡ä»¶çš„ä¸ªæ•°</t></li>
</ul>
<p>ç¿»é¡µçš„startï¼Œç³»ç»Ÿé»˜è®¤ä½ä»1å¼€å§‹ï¼Œä¸ºäº†å…¼å®¹å„ä¸ªæ•°æ®åº“ç³»ç»Ÿï¼Œä¼šè‡ªåŠ¨ç¿»è¯‘æˆæ•°æ®åº“ä¹ ä¿—ï¼Œæ¯”å¦‚startä¸º1ï¼Œä¼šè®¤ä¸ºmysqlï¼Œpostgresä»0å¼€å§‹ï¼ˆä»startï¼1å¼€å§‹ï¼‰ï¼Œoralceï¼Œsqlserverï¼Œdb2ä»1å¼€å§‹ï¼ˆstartï¼0ï¼‰å¼€å§‹ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœä½ åªç”¨ç‰¹å®šæ•°æ®åº“ï¼Œå¯ä»¥æŒ‰ç…§ç‰¹å®šæ•°æ®åº“ä¹ ä¿—æ¥ï¼Œæ¯”å¦‚ï¼Œä½ åªç”¨mysqlï¼Œstartä¸º0ä»£è¡¨èµ·å§‹çºªå½•ï¼Œéœ€è¦é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OFFSET_START_ZERO = true</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œç¿»é¡µå‚æ•°startä¼ å…¥0å³å¯ã€‚</p>
<p>æ³¨æ„:templateæŸ¥è¯¢æ–¹æ³•æ ¹æ®æ¨¡æ¿æŸ¥è¯¢å¹¶ä¸åŒ…å«æ—¶é—´å­—æ®µï¼Œä¹Ÿä¸åŒ…å«æ’åºï¼Œç„¶è€Œï¼Œå¯ä»¥é€šè¿‡åœ¨pojo classä¸Šä½¿ç”¨@TableTemplate() æˆ–è€…æ—¥æœŸå­—æ®µçš„getteræ–¹æ³•ä¸Šä½¿ç”¨@DateTemplate()æ¥å®šåˆ¶ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@TableTemplate</span>(<span class="string">"order by id desc "</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id ;</div><div class="line">	<span class="keyword">private</span> Integer age ;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">	<span class="meta">@DateTemplate</span>(accept=<span class="string">"minDate,maxDate"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> date;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ¨¡æ¿æŸ¥è¯¢å°†æ·»åŠ order by id desc ,ä»¥åŠdateå­—æ®µå°†æŒ‰ç…§æ—¥æœŸèŒƒå›´æ¥æŸ¥è¯¢ã€‚ å…·ä½“å‚è€ƒannotationä¸€ç« </p>
<h5 id="3-2-2-é€šè¿‡sqlidæŸ¥è¯¢-sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ"><a href="#3-2-2-é€šè¿‡sqlidæŸ¥è¯¢-sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ" class="headerlink" title="3.2.2. é€šè¿‡sqlidæŸ¥è¯¢,sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ"></a>3.2.2. é€šè¿‡sqlidæŸ¥è¯¢,sqlè¯­å¥åœ¨mdæ–‡ä»¶é‡Œ</h5><ul>
<li>public <t> List<t> select(String sqlId, Class<t> clazz, Map<string, object=""> paras) æ ¹æ®sqlidæ¥æŸ¥è¯¢ï¼Œå‚æ•°æ˜¯ä¸ªmap</string,></t></t></t></li>
<li>public <t> List<t> select(String sqlId, Class<t> clazz, Object paras) æ ¹æ®sqlidæ¥æŸ¥è¯¢ï¼Œå‚æ•°æ˜¯ä¸ªpojo</t></t></t></li>
<li>public <t> List<t> select(String sqlId, Class<t> clazz) æ ¹æ®sqlidæ¥æŸ¥è¯¢ï¼Œæ— å‚æ•°</t></t></t></li>
<li>public <t> List<t> select(String sqlId, Class<t> clazz, Map<string, object=""> paras, int start, int size)ï¼Œ å¢åŠ ç¿»é¡µ</string,></t></t></t></li>
<li>public <t> List<t> select(String sqlId, Class<t> clazz, Object paras, int start, int size) ï¼Œå¢åŠ ç¿»é¡µ</t></t></t></li>
<li>public <t> T selectSingle(String id,Object paras, Class<t> target) æ ¹æ®sqlidæŸ¥è¯¢ï¼Œè¾“å…¥æ˜¯Pojoï¼Œå°†å¯¹åº”çš„å”¯ä¸€å€¼æ˜ å°„æˆæŒ‡å®šçš„tagetå¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™è¿”å›ç©ºã€‚éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ç»“æœé›†æœ¬ç”Ÿæ˜¯ç©ºï¼Œè¿™æ—¶å€™å»ºè®®ä½¿ç”¨unique</t></t></li>
<li>public <t> T selectSingle(String id,Map<string, object=""> paras, Class<t> target) æ ¹æ®sqlidæŸ¥è¯¢ï¼Œè¾“å…¥æ˜¯Mapï¼Œå°†å¯¹åº”çš„å”¯ä¸€å€¼æ˜ å°„æˆæŒ‡å®šçš„tagetå¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™è¿”å›ç©ºã€‚éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ç»“æœé›†æœ¬ç”Ÿæ˜¯ç©ºï¼Œè¿™æ—¶å€™å»ºè®®ä½¿ç”¨unique</t></string,></t></li>
<li>public <t> T selectUnique(String id,Object paras, Class<t> target) æ ¹æ®sqlidæŸ¥è¯¢ï¼Œè¾“å…¥æ˜¯Pojoæˆ–è€…Mapï¼Œå°†å¯¹åº”çš„å”¯ä¸€å€¼æ˜ å°„æˆæŒ‡å®šçš„tagetå¯¹è±¡,å¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</t></t></li>
<li>public <t> T selectUnique(String id,Map<string, object=""> paras, Class<t> target) æ ¹æ®sqlidæŸ¥è¯¢ï¼Œè¾“å…¥æ˜¯Pojoæˆ–è€…Mapï¼Œå°†å¯¹åº”çš„å”¯ä¸€å€¼æ˜ å°„æˆæŒ‡å®šçš„tagetå¯¹è±¡,å¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</t></string,></t></li>
<li>public Integer intValue(String id,Object paras) æŸ¥è¯¢ç»“æœæ˜ å°„æˆIntegerï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›nullï¼Œè¾“å…¥æ˜¯object</li>
<li>public Integer intValue(String id,Map paras) æŸ¥è¯¢ç»“æœæ˜ å°„æˆIntegerï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›nullï¼Œè¾“å…¥æ˜¯mapï¼Œå…¶ä»–è¿˜æœ‰ longValueï¼ŒbigDecimalValue</li>
<li>public <t> T unique(Class<t> clazz,Object pk) æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼ŒæŠ›å‡ºå¼‚å¸¸.</t></t></li>
</ul>
<h4 id="3-3-ç¿»é¡µæŸ¥è¯¢API"><a href="#3-3-ç¿»é¡µæŸ¥è¯¢API" class="headerlink" title="3.3. ç¿»é¡µæŸ¥è¯¢API"></a>3.3. ç¿»é¡µæŸ¥è¯¢API</h4><ul>
<li>public <t> void pageQuery(String sqlId,Class<t> clazz,PageQuery query)</t></t></li>
</ul>
<p>BeetlSQL æä¾›ä¸€ä¸ªPageQUeryå¯¹è±¡,ç”¨äºwebåº”ç”¨çš„ç¿»é¡µæŸ¥è¯¢,BeetlSqlå‡å®šæœ‰sqlId å’ŒsqlId$count,ä¿©ä¸ªsqlId,å¹¶ç”¨è¿™æ¥ä¸ªæ¥ç¿»é¡µå’ŒæŸ¥è¯¢ç»“æœæ€»æ•°.å¦‚:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select * from user order by id desc ;</div><div class="line"></div><div class="line"><span class="section">queryNewUser$count</span></div><div class="line">===</div><div class="line">select count(1) from user</div></pre></td></tr></table></figure>
<p>å¯¹äºä¿©ä¸ªç›¸ä¼¼çš„sqlè¯­å¥,ä½ å¯ä»¥ä½¿ç”¨useå‡½æ•°,æŠŠå…¬å…±éƒ¨åˆ†æç‚¼å‡ºæ¥.</p>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹,éƒ½ä¸éœ€è¦2ä¸ªsqlæ¥å®Œæˆ,ä¸€ä¸ªsqlä¹Ÿå¯ä»¥,è¦æ±‚ä½¿ç”¨pageå‡½æ•°æˆ–è€…pageTagæ ‡ç­¾,è¿™æ ·æ‰èƒ½åŒæ—¶è·å¾—æŸ¥è¯¢ç»“æœé›†æ€»æ•°å’Œå½“å‰æŸ¥è¯¢çš„ç»“æœ</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select</div><div class="line">@pageTag()&#123;</div><div class="line">a.*,b.name role_name</div><div class="line">@&#125;</div><div class="line">from user a left join b ...</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šsql,ä¼šåœ¨æŸ¥è¯¢çš„æ—¶å€™è½¬ä¸ºä¿©æ¡sqlè¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">user</span> a <span class="keyword">left</span> <span class="keyword">join</span> b...</div><div class="line"><span class="keyword">select</span> a.*,b.name role_name  <span class="keyword">from</span> <span class="keyword">user</span> a <span class="keyword">left</span> <span class="keyword">join</span> b...</div></pre></td></tr></table></figure>
<p>å¦‚æœå­—æ®µè¾ƒå¤š,ä¸ºäº†è¾“å‡ºæ–¹ä¾¿,ä¹Ÿå¯ä»¥ä½¿ç”¨pageTag,å­—æ®µè¾ƒå°‘,ç”¨pageå‡½æ•°ä¹Ÿå¯ä»¥. ,å…·ä½“å‚è€ƒpageTagå’Œpageå‡½æ•°è¯´æ˜.ç¿»é¡µä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä»ç¬¬ä¸€é¡µå¼€å§‹æŸ¥è¯¢,æ— å‚æ•°</span></div><div class="line">PageQuery query = <span class="keyword">new</span> PageQuery();</div><div class="line">sql.pageQuery(<span class="string">"user.queryNewUser"</span>, User.class,query);</div><div class="line">System.out.println(query.getTotalPage());</div><div class="line">System.out.println(query.getTotalRow());</div><div class="line">System.out.println(query.getPageNumber());</div><div class="line">List&lt;User&gt; list = query.getList();</div></pre></td></tr></table></figure>
<p>PageQuery å¯¹è±¡ä¹Ÿæä¾›äº† orderByå±æ€§ï¼Œç”¨äºæ•°æ®åº“æ’åºï¼Œå¦‚ â€œid descâ€</p>
<blockquote>
<h4 id="è·¨æ•°æ®åº“æ”¯æŒ"><a href="#è·¨æ•°æ®åº“æ”¯æŒ" class="headerlink" title="è·¨æ•°æ®åº“æ”¯æŒ"></a>è·¨æ•°æ®åº“æ”¯æŒ</h4><p>  å¦‚æœä½ æ‰“ç®—ä½¿ç”¨PageQueryåšç¿»é¡µ,ä¸”åªæƒ³æä¾›ä¸€ä¸ªsqlè¯­å¥+pageå‡½æ•°,é‚£è€ƒè™‘åˆ°å®æ•°æ®åº“,åº”è¯¥ä¸è¦åœ¨è¿™ä¸ªsqlè¯­å¥é‡ŒåŒ…å«æ’åº,å› ä¸ºå¤§éƒ¨åˆ†æ•°æ®åº“éƒ½ä¸æ”¯æŒ. pageå‡½æ•°ç”Ÿæˆçš„æŸ¥è¯¢æ€»æ•°sqlè¯­å¥,å› ä¸ºåŒ…å«äº†oder by,åœ¨å¤§éƒ¨åˆ†æ•°æ®åº“éƒ½æ˜¯ä¼šæŠ¥é”™çš„çš„,æ¯”å¦‚:select count(1) form user order by name,åœ¨sqlserver,mysql,postgreséƒ½ä¼šå‡ºé”™,oracleå…è®¸è¿™ç§æƒ…å†µ, å› æ­¤,å¦‚æœä½ è¦ä½¿ç”¨ä¸€æ¡sqlè¯­å¥+pageå‡½æ•°,å»ºè®®æ’åºç”¨PageQueryå¯¹è±¡é‡Œæœ‰æ’åºå±æ€§oderBy,å¯ç”¨äºæ’åº,è€Œä¸æ˜¯æ”¾åœ¨sqlè¯­å¥é‡Œ.</p>
<p>  2.8ç‰ˆæœ¬ä»¥åä¹Ÿæä¾›äº†æ ‡ç­¾å‡½æ•° pageIgnoreTagï¼Œå¯ä»¥ç”¨åœ¨ç¿»é¡µæŸ¥è¯¢é‡Œï¼Œå½“æŸ¥è¯¢ç”¨ä½œç»Ÿè®¡æ€»æ•°çš„æ—¶å€™ï¼Œä¼šå¿½ç•¥æ ‡ç­¾ä½“å†…å®¹ï¼Œå¦‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;   select page(&quot;*&quot;) from xxx </div><div class="line">&gt;   @pageIgnoreTag()&#123;</div><div class="line">&gt;    order by id </div><div class="line">&gt;   @&#125;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>  å¦‚ä¸Šè¯­å¥ï¼Œåœ¨æ±‚æ€»æ•°çš„æ—¶å€™ï¼Œä¼šç¿»è¯‘æˆ select count(1) from xxx</p>
<p>  å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨PageQuery+ä¸€æ¡sqlçš„æ–¹å¼,è€Œæ˜¯ç”¨ä¿©æ¡sqlæ¥åˆ†åˆ«ç¿»é¡µæŸ¥è¯¢å’Œç»Ÿè®¡æ€»æ•°,é‚£æ— æ‰€è°“</p>
<p>  æˆ–è€…ä½ ç›´æ¥ä½¿ç”¨select å¸¦æœ‰èµ·å§‹å’Œè¯»å–æ€»æ•°çš„æ¥å£,ä¹Ÿæ²¡æœ‰å…³ç³»,å¯ä»¥åœ¨sqlè¯­å¥é‡ŒåŒ…å«æ’åº</p>
</blockquote>
<h4 id="3-4-æ›´æ–°API"><a href="#3-4-æ›´æ–°API" class="headerlink" title="3.4. æ›´æ–°API"></a>3.4. æ›´æ–°API</h4><p>æ·»åŠ ï¼Œåˆ é™¤å’Œæ›´æ–°å‡ä½¿ç”¨ä¸‹é¢çš„API</p>
<h5 id="3-4-1-è‡ªåŠ¨ç”Ÿæˆsql"><a href="#3-4-1-è‡ªåŠ¨ç”Ÿæˆsql" class="headerlink" title="3.4.1. è‡ªåŠ¨ç”Ÿæˆsql"></a>3.4.1. è‡ªåŠ¨ç”Ÿæˆsql</h5><ul>
<li>public void insert(Object paras) æ’å…¥parasåˆ°paraså…³è”çš„è¡¨</li>
<li>public void insert(Object paras,boolean autoAssignKey) æ’å…¥parasåˆ°paraså¯¹è±¡å…³è”çš„è¡¨,å¹¶ä¸”æŒ‡å®šæ˜¯å¦è‡ªåŠ¨å°†æ•°æ®åº“ä¸»é”®èµ‹å€¼åˆ°parasé‡Œ</li>
<li>public void insertTemplate(Object paras) æ’å…¥parasåˆ°paraså…³è”çš„è¡¨,å¿½ç•¥ä¸ºnullå€¼æˆ–è€…ä¸ºç©ºå€¼çš„å±æ€§</li>
<li>public void insertTemplate(Object paras,boolean autoAssignKey) æ’å…¥parasåˆ°paraså¯¹è±¡å…³è”çš„è¡¨,å¹¶ä¸”æŒ‡å®šæ˜¯å¦è‡ªåŠ¨å°†æ•°æ®åº“ä¸»é”®èµ‹å€¼åˆ°parasé‡Œ,å¿½ç•¥ä¸ºnullå€¼æˆ–è€…ä¸ºç©ºå€¼çš„å±æ€§ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯¹åº”çš„æ•°æ®åº“å¿…é¡»ä¸»é”®è‡ªå¢ã€‚</li>
<li>public void insert(Class&lt;?&gt; clazz,Object paras) æ’å…¥parasåˆ°clazzå…³è”çš„è¡¨</li>
<li>public void insert(Class&lt;?&gt; clazz,Object paras,KeyHolder holder)ï¼Œæ’å…¥parasåˆ°clazzå…³è”çš„è¡¨ï¼Œå¦‚æœéœ€è¦ä¸»é”®ï¼Œå¯ä»¥é€šè¿‡holderçš„getKeyæ¥è·å–ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯¹åº”çš„æ•°æ®åº“å¿…é¡»ä¸»é”®è‡ªå¢</li>
<li>public int insert(Class clazz,Object paras,boolean autoAssignKey) æ’å…¥parasåˆ°clazzå…³è”çš„è¡¨ï¼Œå¹¶ä¸”æŒ‡å®šæ˜¯å¦è‡ªåŠ¨å°†æ•°æ®åº“ä¸»é”®èµ‹å€¼åˆ°parasé‡Œï¼Œè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯¹åº”çš„æ•°æ®åº“å¿…é¡»ä¸»é”®è‡ªå¢ã€‚</li>
<li>public int updateById(Object obj) æ ¹æ®ä¸»é”®æ›´æ–°ï¼Œæ‰€æœ‰å€¼å‚ä¸æ›´æ–°</li>
<li>public int updateTemplateById(Object obj) æ ¹æ®ä¸»é”®æ›´æ–°ï¼Œå±æ€§ä¸ºnullçš„ä¸ä¼šæ›´æ–°</li>
<li>public int updateBatchTemplateById(Class clazz,List&lt;?&gt; list) æ‰¹é‡æ ¹æ®ä¸»é”®æ›´æ–°,å±æ€§ä¸ºnullçš„ä¸ä¼šæ›´æ–°</li>
<li>public int updateTemplateById(Class&lt;?&gt; clazzï¼ŒMap paras) æ ¹æ®ä¸»é”®æ›´æ–°ï¼Œç»„ä»¶é€šè¿‡clazzçš„annotationè¡¨ç¤ºï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è®¤ä¸ºå±æ€§idæ˜¯ä¸»é”®,å±æ€§ä¸ºnullçš„ä¸ä¼šæ›´æ–°ã€‚</li>
<li>public int[] updateByIdBatch(List&lt;?&gt; list) æ‰¹é‡æ›´æ–°</li>
<li>public void insertBatch(Class clazz,List&lt;?&gt; list) æ‰¹é‡æ’å…¥æ•°æ®</li>
</ul>
<h5 id="3-4-2-é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰"><a href="#3-4-2-é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰" class="headerlink" title="3.4.2. é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰"></a>3.4.2. é€šè¿‡sqlidæ›´æ–°ï¼ˆåˆ é™¤ï¼‰</h5><ul>
<li>public int insert(String sqlId,Object paras,KeyHolder holder) æ ¹æ®sqlId æ’å…¥ï¼Œå¹¶è¿”å›ä¸»é”®ï¼Œä¸»é”®idç”±paraså¯¹è±¡æ‰€æŒ‡å®šï¼Œè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯¹åº”çš„æ•°æ®åº“è¡¨å¿…é¡»ä¸»é”®è‡ªå¢ã€‚</li>
<li>public int insert(String sqlId,Object paras,KeyHolder holder,String keyName) åŒä¸Šï¼Œä¸»é”®ç”±keyNameæŒ‡å®š</li>
<li>public int insert(String sqlId,Map paras,KeyHolder holder,String keyName)ï¼ŒåŒä¸Šï¼Œå‚æ•°é€šè¿‡mapæä¾›</li>
<li>public int update(String sqlId, Object obj) æ ¹æ®sqlidæ›´æ–°</li>
<li>public int update(String sqlId, Map<string, object=""> paras) æ ¹æ®sqlidæ›´æ–°ï¼Œè¾“å‡ºå‚æ•°æ˜¯map</string,></li>
<li>public int[] updateBatch(String sqlId,List&lt;?&gt; list) æ‰¹é‡æ›´æ–°</li>
<li>public int[] updateBatch(String sqlId,Map<string, object="">[] maps) æ‰¹é‡æ›´æ–°ï¼Œå‚æ•°æ˜¯ä¸ªæ•°ç»„ï¼Œå…ƒç´ ç±»å‹æ˜¯map</string,></li>
</ul>
<h4 id="3-5-ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿"><a href="#3-5-ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿" class="headerlink" title="3.5. ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿"></a>3.5. ç›´æ¥æ‰§è¡ŒSQLæ¨¡æ¿</h4><h5 id="3-5-1-ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥"><a href="#3-5-1-ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥" class="headerlink" title="3.5.1. ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥"></a>3.5.1. ç›´æ¥æ‰§è¡Œsqlæ¨¡æ¿è¯­å¥</h5><p>  ä¸€ä¸‹æ¥å£sqlå˜é‡æ˜¯sqlæ¨¡æ¿</p>
<ul>
<li>public <t> List<t> execute(String sql,Class<t> clazz, Object paras)</t></t></t></li>
<li>public <t> List<t> execute(String sql,Class<t> clazz, Map paras)</t></t></t></li>
<li>public int executeUpdate(String sql,Object paras) è¿”å›æˆåŠŸæ‰§è¡Œæ¡æ•°</li>
<li>public int executeUpdate(String sql,Map paras) è¿”å›æˆåŠŸæ‰§è¡Œæ¡æ•°</li>
</ul>
<h4 id="3-5-2-ç›´æ¥æ‰§è¡ŒJDBC-sqlè¯­å¥"><a href="#3-5-2-ç›´æ¥æ‰§è¡ŒJDBC-sqlè¯­å¥" class="headerlink" title="3.5.2. ç›´æ¥æ‰§è¡ŒJDBC sqlè¯­å¥"></a>3.5.2. ç›´æ¥æ‰§è¡ŒJDBC sqlè¯­å¥</h4><ul>
<li>æŸ¥è¯¢ public <t> List<t> execute(SQLReady p,Class<t> clazz) SQLReadyåŒ…å«äº†éœ€è¦æ‰§è¡Œçš„sqlè¯­å¥å’Œå‚æ•°ï¼Œclazzæ˜¯æŸ¥è¯¢ç»“æœï¼Œå¦‚</t></t></t></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;User&gt; list = sqlManager.execute(<span class="keyword">new</span> SQLReady(<span class="string">"select * from user where name=? and age = ?"</span>,<span class="string">"xiandafu"</span>,<span class="number">18</span>),User.class);)</div></pre></td></tr></table></figure>
<ul>
<li><p>æ›´æ–° public int executeUpdate(SQLReady p) SQLReadyåŒ…å«äº†éœ€è¦æ‰§è¡Œçš„sqlè¯­å¥å’Œå‚æ•°ï¼Œè¿”å›æ›´æ–°ç»“æœ</p>
</li>
<li><p>ç›´æ¥ä½¿ç”¨Connection public <t> T executeOnConnection(OnConnection<t> call),ä½¿ç”¨è€…éœ€è¦å®ç°onConnectionæ–¹æ³•çš„callæ–¹æ³•ï¼Œå¦‚è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</t></t></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">String md5 = sql.executeOnConnection(<span class="keyword">new</span> OnConnection&lt;String&gt;()&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(Connection conn)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		CallableStatement cstmt = conn.prepareCall(<span class="string">"&#123; ? = call md5( ? ) &#125;"</span>);</div><div class="line">		<span class="comment">// å…¶ä»–ä»£ç </span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="3-6-å…¶ä»–"><a href="#3-6-å…¶ä»–" class="headerlink" title="3.6. å…¶ä»–"></a>3.6. å…¶ä»–</h4><h5 id="3-6-1-å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»"><a href="#3-6-1-å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»" class="headerlink" title="3.6.1. å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»"></a>3.6.1. å¼ºåˆ¶ä½¿ç”¨ä¸»æˆ–è€…ä»</h5><ul>
<li>public void useMaster(DBRunner f) DBRunneré‡Œçš„beetlsqlè°ƒç”¨å°†ä½¿ç”¨ä¸»æ•°æ®åº“åº“</li>
<li>public void useSlave(DBRunner f) DBRunneré‡Œçš„beetlsqlè°ƒç”¨å°†ä½¿ç”¨ä»æ•°æ®åº“åº“</li>
</ul>
<h5 id="3-6-2-ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ"><a href="#3-6-2-ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ" class="headerlink" title="3.6.2. ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ"></a>3.6.2. ç”ŸæˆPojoä»£ç å’ŒSQç‰‡æ®µ</h5><p>ç”¨äºå¼€å‘é˜¶æ®µæ ¹æ®è¡¨åæ¥ç”Ÿæˆpojoä»£ç å’Œç›¸åº”çš„sqlæ–‡ä»¶</p>
<ul>
<li>genPojoCodeToConsole(String table), æ ¹æ®è¡¨åç”Ÿæˆpojoç±»ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°.</li>
<li>genSQLTemplateToConsole(String table),ç”ŸæˆæŸ¥è¯¢ï¼Œæ¡ä»¶ï¼Œæ›´æ–°sqlæ¨¡æ¿ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li>
<li>genPojoCode(String table,String pkg,String srcPath,GenConfig config) æ ¹æ®è¡¨åï¼ŒåŒ…åï¼Œç”Ÿæˆè·¯å¾„ï¼Œè¿˜æœ‰é…ç½®ï¼Œç”Ÿæˆpojoä»£ç </li>
<li>genPojoCode(String table,String pkg,GenConfig config) åŒä¸Šï¼Œç”Ÿæˆè·¯å¾„è‡ªåŠ¨æ˜¯é¡¹ç›®srcè·¯å¾„ï¼Œæˆ–è€…src/main/java (å¦‚æœæ˜¯mavenå·¥ç¨‹)</li>
<li>genPojoCode(String table,String pkg),åŒä¸Šï¼Œé‡‡ç”¨é»˜è®¤çš„ç”Ÿæˆé…ç½®</li>
<li>genSQLFile(String table), åŒä¸Šï¼Œä½†è¾“å‡ºåˆ°å·¥ç¨‹ï¼Œæˆä¸ºä¸€ä¸ªsqlæ¨¡ç‰ˆ,sqlæ¨¡ç‰ˆæ–‡ä»¶çš„ä½ç½®åœ¨srcç›®å½•ä¸‹ï¼Œæˆ–è€…srcï¼mainï¼resourcesï¼ˆå¦‚æœæ˜¯mavenï¼‰å·¥ç¨‹.</li>
<li>genALL(String pkg,GenConfig config,GenFilter filter) ç”Ÿæˆæ‰€æœ‰çš„pojoä»£ç å’Œsqlæ¨¡ç‰ˆï¼Œ</li>
<li>genBuiltInSqlToConsole(Class z) æ ¹æ®ç±»æ¥ç”Ÿæˆå†…ç½®çš„å¢åˆ æ”¹æŸ¥sqlè¯­å¥ï¼Œå¹¶æ‰“å°åˆ°æ§åˆ¶å°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">sql.genAll(<span class="string">"com.test"</span>, <span class="keyword">new</span> GenConfig(), <span class="keyword">new</span> GenFilter()&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(String tableName)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(tableName.equalsIgnoreCase(<span class="string">"user"</span>))&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// return false</span></div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯pojoç±»åŒ…åï¼ŒGenConfigæ˜¯ç”Ÿæˆpojoçš„é…ç½®ï¼ŒGenFilter æ˜¯è¿‡æ»¤ï¼Œè¿”å›trueçš„æ‰ä¼šç”Ÿæˆã€‚å¦‚æœGenFilterä¸ºnullï¼Œåˆ™æ•°æ®åº“æ‰€æœ‰è¡¨éƒ½è¦ç”Ÿæˆ</p>
<blockquote>
<h4 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h4><p>  å¿…é¡»å½“å¿ƒè¦†ç›–ä½ æ‰ä½ åŸæ¥å†™å¥½çš„ç±»å’Œæ–¹æ³•ï¼Œä¸è¦è½»æ˜“ä½¿ç”¨genAllï¼Œå¦‚æœä½ ç”¨äº†ï¼Œæœ€å¥½ç«‹åˆ»å°†å…¶æ³¨é‡Šæ‰ï¼Œæˆ–è€…åœ¨genFilterå†™ä¸€äº›é€»è¾‘ä¿è¯ä¸ä¼šç”Ÿæˆæ‰€æœ‰çš„ä»£ç å¥½sqlæ¨¡æ¿æ–‡ä»¶</p>
</blockquote>
<h3 id="4-å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„"><a href="#4-å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„" class="headerlink" title="4. å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„"></a>4. å‘½åè½¬åŒ–ï¼Œè¡¨å’Œåˆ—åæ˜ å°„</h3><p>Beetlsql é»˜è®¤æä¾›äº†ä¸‰ç§åˆ—æ˜å’Œå±æ€§åçš„æ˜ å°„ç±»ï¼Œæ¨èä½¿ç”¨UnderlinedNameConversion</p>
<ul>
<li>DefaultNameConversion æ•°æ®åº“åå’Œjavaå±æ€§åä¿æŒä¸€è‡´ï¼Œå¦‚æ•°æ®åº“è¡¨Userï¼Œå¯¹åº”Javaç±»ä¹Ÿæ˜¯Userï¼Œæ•°æ®åº“åˆ—æ˜¯sysytemId,åˆ™javaå±æ€§ä¹Ÿæ˜¯systemIdï¼Œåä¹‹äº¦ç„¶</li>
<li>UnderlinedNameConversion å°†æ•°æ®åº“ä¸‹åˆ’çº¿å»æ‰ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œå¦‚æ•°æ®åº“æ˜¯SYS_USERï¼ˆoralceæ•°æ®åº“çš„è¡¨å’Œå±æ€§æ€»æ˜¯å¤§å†™çš„), åˆ™ä¼šæ”¹æˆSysUser</li>
<li>JPA2NameConversion æ”¯æŒJPAæ–¹å¼çš„æ˜ å°„ï¼Œé€‚åˆä¸èƒ½ç”¨ç¡®å®šçš„æ˜ å°„å…³ç³»(2.7.4ä»¥å‰é‡‡ç”¨JPANameConversionè¿‡äºç®€å•ï¼Œå·²ç»ä¸ç”¨äº†)</li>
<li>è‡ªå®šä¹‰å‘½åè½¬åŒ–ï¼Œå¦‚æœä»¥ä¸Š3ä¸ªéƒ½ä¸åˆé€‚,å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªå‘½åè½¬åŒ–ã€‚å®ç°DefaultNameConversionå®ç°æ–¹å¼</li>
<li>å› ä¸ºæ•°æ®åº“è¡¨å’Œåˆ—éƒ½å¿½ç•¥å¤§å°å†™åŒºåˆ«ï¼Œæ‰€ä»¥ï¼Œå®ç°NameConversionä¹Ÿä¸éœ€è¦è€ƒè™‘å¤§å°å†™</li>
</ul>
<p>ä¸€èˆ¬æ¥è®²ï¼Œéƒ½å»ºè®®æ•°æ®åº“ä»¥ä¸‹åˆ’çº¿æ¥åŒºåˆ†å•è¯ï¼Œå› æ­¤ï¼Œä½¿ç”¨UnderlinedNameConversionæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultNameConversion</span> <span class="keyword">extends</span> <span class="title">NameConversion</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTableName</span><span class="params">(Class&lt;?&gt; c)</span> </span>&#123;</div><div class="line">		Table table = (Table)c.getAnnotation(Table.class);</div><div class="line">		<span class="keyword">if</span>(table!=<span class="keyword">null</span>)&#123;</div><div class="line">			<span class="keyword">return</span> table.name();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> c.getSimpleName();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getColName</span><span class="params">(Class&lt;?&gt; c, String attrName)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> attrName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPropertyName</span><span class="params">(Class&lt;?&gt; c, String colName)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> colName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰ç‰¹æ®Šçš„è¡¨å¹¶ä¸ç¬¦åˆDefaultNameConversionå®ç°æ–¹å¼ï¼Œä½ å¯ä»¥é‡æ–°å®ç°ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•</p>
<p>åœ¨ä½¿ç”¨org.beetl.sql.core.JPA2NameConversionä½œä¸ºå‘½ä»¤è½¬åŒ–è§„åˆ™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹JPAæ ‡ç­¾æ¥å¸®åŠ©è§£æå®ä½“ç±»åˆ°æ•°æ®åº“çš„è½¬æ¢:</p>
<ul>
<li>javax.persistence.Table</li>
<li>javax.persistence.Column</li>
<li>javax.persistence.Transient</li>
</ul>
<p>è§„åˆ™å¦‚ä¸‹ï¼š<br>1 åœ¨ç±»åå‰ä½¿ç”¨Tableæ³¨è§£æ˜ å°„çš„è¡¨åï¼Œä¾‹å¦‚ï¼š@Table(name = â€œPF_TESTâ€)ï¼Œè¡¨ç¤ºæ˜ å°„çš„è¡¨åæ˜¯PF_TESTï¼›<br>2 å¿½ç•¥é™æ€å˜é‡ä»¥åŠè¢«@Transientæ³¨è§£çš„å±æ€§ï¼›<br>3 é»˜è®¤å±æ€§åä¸åº“è¡¨çš„å­—æ®µåä¿æŒä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨@Columnæ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Table</span>(name = <span class="string">"PF_TEST"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String S=<span class="string">"SSS"</span>;</div><div class="line">	<span class="meta">@Id</span></div><div class="line">  <span class="keyword">private</span> String id;</div><div class="line">	<span class="meta">@Column</span>(name = <span class="string">"login_name"</span>)</div><div class="line">    <span class="keyword">private</span> String loginName;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line">    <span class="keyword">private</span> Long ttSize;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] bigger;</div><div class="line">    <span class="keyword">private</span> String biggerClob;</div><div class="line">    <span class="meta">@Transient</span></div><div class="line">    <span class="keyword">private</span> String biggerStr;</div><div class="line">    <span class="meta">@AssignID</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line">    getter setter...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-å¤åˆä¸»é”®"><a href="#5-å¤åˆä¸»é”®" class="headerlink" title="5. å¤åˆä¸»é”®"></a>5. å¤åˆä¸»é”®</h3><p>beetlsql æ”¯æŒå¤åˆä¸»é”®ï¼Œæ— éœ€åƒå…¶ä»–daoå·¥å…·é‚£æ ·åˆ›å»ºä¸€ä¸ªç‰¹åˆ«çš„ä¸»é”®å¯¹è±¡ï¼Œä¸»é”®å¯¹è±¡å°±æ˜¯å®ä½“å¯¹è±¡æœ¬ç”Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`party`</span> (</div><div class="line">  <span class="string">`id1`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`id2`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id1`</span>,<span class="string">`id2`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1;</div></pre></td></tr></table></figure>
<p>Partyä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Party</span>  </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id1 ;</div><div class="line">	<span class="keyword">private</span> Integer id2 ;</div><div class="line">	<span class="keyword">private</span> String name ;</div><div class="line">	<span class="comment">//å¿½ç•¥å…¶ä»– getter setteræ–¹æ³•</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸»é”®è·å–Party</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Party key = <span class="keyword">new</span> Party();</div><div class="line">key.setId1(<span class="number">1</span>);</div><div class="line">key.setId2(<span class="number">2</span>);</div><div class="line">Party party = sql.unique(Party.class, key);</div></pre></td></tr></table></figure>
<h3 id="6-ä½¿ç”¨Mapper"><a href="#6-ä½¿ç”¨Mapper" class="headerlink" title="6. ä½¿ç”¨Mapper"></a>6. ä½¿ç”¨Mapper</h3><p>SQLManager æä¾›äº†æ‰€æœ‰éœ€è¦çŸ¥é“çš„APIï¼Œä½†é€šè¿‡sqlidæ¥è®¿é—®sqlæœ‰æ—¶å€™è¿˜æ˜¯å¾ˆéº»çƒ¦ï¼Œå› ä¸ºéœ€è¦æ‰‹æ•²å­—ç¬¦ä¸²ï¼Œå¦å¤–å‚æ•°ä¸æ˜¯mapå°±æ˜¯paraï¼Œå¯¹ä»£ç ç†è§£æ²¡æœ‰å¥½å¤„ï¼ŒBeetlSqlæ”¯æŒMapperï¼Œå°†sqlæ–‡ä»¶æ˜ å°„åˆ°ä¸€ä¸ªinterfaceã€‚å¦‚ä¸‹ç¤ºä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</div><div class="line">	<span class="comment">// ä½¿ç”¨"user.getCount"è¯­å¥,æ— å‚æ•°</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span>;</div><div class="line">	<span class="comment">//ä½¿ç”¨"user.setUserStatus" è¯­å¥</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserStatus</span><span class="params">(Map paras)</span></span>; <span class="comment">//æ›´æ–°ç”¨æˆ·çŠ¶æ€</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserAnnotherStatus</span><span class="params">(User user)</span></span>; <span class="comment">//æ›´æ–°ç”¨æˆ·çŠ¶æ€</span></div><div class="line">	<span class="comment">//ä½¿ç”¨"user.findById", ä¼ å…¥å‚æ•°id</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(@Param(<span class="string">"id"</span>)</span> Integer id)</span>;</div><div class="line">	<span class="comment">//or ä½¿ç”¨paramsï¼Œä¸€ä¸€å¯¹åº”</span></div><div class="line">	<span class="meta">@SqlStatement</span>(params=<span class="string">"id,status"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findByIdAndStatus</span><span class="params">( Integer id,Integer status)</span></span>;</div><div class="line">	<span class="comment">//ç¿»é¡µæŸ¥è¯¢ï¼Œä½¿ç”¨"user.queryNewUser"</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryNewUser</span><span class="params">(PageQuery query)</span> </span>;</div><div class="line">	<span class="comment">// ä½¿ç”¨_st,_sz ç¿»é¡µ</span></div><div class="line">	<span class="meta">@SqlStatement</span>(params=<span class="string">"name,age,_st,_sz"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUser</span><span class="params">( String name, Integer age,<span class="keyword">int</span> start, <span class="keyword">int</span> size)</span></span>;</div><div class="line">	<span class="comment">//ä½¿ç”¨sqlready</span></div><div class="line">	<span class="meta">@Sql</span>(value=<span class="string">" update user set age = ? where id = ? "</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAge</span><span class="params">(<span class="keyword">int</span> age,<span class="keyword">int</span> id)</span></span>;</div><div class="line"></div><div class="line">	<span class="meta">@Sql</span>(value=<span class="string">" select name from user"</span>,returnType=String.class)</div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">allNames</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>Interface å¯ä»¥ç»§æ‰¿BaseMapperï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨BaseMapperçš„ä¸€äº›å…¬å…±æ–¹æ³•ï¼Œå¦‚insertï¼Œunqiue,single,updateById,deleteByIdç­‰ï¼Œä¹Ÿå¯ä»¥ä¸ç»§æ‰¿</p>
</li>
<li><p>Interfaceé‡Œçš„æ–¹æ³•åä¸Sqlæ–‡ä»¶å¯¹åº”ï¼Œå¦‚æœæ–¹æ³•åå¯¹åº”é”™äº†ï¼Œä¼šåœ¨è°ƒç”¨çš„æ—¶å€™æŠ¥é”™æ‰¾ä¸åˆ°sqlã€‚</p>
</li>
<li><p>æ–¹æ³•å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªObject,æˆ–è€…æ˜¯Mapï¼Œè¿™æ ·ï¼ŒBeetlSql è‡ªåŠ¨è¯†åˆ«ä¸º sqlçš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£@Paramæ¥æ ‡æ³¨ï¼Œæˆ–è€…æ··åˆè¿™ä¿©ç§æƒ…å†µ å¦‚:</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserStatus</span><span class="params">(Map paras,@Param(<span class="string">"name"</span>)</span> String name)</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–¹æ³•å¦‚æœæ˜¯æŸ¥è¯¢è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨@RowStartï¼Œ@RowSize ä½œä¸ºç¿»é¡µå‚æ•°ï¼ŒBeetlSQLå°†è‡ªåŠ¨å®Œæˆç¿»é¡µåŠŸèƒ½</p>
<p>æ³¨æ„ BeetlSQL ä¼šæ ¹æ® å¯¹åº”çš„æ–¹æ³•å¯¹åº”çš„SQLè¯­å¥ï¼Œè§£æå¼€å¤´ï¼Œå¦‚æœæ˜¯selectå¼€å¤´ï¼Œå°±è®¤ä¸ºæ˜¯selectæ“ä½œï¼ŒåŒç†è¿˜æœ‰updateï¼Œdeleteï¼Œinsertã€‚å¦‚æœsql æ¨¡æ¿ä¸æ˜¯ä»¥è¿™äº›å…³é”®å­—å¼€å¤´ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ³¨è§£ @SqlStatement</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SqlStatement</span>(type=SqlStatementType.INSERT)</div><div class="line"><span class="function"><span class="keyword">public</span> KeyHolder <span class="title">newUser</span><span class="params">(User user)</span></span>;<span class="comment">// æ·»åŠ ç”¨æˆ·</span></div></pre></td></tr></table></figure>
<p>SqlStatement ä¹Ÿå¯åœ¨paramsç”³æ˜å‚æ•°åç§°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUser</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name,@<span class="title">Param</span><span class="params">(<span class="string">"age"</span>)</span> Integer age,@RowStart <span class="keyword">int</span> start,@RowSize <span class="keyword">int</span> size)</span>;</div><div class="line"><span class="comment">// or</span></div><div class="line"><span class="meta">@SqlStatement</span>(params=<span class="string">"name,age,_st,_se"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUser</span><span class="params">(String name,Integer age,<span class="keyword">int</span> start,<span class="keyword">int</span> size)</span></span>;</div></pre></td></tr></table></figure>
<ul>
<li>æŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯Listï¼Œåˆ™å¯¹åº”SQLManager.select</li>
<li>æŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯Pojoï¼ŒåŸå§‹ç±»å‹ç­‰éListç±»å‹ï¼Œåˆ™å¯¹åº”çš„SQLManager.selectSignleï¼Œå¦‚ä¸Šé¢çš„getCount</li>
<li>insert è¯­å¥ å¦‚æœæœ‰KeyHolderï¼Œåˆ™è¡¨ç¤ºéœ€è¦è·å–ä¸»é”®ï¼Œå¯¹åº”SQLManager.insert(â€¦â€‹.,keyHolder)æ–¹æ³•</li>
<li>å‚æ•°åˆ—è¡¨é‡Œåªå…è®¸æœ‰ä¸€ä¸ªPojoæˆ–è€…Mapï¼Œä½œä¸ºæŸ¥è¯¢å‚æ•°_rootï¼Œå¦åˆ™ï¼Œéœ€è¦åŠ ä¸Š@Param</li>
<li>å‚æ•°åˆ—è¡¨é‡Œå¦‚æœæœ‰List æˆ–è€…Map[],åˆ™æœŸæœ›å¯¹åº”çš„æ˜¯ä¸€ä¸ªupdateBatchæ“ä½œ</li>
<li>å‚æ•°åˆ—è¡¨é‡Œå¦‚æœ@RowStart ,@RowSize,åˆ™è®¤ä¸ºæ˜¯ç¿»é¡µè¯­å¥</li>
<li>å‚æ•°é‡Œå¦‚æœæœ‰PageQuery,åˆ™è®¤ä¸ºæ˜¯ç¿»é¡µæŸ¥è¯¢</li>
<li>åœ¨æŸ¥è¯¢ä¸­ï¼Œè¿”å›çš„æ˜¯Listï¼Œä½†ç±»å‹éMapperæŒ‡å®šçš„ç±»å‹ï¼Œæ— è®ºæ˜¯ç”¨@Sql ,è¿˜æ˜¯ @SqlStatementï¼Œéœ€è¦ç”¨returnTypeæ¥è¯´æ˜ï¼Œå¦‚ä¸Šä¾‹å­allNames è¿”å›ä¸€ä¸ªList<string>è€Œä¸æ˜¯List<user>,å› æ­¤éœ€è¦ä½¿ç”¨returnTypeåšé¢å¤–è¯´æ˜</user></string></li>
</ul>
<p>Mapper ä¹Ÿæ”¯æŒä½¿ç”¨JDBC SQLï¼Œè¿™æ—¶å€™éœ€è¦é‡‡ç”¨Sqlæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Sql</span>(value=<span class="string">" update user set age = ? where id = ? "</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAge</span><span class="params">(<span class="keyword">int</span> age,<span class="keyword">int</span> id)</span></span>;</div><div class="line"><span class="meta">@Sql</span>(<span class="string">"select * from user  "</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨Mapperèƒ½å¢åŠ Daoç»´æŠ¤æ€§ï¼Œå¹¶èƒ½æé«˜å¼€å‘æ•ˆç‡ï¼Œå»ºè®®åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p>å¯¹äºMapperæ¶‰åŠçš„æŸ¥è¯¢æ¥è¯´ï¼Œä¼šå°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°è¿”å›å€¼ä¸Šï¼Œæœ‰å¦‚ä¸‹è§„åˆ™</p>
<ul>
<li>Mapperæ–¹æ³•å¾—è¿”å›å€¼åº”è¯¥æŸ¥è¯¢ç»“æœå¯¹åº”ï¼Œå¦‚æŸ¥è¯¢ç»“æœæ˜¯æ—¥æœŸï¼Œæ–¹æ³•è¿”å›å€¼ä¹Ÿåº”è¯¥æ˜¯æ—¥æœŸï¼ˆDateæˆ–è€…Timestamp)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä¸éœ€è¦æ³¨è§£è¯´æ˜è¿”å›ç±»å‹</span></div><div class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getMaxDate</span><span class="params">(User query)</span></span>;</div><div class="line"></div><div class="line"><span class="meta">@SqlStatement</span>(returnType=Date.class)</div><div class="line"><span class="function"><span class="keyword">public</span> List&lt;Date&gt; <span class="title">getTop10Date</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœè¿”å›å€¼æ˜¯Listï¼Œå¦‚å®ä½“æœ¬èº«é›†åˆï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨æ³¨è§£çš„returnTypeæ¥è¯´æ˜ï¼Œè¿™æ˜¯é»˜è®¤æƒ…å†µ</p>
</li>
<li><p>å¦‚æœè¿”å›çš„å€¼æ˜¯Listï¼Œä½†æ˜¯å…¶ä»–ç±»å‹é›†åˆï¼Œåˆ™éœ€è¦ä½¿ç”¨returnTypeæ¥è¯´æ˜è¿”å›ç±»å‹</p>
</li>
<li><p>ç¿»é¡µæŸ¥è¯¢PageQuery ä¸éœ€è¦åšç±»å‹è¯´æ˜ï¼Œé»˜è®¤è¿”å›å°±æ˜¯å®ä½“æœ¬èº«ï¼Œå¦‚æœè¿”å›çš„æ˜¯å…¶ä»–ç±»å‹ï¼Œä¹Ÿéœ€è¦åœ¨returnTypeåŠ ä»¥è¯´æ˜</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ç¿»é¡µæŸ¥è¯¢ï¼Œé»˜è®¤è¿”å›å®ä½“å¯¹è±¡</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryUser</span><span class="params">(PageQuery query)</span></span>;</div></pre></td></tr></table></figure>
<h3 id="7-BeetlSQL-Annotation"><a href="#7-BeetlSQL-Annotation" class="headerlink" title="7. BeetlSQL Annotation"></a>7. BeetlSQL Annotation</h3><p>å¯¹äºè‡ªåŠ¨ç”Ÿæˆçš„sqlï¼Œé»˜è®¤ä¸éœ€è¦ä»»ä½•annotatonï¼Œç±»åå¯¹åº”äºè¡¨åï¼ˆé€šè¿‡NameConverstionç±»ï¼‰ï¼Œgetteræ–¹æ³•çš„å±æ€§åå¯¹åº”äºåˆ—æ˜ï¼ˆä¹Ÿæ˜¯é€šè¿‡NameConverstionç±»ï¼‰ï¼Œä½†æœ‰äº›æƒ…å†µè¿˜æ˜¯éœ€è¦anntationã€‚</p>
<h4 id="7-1-AutoID-å’Œ-AssignID-ï¼Œ-SeqID"><a href="#7-1-AutoID-å’Œ-AssignID-ï¼Œ-SeqID" class="headerlink" title="7.1. @AutoID å’Œ @AssignID ï¼Œ@SeqID"></a>7.1. @AutoID å’Œ @AssignID ï¼Œ@SeqID</h4><ul>
<li>@AutoID,ä½œç”¨äºgetteræ–¹æ³•ï¼Œå‘Šè¯‰beetlsqlï¼Œè¿™æ˜¯è‡ªå¢ä¸»é”®,å¯¹åº”äºæ•°æ®è‡ªå¢é•¿</li>
<li>@AssignIDï¼Œä½œç”¨äºgetteræ–¹æ³•ï¼Œå‘Šè¯‰beetlsqlï¼Œè¿™æ˜¯ç¨‹åºè®¾å®š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@AssignID</span>()</div><div class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç è®¾å®šä¸»é”®å…è®¸åƒ@AssignID ä¼ å…¥idçš„ç”Ÿæˆç­–ç•¥ä»¥è‡ªåŠ¨ç”Ÿæˆåºåˆ—ï¼Œbeetlé»˜è®¤æä¾›äº†ä¸€ä¸ªsnowflakeç®—æ³•ï¼Œä¸€ä¸ªç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒçš„idç”Ÿæˆå™¨(<a href="https://github.com/twitter/snowflake" target="_blank" rel="external">https://github.com/twitter/snowflake</a>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@AssignID</span>(<span class="string">"simple"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>simple æ˜¯beetlsqlæä¾›çš„ä¸€ä¸ªé»˜è®¤çš„snowflakeå®ç°ï¼Œä½ å¯ä»¥é€šè¿‡sqlManagerè‡ªå·±æ³¨å†Œidç”Ÿæˆå™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sqlManager.addIdAutonGen(<span class="string">"uuid2"</span>, <span class="keyword">new</span> IDAutoGen()&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">nextID</span><span class="params">(String params)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"hi"</span>+<span class="keyword">new</span> Random().nextInt(<span class="number">10000</span>);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@AssignID</span>(<span class="string">"uuid2"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>@SeqID(name=â€xx_seqâ€ï¼Œä½œç”¨äºgetteræ–¹æ³•ï¼Œå‘Šè¯‰beetlsqlï¼Œè¿™æ˜¯åºåˆ—ä¸»é”®ã€‚</li>
</ul>
<p>å¯¹äºå±æ€§åä¸ºidçš„è‡ªå¢ä¸»é”®ï¼Œä¸éœ€è¦åŠ annotationï¼Œbeetlsqlé»˜è®¤å°±æ˜¯@AutoID</p>
<blockquote>
<h4 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h4><ul>
<li>å¯¹äºæ”¯æŒå¤šç§æ•°æ®åº“çš„ï¼Œè¿™äº›annotationå¯ä»¥å åŠ åœ¨ä¸€èµ·</li>
</ul>
</blockquote>
<h4 id="7-2-Tail"><a href="#7-2-Tail" class="headerlink" title="7.2. @Tail"></a>7.2. @Tail</h4><p>@Tailä½œç”¨äºç±»ä¸Šï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯æ··åˆæ¨¡å‹ï¼Œå‚è€ƒä¸‹ä¸€ç« æ··åˆæ¨¡å‹,sqlæŸ¥è¯¢æ— æ³•åœ¨pojoæ˜ å°„çš„åˆ—æˆ–è€…ç»“æœé›†å°†ä½¿ç”¨TailæŒ‡å®šçš„æ–¹æ³•</p>
<h4 id="7-3-ColumnIgnore"><a href="#7-3-ColumnIgnore" class="headerlink" title="7.3. @ColumnIgnore"></a>7.3. @ColumnIgnore</h4><p>åœ¨beetlsql å†…ç½®çš„insertæˆ–è€…updateæ–¹æ³•çš„æ—¶å€™ï¼Œä½¿ç”¨æ­¤æ³¨è§£çš„å­—æ®µï¼ˆä½œç”¨äºgetteræ–¹æ³•ï¼‰å°†æ ¹æ®æ³¨è§£çš„å±æ€§æ¥å†³å®šæ˜¯å¦å¿½ç•¥æ­¤å­—æ®µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ColumnIgnore</span>(insert=<span class="keyword">true</span>,update=<span class="keyword">false</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getBir</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span>  bir;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä¾‹å­ï¼Œæ’å…¥çš„æ—¶å€™å¿½ç•¥birå±æ€§ï¼ˆå¾€å¾€æ˜¯å› ä¸ºæ•°æ®åº“æŒ‡å®šäº†é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´ï¼‰ï¼Œæ›´æ–°çš„æ—¶å€™ä¸èƒ½å¿½ç•¥ @ColumnIgnoreçš„inserté»˜è®¤æ˜¯trueï¼Œupdateæ˜¯falseï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ @ColumnIgnore()</p>
<h4 id="7-4-EnumMapping"><a href="#7-4-EnumMapping" class="headerlink" title="7.4. @EnumMapping"></a>7.4. @EnumMapping</h4><p>å¯¹äºEntityä½¿ç”¨äº†æšä¸¾ä½œä¸ºå±æ€§å€¼ï¼Œå¯ä»¥å†æšä¸¾ç±»ä¸Šå®šä¹‰EnumMappingï¼ŒæŒ‡å‡ºå¦‚ä½•å°†æšä¸¾ä¸æ•°æ®åº“å€¼äº’ç›¸è½¬åŒ–ï¼Œæœ‰å››ç§æ–¹æ³•</p>
<ul>
<li>å¦‚æœæ²¡æœ‰ä½¿ç”¨@EnumMappingï¼Œåˆ™ä½¿ç”¨æšä¸¾çš„åç§°ä½œä¸ºå±æ€§</li>
<li>@EnumMapping(EnumMapping.EnumType.STRING) åŒä¸Šï¼Œä½¿ç”¨æšä¸¾åç§°ä½œä¸ºå±æ€§ï¼Œæ•°æ®åº“å¯¹åº”åˆ—åº”è¯¥æ˜¯å­—ç¬¦åˆ—</li>
<li>@EnumMapping(EnumMapping.EnumType.ORDINAL) ä½¿ç”¨æšä¸¾çš„é¡ºåºä½œä¸ºå±æ€§ï¼Œæ•°æ®åº“å¯¹åº”åˆ—åº”è¯¥æ˜¯intç±»å‹ï¼Œç”¨æ­¤ä½œä¸ºæ˜ å°„éœ€è¦é˜²æ­¢é‡æ„æšä¸¾çš„æ—¶å€™å¯¼è‡´æ•°æ®åº“ä¹Ÿé‡æ„ï¼Œåº”è¯¥æ…ç”¨</li>
<li>@EnumMapping(â€œxxxâ€)ï¼Œå¦‚æœä¸æ˜¯ä¸Šé¢çš„çš„å®šä¹‰ï¼Œåˆ™beetlsqlä¼šæŸ¥æ‰¾æšä¸¾ç±»çš„xxxå±æ€§ï¼Œç”¨è¿™ä¸ªå€¼ä½œä¸ºå±æ€§ï¼Œæ¯”å¦‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnumMapping</span>(<span class="string">"value"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Color &#123;</div><div class="line">	RED(<span class="string">"RED"</span>,<span class="number">1</span>),BLUE (<span class="string">"BLUE"</span>,<span class="number">2</span>);</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Color</span><span class="params">(String name, <span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.name = name;</div><div class="line">	    <span class="keyword">this</span>.value = value;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> value;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>beetlsq ä¼šè·å–æšä¸¾çš„valueå±æ€§ï¼ˆè°ƒç”¨getValue)æ¥è·å–æšä¸¾å±æ€§å€¼</p>
<h4 id="7-5-Table"><a href="#7-5-Table" class="headerlink" title="7.5. @Table"></a>7.5. @Table</h4><p>æ ‡ç­¾ @Table(name=â€xxxxâ€) å‘Šè¯‰beetlsqlï¼Œæ­¤ç±»å¯¹åº”xxxxè¡¨ã€‚æ¯”å¦‚æ•°æ®åº“æœ‰Userè¡¨ï¼ŒUserç±»å¯¹åº”äºUserè¡¨ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªUserQueryå¯¹è±¡ï¼Œä¹Ÿå¯¹åº”äºUserè¡¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Table</span>(name=<span class="string">"user"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryUser</span> ..</span></div></pre></td></tr></table></figure>
<p>æ³¨ï¼šå¯ä»¥ä¸ºå¯¹è±¡æŒ‡å®šä¸€ä¸ªæ•°æ®åº“shcemaï¼Œå¦‚name=â€cms.userâ€,æ­¤æ—¶å°†è®¿é—®cmsåº“ï¼ˆæˆ–è€…cmsç”¨æˆ·ï¼Œå¯¹ä¸åŒçš„æ•°æ®åº“ï¼Œç§°è°“ä¸ä¸€æ ·ï¼‰ä¸‹çš„useræ•°æ®è¡¨</p>
<h4 id="7-6-TableTemplate"><a href="#7-6-TableTemplate" class="headerlink" title="7.6. @TableTemplate"></a>7.6. @TableTemplate</h4><ul>
<li>@TableTemplate() ç”¨äºæ¨¡æ¿æŸ¥è¯¢ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•å€¼ï¼Œå°†æŒ‰ç…§ä¸»é”®é™åºæ’ï¼Œä¹Ÿå°±æ˜¯order by ä¸»é”®åç§° desc</li>
<li>@DateTemplate()ï¼Œä½œç”¨äºæ—¥æœŸå­—æ®µçš„getteræ–¹æ³•ä¸Šï¼Œæœ‰ä¿©ä¸ªå±æ€§accept å’Œ compare æ–¹æ³•ï¼Œåˆ†åˆ«è¡¨ç¤º æ¨¡æ¿æŸ¥è¯¢ä¸­ï¼Œæ—¥æœŸå­—æ®µå¦‚æœä¸ä¸ºç©ºï¼Œæ‰€åœ¨çš„æ—¥æœŸèŒƒå›´ï¼Œå¦‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@DateTemplate</span>(accept=<span class="string">"minDate,maxDate"</span>,compare=<span class="string">"&gt;=,&lt;"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨æ¨¡æ¿æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°†ä¼šç¿»è¯‘æˆ</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@if(!isEmpty(minDate))&#123;</div><div class="line"> and date&gt;=#minDate#</div><div class="line">@&#125;</div><div class="line">@if(!isEmpty(maxDate))&#123;</div><div class="line"> and date&lt;#maxDate#</div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<blockquote>
<h4 id="æ³¨æ„-2"><a href="#æ³¨æ„-2" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  minDate,maxDate æ˜¯ä¿©ä¸ªé¢å¤–çš„å˜é‡,éœ€è¦å®šä¹‰åˆ°pojoç±»é‡Œï¼ŒDateTemplateä¹Ÿå¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœ@DateTemplate()ï¼Œç›¸å½“äº@DateTemplate(accept=â€minæ—¥æœŸå­—æ®µ,maxæ—¥æœŸå­—æ®µâ€,compare=â€&gt;=,&lt;â€)</p>
</blockquote>
<h4 id="7-7-Mapperç›¸å…³æ³¨è§£"><a href="#7-7-Mapperç›¸å…³æ³¨è§£" class="headerlink" title="7.7. Mapperç›¸å…³æ³¨è§£"></a>7.7. Mapperç›¸å…³æ³¨è§£</h4><p>Mapper æ˜¯å°†sqlæ¨¡æ¿æ–‡ä»¶æ˜ å°„æˆä¸€ä¸ªå…·ä½“çš„Daoæ–¹æ³•ç±»,è¿™æ ·æ–¹ä½ä»£ç å¼€å‘å’Œç»´æŠ¤</p>
<p>Mapperä¸­çš„æ³¨è§£ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„    SqlStatement ï¼ŒSqlStatementType ï¼ŒSql,Param è¿˜æœ‰ä¸å¸¸ç”¨çš„ RowSize ï¼ŒRowStartï¼Œå…·ä½“å‚è€ƒMapper</p>
<h4 id="7-8-ORMQuery"><a href="#7-8-ORMQuery" class="headerlink" title="7.8. ORMQuery"></a>7.8. ORMQuery</h4><p>beetlsql æ”¯æŒåœ¨å®ä½“ç±»ä¸Šå¢åŠ ORMQueryæ³¨è§£,è¿™æ ·å¯¹äºå®ä½“çš„æŸ¥è¯¢,ä¼šè§¦å‘æ‡’åŠ è½½,ä»è€Œå®ç°ORM æŸ¥è¯¢åŠŸèƒ½,å…·ä½“å‚è€ƒORM æŸ¥è¯¢ä¸€ç« </p>
<h3 id="8-BeetlSQL-æ•°æ®æ¨¡å‹"><a href="#8-BeetlSQL-æ•°æ®æ¨¡å‹" class="headerlink" title="8. BeetlSQL æ•°æ®æ¨¡å‹"></a>8. BeetlSQL æ•°æ®æ¨¡å‹</h3><p>BeetlSQLæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½DAOå·¥å…·ï¼Œæ”¯æŒçš„æ¨¡å‹ä¹Ÿå¾ˆå…¨é¢ï¼ŒåŒ…æ‹¬</p>
<ul>
<li>Pojo, ä¹Ÿå°±æ˜¯é¢å‘å¯¹è±¡Java Objecã€‚Beetlsqlæ“ä½œå°†é€‰å–Pojoeå±æ€§å’Œsqlåˆ—çš„äº¤é›†ã€‚é¢å¤–å±æ€§å’Œé¢å¤–åˆ—å°†å¿½ç•¥.</li>
<li>Map/List, å¯¹äºä¸€äº›æ•æ·å¼€å‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Map/List ä½œä¸ºè¾“å…¥è¾“å‡ºå‚æ•°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;Map&lt;String,Object&gt;&gt; list = sqlManager.select(<span class="string">"user.find"</span>,Map.class,paras);</div></pre></td></tr></table></figure>
<ul>
<li>æ··åˆæ¨¡å‹ï¼Œæ¨èä½¿ç”¨æ··åˆæ¨¡å‹ã€‚å…¼å…·çµæ´»æ€§å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ã€‚Pojoå¯ä»¥å®ç°Tailï¼ˆå°¾å·´çš„æ„æ€)ï¼Œæˆ–è€…ç»§æ‰¿TailBeanï¼Œè¿™æ ·æŸ¥è¯¢å‡ºçš„ResultSet é™¤äº†æŒ‰ç…§pojoè¿›è¡Œæ˜ å°„å¤–ï¼Œæ— æ³•æ˜ å°„çš„å€¼å°†æŒ‰ç…§åˆ—è¡¨/å€¼ä¿å­˜ã€‚å¦‚ä¸‹ä¸€ä¸ªæ··åˆæ¨¡å‹:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*æ··åˆæ¨¡å‹*/</span></div><div class="line"><span class="keyword">public</span> User extends TailBean&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id ;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> roleId;</div><div class="line">	<span class="comment">/*ä»¥ä¸‹æ˜¯getterå’Œsetter æ–¹æ³•*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹äºsqlè¯­å¥:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="section">selectUser</span></div><div class="line">===</div><div class="line">select u.*,r.name r_name from user u left join role r on u.roleId=r.id .....</div></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">List&lt;User&gt; list = sqlManager.select(<span class="string">"user.selectUser"</span>,User.class,paras);</div><div class="line"><span class="keyword">for</span>(User user:list)&#123;</div><div class="line">	System.out.println(user.getId());</div><div class="line">	System.out.println(user.get(<span class="string">"rName"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¨‹åºå¯ä»¥é€šè¿‡getæ–¹æ³•è·å–åˆ°æœªè¢«æ˜ å°„åˆ°pojoçš„å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨æ¨¡æ¿é‡Œç›´æ¥ ${user.rName} æ˜¾ç¤ºï¼ˆå¯¹äºå¤§å¤šæ•°æ¨¡æ¿å¼•æ“éƒ½æ”¯æŒï¼‰</p>
<p>å¦å¤–ä¸€ç§æ›´è‡ªç”±çš„å®ç°æ··åˆæ¨¡å‹çš„æ–¹æ³•æ˜¯åœ¨ç›®æ ‡Pojoä¸Šé‡‡ç”¨æ³¨è§£@Tailï¼Œå¦‚æœæ³¨è§£ä¸å¸¦å‚æ•°ï¼Œåˆ™é»˜è®¤ä¼šè°ƒç”¨set(String,Object) æ–¹æ³•æ¥æ”¾ç½®é¢å¤–çš„æŸ¥è¯¢å±æ€§ï¼Œå¦åˆ™ï¼Œä¾æ®æ³¨è§£çš„setå‚æ•°æ¥ç¡®å®šè°ƒç”¨æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Tail</span>(set=<span class="string">"addValue"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id ;</div><div class="line">	<span class="keyword">private</span> Integer age ;</div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">addValue</span><span class="params">(String str,Object ok)</span></span>&#123;</div><div class="line">		ext.put(str, ok);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="9-Markdownæ–¹å¼ç®¡ç†"><a href="#9-Markdownæ–¹å¼ç®¡ç†" class="headerlink" title="9. Markdownæ–¹å¼ç®¡ç†"></a>9. Markdownæ–¹å¼ç®¡ç†</h3><p>BeetlSQLé›†ä¸­ç®¡ç†SQLè¯­å¥ï¼ŒSQL å¯ä»¥æŒ‰ç…§ä¸šåŠ¡é€»è¾‘æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ–‡ä»¶åçš„æ‰©å±•åæ˜¯mdæˆ–è€…sqlã€‚å¦‚Userå¯¹è±¡æ”¾åˆ°user.md æˆ–è€… user.sqlé‡Œï¼Œæ–‡ä»¶å¯ä»¥æŒ‰ç…§æ¨¡å—é€»è¾‘æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹ã€‚æ–‡ä»¶æ ¼å¼æŠ›å¼ƒäº†XMLæ ¼å¼ï¼Œé‡‡ç”¨äº†Markdownï¼ŒåŸå› æ˜¯</p>
<ul>
<li>XMLæ ¼å¼è¿‡äºå¤æ‚ï¼Œä¹¦å†™ä¸æ–¹ä¾¿</li>
<li>XML æ ¼å¼æœ‰ä¿ç•™ç¬¦å·ï¼Œå†™SQLçš„æ—¶å€™ä¹Ÿä¸æ–¹ä¾¿ï¼Œå¦‚å¸¸ç”¨çš„&lt; ç¬¦å· å¿…é¡»è½¬ä¹‰</li>
<li>MD æ ¼å¼æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£æ ¼å¼ï¼Œä¹Ÿå®¹æ˜“é€šè¿‡æµè§ˆå™¨é˜…è¯»å’Œç»´æŠ¤</li>
</ul>
<p>ç›®å‰SQLæ–‡ä»¶æ ¼å¼éå¸¸ç®€å•ï¼Œä»…ä»…æ˜¯sqlId å’Œsqlè¯­å¥æœ¬èº«ï¼Œå¦‚ä¸‹</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">æ–‡ä»¶ä¸€äº›è¯´æ˜ï¼Œæ”¾åœ¨å¤´éƒ¨å¯æœ‰å¯æ— ï¼Œå¦‚æœæœ‰è¯´æ˜ï¼Œå¯ä»¥æ˜¯ä»»æ„æ–‡å­—</div><div class="line"><span class="section">SQLæ ‡ç¤º</span></div><div class="line">===</div><div class="line">ä»¥*å¼€å¤´çš„æ³¨é‡Š</div><div class="line">SQLè¯­å¥</div><div class="line"></div><div class="line"><span class="section">SQLæ ‡ç¤º2</span></div><div class="line">===</div><div class="line">SQLè¯­å¥ 2</div></pre></td></tr></table></figure>
<p>æ³¨æ„:SQLè¯­å¥ä»2.7.10ç‰ˆæœ¬å sqléƒ¨åˆ†ä¹Ÿå¯ä»¥åŒ…å«åœ¨markdow çš„<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">æ‰€æœ‰SQLæ–‡ä»¶å»ºè®®æ”¾åˆ°ä¸€ä¸ªsqlç›®å½•ï¼Œsqlç›®å½•æœ‰å¤šä¸ªå­ç›®å½•ï¼Œè¡¨ç¤ºæ•°æ®åº“ç±»å‹ï¼Œè¿™æ˜¯å…¬å…±SQLè¯­å¥æ”¾åˆ°sqlç›®å½•ä¸‹ï¼Œç‰¹å®šæ•°æ®åº“çš„sqlè¯­å¥æ”¾åˆ°å„è‡ªè‡ªç›®å½•ä¸‹ å½“ç¨‹åºè·å–SQLè¯­å¥å¾—æ—¶å€™ï¼Œå…ˆä¼šæ ¹æ®æ•°æ®åº“æ‰¾ç‰¹å®šæ•°æ®åº“ä¸‹çš„sqlè¯­å¥ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œä¼šå¯»æ‰¾sqlä¸‹çš„ã€‚å¦‚ä¸‹ä»£ç </div><div class="line"></div><div class="line">```java</div><div class="line">List&lt;User&gt; list = sqlManager.select(&quot;user.select&quot;,User.class);</div></pre></td></tr></table></figure></p>
<p>SqlManager ä¼šæ ¹æ®å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå…ˆæ‰¾sql/mysql/user.md æ–‡ä»¶ï¼Œç¡®è®¤æ˜¯å¦æœ‰selectè¯­å¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šå¯»æ‰¾sql/user.md</p>
<blockquote>
<h4 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨"></a>æ³¨</h4><ul>
<li>æ³¨é‡Šæ˜¯ä»¥* å¼€å¤´ï¼Œæ³¨é‡Šè¯­å¥ä¸ä½œä¸ºsqlè¯­å¥</li>
<li>é»˜è®¤çš„ClasspathLoaderé‡‡ç”¨äº†è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥å®ç°SQLLoaderæ¥å®ç°è‡ªå·±çš„æ ¼å¼å’Œsqlå­˜å‚¨æ–¹å¼ï¼Œå¦‚æ•°æ®åº“å­˜å‚¨</li>
</ul>
</blockquote>
<h3 id="10-SQL-æ³¨é‡Š"><a href="#10-SQL-æ³¨é‡Š" class="headerlink" title="10. SQL æ³¨é‡Š"></a>10. SQL æ³¨é‡Š</h3><p>å¯¹äºé‡‡ç”¨Markdownæ–¹å¼ï¼Œå¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼å¯¹sqlæ³¨é‡Šã€‚</p>
<ul>
<li>é‡‡ç”¨sql è‡ªå·±çš„æ³¨é‡Šç¬¦å·ï¼Œâ€â€“ â€œ ,ä¼˜ç‚¹æ˜¯é€‚åˆjavaå’Œæ•°æ®åº“sqlä¹‹é—´äº’ç›¸è¿ç§»ï¼Œå¦‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span></div><div class="line"><span class="comment">--  status ä»£è¡¨çŠ¶æ€</span></div><div class="line">statu = <span class="number">1</span></div></pre></td></tr></table></figure>
<ul>
<li>é‡‡ç”¨beetlæ³¨é‡Š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span></div><div class="line">@ <span class="comment">/* è¿™äº›sqlè¯­å¥è¢«æ³¨é‡Šæ‰</span></div><div class="line">statu = 1</div><div class="line">@ */</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨sqlId çš„=== ç´§æŒ¨ç€çš„ä¸‹ä¸€è¡Œ åé¢è¿ç»­ä½¿ç”¨â€œ*â€ä½œä¸ºsqlæ•´ä¸ªè¯­å¥æ³¨é‡Š</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section">selectByUser</span></div><div class="line">==</div><div class="line"><span class="bullet">* </span>è¿™ä¸ªsqlè¯­å¥ç”¨æ¥æŸ¥è¯¢ç”¨æˆ·çš„</div><div class="line"><span class="bullet">* </span>status =1 è¡¨ç¤ºæŸ¥æ‰¾æœ‰æ•ˆç”¨æˆ·</div><div class="line"></div><div class="line">select * from user where status = 1</div></pre></td></tr></table></figure>
<h3 id="11-é‡è¦-é…ç½®beetlsql"><a href="#11-é‡è¦-é…ç½®beetlsql" class="headerlink" title="11. (é‡è¦) é…ç½®beetlsql"></a>11. (é‡è¦) é…ç½®beetlsql</h3><p>beetlsql é…ç½®æ–‡ä»¶æ˜¯ btsql-ext.propertiesï¼Œä½äºclasspath æ ¹ç›®å½•ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ­¤æ–‡ä»¶ï¼Œbeetlsqlå°†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤é…ç½®ï¼Œå¦‚ <em> æ˜¯å¼€å‘æ¨¡å¼ï¼Œbeetlsqlæ¯æ¬¡è¿è¡Œsqléƒ½ä¼šæ£€æµ‹sqlæ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼Œå¹¶é‡æ–°åŠ è½½ </em> å­—ç¬¦é›†ï¼Œæ˜¯ç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦é›† * ç¿»é¡µé»˜è®¤æ€»æ˜¯ä»1å¼€å§‹ï¼Œå¯¹äºoralceæ•°æ®åº“æ¥è¯´ï¼Œç¿»é¡µèµ·å§‹å‚æ•°æ­£åˆé€‚ã€‚å¯¹äºmysqlå…¶ä»–æ•°æ®åº“æ¥è¯´ï¼Œbeetlsqlï¼Œç¿»é¡µå‚æ•°å˜æˆn-1.ä¸€èˆ¬ä½ ä¸éœ€è¦å…³å¿ƒ</p>
<h4 id="11-1-å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼"><a href="#11-1-å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼" class="headerlink" title="11.1. å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼"></a>11.1. å¼€å‘æ¨¡å¼å’Œäº§å“æ¨¡å¼</h4><p>beetlsqlé»˜è®¤æ˜¯å¼€å‘æ¨¡å¼ï¼Œå› æ­¤ä¿®æ”¹mdçš„sqlæ–‡ä»¶ï¼Œä¸éœ€è¦é‡å¯ã€‚ä½†å»ºè®®çº¿ä¸Šä¸è¦ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼Œå› ä¸ºæ­¤æ¨¡å¼ä¼šæ¯æ¬¡sqlè°ƒç”¨éƒ½ä¼šæ£€æµ‹mdæ–‡ä»¶æ˜¯å¦å˜åŒ–ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹/btsql-ext.properties ,ä¿®æ”¹å¦‚ä¸‹å±æ€§æ”¹ä¸ºäº§å“æ¨¡å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PRODUCT_MODE = true</div></pre></td></tr></table></figure>
<h4 id="11-2-NameConversion"><a href="#11-2-NameConversion" class="headerlink" title="11.2. NameConversion"></a>11.2. NameConversion</h4><p>æ•°æ®åº“å­—æ®µåä¸javaå±æ€§åçš„æ˜ å°„å…³ç³»å¿…é¡»é…ç½®æ­£ç¡®ï¼Œå¦åˆ™ä¼šå¯¼è‡´å„ç§é—®é¢˜ï¼Œå¦‚ä¸‹æ˜¯ä¸€äº›å»ºè®®</p>
<p>å­—æ®µåå­—æ˜¯user_id, javaå±æ€§åæ˜¯userId, åˆ™ä½¿ç”¨UnderlinedNameConversion å­—æ®µåæ˜¯userId, javaå±æ€§åæ˜¯userIdï¼Œåˆ™ä½¿ç”¨DefaultNameConversion</p>
<p>å¦‚æœæ˜¯å…¶ä»–æ˜ å°„å…³ç³»ï¼Œå¯ä»¥è€ƒè™‘è‡ªå·±å®ç°NameConversionæ¥å£</p>
<h4 id="11-3-æ¨¡æ¿å­—ç¬¦é›†"><a href="#11-3-æ¨¡æ¿å­—ç¬¦é›†" class="headerlink" title="11.3. æ¨¡æ¿å­—ç¬¦é›†"></a>11.3. æ¨¡æ¿å­—ç¬¦é›†</h4><p>é»˜è®¤sqlæ¨¡æ¿æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ç³»ç»Ÿé»˜è®¤å­—ç¬¦é›†ï¼Œå¯ä»¥æ›´æ”¹é…ç½®é‡‡ç”¨æŒ‡å®šçš„å­—ç¬¦é›†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CHARSET = UTF-8</div></pre></td></tr></table></figure>
<h4 id="11-4-ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1"><a href="#11-4-ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1" class="headerlink" title="11.4. ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1"></a>11.4. ç¿»é¡µèµ·å§‹å‚æ•°æ˜¯0è¿˜æ˜¯1</h4><p>é»˜è®¤è®¤ä¸º1å¯¹åº”äºç¿»é¡µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚æœä½ ä¹ æƒ¯mysql é‚£ç§0å¯¹åº”äºç¬¬ä¸€æ¡è®°å½•ï¼Œåˆ™éœ€è¦é…ç½®OFFSET_START_ZEROï¼Œè®¾ç½®ä¸ºtrue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OFFSET_START_ZERO =  true</div></pre></td></tr></table></figure>
<p>æ— è®ºæ˜¯ä»0å¼€å§‹è¿˜æ˜¯ä»å¼€å§‹ï¼Œéƒ½ä¸å½±å“beetlsqlæ ¹æ®ç‰¹å®šæ•°æ®åº“ç¿»è¯‘æˆç›®æ ‡æ•°æ®åº“çš„sqlè¯­å¥ï¼Œè¿™åªæ˜¯ä¸€ä¸ªçº¦å®šå¥½çš„ä¹ æƒ¯ï¼Œbeetlsqlä¼šå¤„ç†è·¨æ•°æ®åº“ç¿»é¡µçš„</p>
<h4 id="11-5-è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°"><a href="#11-5-è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°" class="headerlink" title="11.5. è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°"></a>11.5. è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°</h4><p>å¯ä»¥åœ¨sqlæ¨¡æ¿ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•å’Œæ ‡ç­¾å‡½æ•°ï¼Œå…·ä½“è¯·å‚è€ƒbeetlä½¿ç”¨è¯´æ˜ï¼Œå¦‚ä¸‹æ˜¯é»˜è®¤é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">FN.use = org.beetl.sql.core.engine.UseFunction</div><div class="line">FN.globalUse = org.beetl.sql.core.engine.GlobalUseFunction</div><div class="line">FN.text = org.beetl.sql.core.engine.TextFunction</div><div class="line">FN.join = org.beetl.sql.ext.JoinFunction</div><div class="line">FN.isEmpty=org.beetl.sql.ext.EmptyExpressionFunction</div><div class="line">FN.page=org.beetl.sql.core.engine.PageQueryFuntion</div><div class="line">TAG.trim= org.beetl.sql.core.engine.TrimTag</div><div class="line">TAG.pageTag= org.beetl.sql.core.engine.PageQueryTag</div></pre></td></tr></table></figure>
<p>EmptyExpressionFunction ç”¨åœ¨å¾ˆå¤šåœ°æ–¹,å¦‚template ç±»æ“ä½œ,whereè¯­å¥é‡Œçš„æ¡ä»¶åˆ¤æ–­,å®ƒ æ²¿ç”¨äº†beetlä¹ æƒ¯,å¯¹äºä¸å­˜åœ¨çš„å˜é‡,æˆ–è€…ä¸ºnullçš„å˜é‡,éƒ½è¿”å›true,åŒæ—¶å¦‚æœæ˜¯å­—ç¬¦ä¸²,ä¸ºç©ºå­—ç¬¦ä¸²ä¹Ÿè¿”å›true,æ•°ç»„,é›†åˆä¹Ÿæ˜¯è¿™æ ·,æœ‰äº›é¡¹ç›®,è®¤ä¸ºç©ºå­—ç¬¦ä¸²åº”è¯¥ç®—æœ‰å€¼è€Œä¸åº”è¯¥è¿”å›true,ä½ å¯ä»¥å‚è€ƒEmptyExpressionFunctionçš„å®ç°,æŒ‰ç…§é¡¹ç›®è¯­ä¹‰æ¥å®šä¹‰isEmpty</p>
<h4 id="11-6-isEmpty-å’Œ-isNotEmpty"><a href="#11-6-isEmpty-å’Œ-isNotEmpty" class="headerlink" title="11.6. isEmpty å’Œ isNotEmpty"></a>11.6. isEmpty å’Œ isNotEmpty</h4><p>æ¨¡æ¿ç±»æŸ¥è¯¢å’Œæ¨¡æ¿æ›´æ–°ï¼Œä»¥åŠSqlè¯­å¥é‡Œçš„åˆ¤æ–­éƒ½ä¾èµ–äºisEmptyå‡½æ•°åˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦ä¸ºnullï¼Œ2.8.4ä»¥å‰ç‰ˆæœ¬å¯¹ç©ºå­—ç¬¦ä¸²ä¹Ÿè®¤ä¸ºæ˜¯ç©ºï¼Œ2.8.4ä¹‹åç‰ˆæœ¬åˆ™ä»…ä»…åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦ä¸ºnull</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">where 1=1  </div><div class="line">@if(!isEmpty(connent))&#123;</div><div class="line">  and </div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä»£ç ï¼Œå¦‚æœcontentå­˜åœ¨ï¼Œä¸”ä¸ä¸ºnullï¼Œåˆ™è¿›å…¥ifä»£ç å—</p>
<p>å¦‚æœæƒ³å…¼å®¹ä»¥å‰çš„åˆ¤æ–­çš„æ–¹å¼ï¼Œå³è®¤ä¸ºç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯ç©ºï¼ˆä¸æ¨èè¿™ä¹ˆç”¨äº†ï¼‰ï¼Œåˆ™éœ€è¦åœ¨btsql-ext.propertiesï¼Œå†æ¬¡ä½¿ä»¥å‰çš„å®ç°æ–¹å¼</p>
<p>ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FN.isEmpty = org.beetl.ext.fn.EmptyExpressionFunction</div><div class="line">FN.isNotEmpty = org.beetl.ext.fn.IsNotEmptyExpressionFunction</div></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨beetlçš„å®‰å…¨è¾“å‡ºæ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ä¸Šé¢çš„sqlä»£ç ï¼Œå¯ä»¥ç”¨å®‰å…¨è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">where 1=1  </div><div class="line">@if(null!=content!)&#123;</div><div class="line">  and </div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä»£ç ï¼Œcontent ! æ˜¯å®‰å…¨è¡¨è¾¾å¼ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–è€…ä¸ºnullï¼Œåˆ™ä¸ºnullï¼Œç„¶åé€šè¿‡ä¸nullæ¯”è¾ƒã€‚</p>
<h3 id="12-SQL-æ¨¡æ¿åŸºäºBeetlå®ç°"><a href="#12-SQL-æ¨¡æ¿åŸºäºBeetlå®ç°" class="headerlink" title="12. SQL æ¨¡æ¿åŸºäºBeetlå®ç°"></a>12. SQL æ¨¡æ¿åŸºäºBeetlå®ç°</h3><p>SQLè¯­å¥å¯ä»¥åŠ¨æ€ç”Ÿæˆï¼ŒåŸºäºBeetlè¯­è¨€ï¼Œè¿™æ˜¯å› ä¸º</p>
<ul>
<li>beetlæ‰§è¡Œæ•ˆç‡é«˜æ•ˆ ï¼Œå› æ­¤å¯¹äºåŸºäºæ¨¡æ¿çš„åŠ¨æ€sqlè¯­å¥ï¼Œé‡‡ç”¨beetléå¸¸åˆé€‚</li>
<li>beetl è¯­æ³•ç®€å•æ˜“ç”¨ï¼Œå¯ä»¥é€šè¿‡åŠçŒœåŠå¼çš„æ–¹å¼å®ç°ï¼Œæœç»myBatisè¿™æ ·éš¾æ‡‚éš¾è®°å¾—è¯­æ³•ã€‚BeetlSqlå­¦ä¹ æ›²çº¿å‡ ä¹æ²¡æœ‰</li>
<li>åˆ©ç”¨beetlå¯ä»¥å®šåˆ¶å®šç•Œç¬¦å·ï¼Œå®Œå…¨å¯ä»¥å°†sqlæ¨¡æ¿å®šç•Œç¬¦å¥½å®šä¹‰ä¸ºæ•°æ®åº“sqlæ³¨é‡Šç¬¦å·ï¼Œè¿™æ ·å®¹æ˜“åœ¨æ•°æ®åº“ä¸­æµ‹è¯•ï¼Œå¦‚ä¸‹ä¹Ÿæ˜¯sqlæ¨¡æ¿ï¼ˆå®šä¹‰å®šç•Œç¬¦ä¸ºâ€â€“:â€ å’Œ null,nullæ˜¯å›è½¦æ„æ€);</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section">selectByCond</span></div><div class="line">===</div><div class="line">select * from user where 1=1</div><div class="line">--:if(age!=null)</div><div class="line">age=#age#</div><div class="line">--:&#125;</div></pre></td></tr></table></figure>
<ul>
<li>beetl é”™è¯¯æç¤ºéå¸¸å‹å¥½ï¼Œå‡å°‘å†™SQLè„šæœ¬ç¼–å†™ç»´æŠ¤æ—¶é—´</li>
<li>beetl èƒ½å®¹æ˜“ä¸æœ¬åœ°ç±»äº¤äº’ï¼ˆç›´æ¥è®¿é—®Javaç±»ï¼‰ï¼Œèƒ½æ‰§è¡Œä¸€äº›å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨sqlæ¨¡æ¿ä¸­å†™å…¥æ¨¡å‹å¸¸é‡ï¼Œå³ä½¿sqlé‡æ„ï¼Œä¹Ÿä¼šæå‰è§£ææŠ¥é”™</li>
<li>beetlè¯­å¥æ˜“äºæ‰©å±•ï¼Œæä¾›å„ç§å‡½æ•°ï¼Œæ¯”å¦‚åˆ†è¡¨é€»è¾‘å‡½æ•°ï¼Œè·¨æ•°æ®åº“çš„å…¬å…±å‡½æ•°ç­‰</li>
</ul>
<p>å¦‚æœä¸äº†è§£beetlï¼Œå¯å…ˆè‡ªå·±å°è¯•æŒ‰ç…§jsè¯­æ³•æ¥å†™sqlæ¨¡æ¿ï¼Œå¦‚æœè¿˜æœ‰ç–‘é—®ï¼Œå¯ä»¥æŸ¥é˜…å®˜ç½‘ <a href="http://ibeetl.com/" target="_blank" rel="external">http://ibeetl.com</a></p>
<h3 id="13-Beetl-å…¥é—¨"><a href="#13-Beetl-å…¥é—¨" class="headerlink" title="13. Beetl å…¥é—¨"></a>13. Beetl å…¥é—¨</h3><p>Beetl è¯­æ³•ç±»ä¼¼jsï¼Œjavaï¼Œå¦‚ä¸‹åšç®€è¦è¯´æ˜ï¼Œä½¿ç”¨å¯ä»¥å‚è€ƒ <a href="http://ibeetl.com/" target="_blank" rel="external">http://ibeetl.com</a> , æˆ–è€…åœ¨çº¿ä½“éªŒ <a href="http://ibeetl.com/beetlonline/" target="_blank" rel="external">http://ibeetl.com/beetlonline/</a></p>
<h4 id="13-1-å®šç•Œç¬¦å·"><a href="#13-1-å®šç•Œç¬¦å·" class="headerlink" title="13.1. å®šç•Œç¬¦å·"></a>13.1. å®šç•Œç¬¦å·</h4><p>é»˜è®¤çš„å®šç•Œç¬¦å·æ˜¯@ å’Œ å›è½¦ã€‚ é‡Œé¢å¯ä»¥æ”¾æ§åˆ¶è¯­å¥ï¼Œè¡¨è¾¾å¼ç­‰è¯­ï¼Œï¼Œç«™ä½ç¬¦å·æ˜¯##,ç«™ä½ç¬¦å·é»˜è®¤æ˜¯è¾“å‡ºï¼Ÿï¼Œå¹¶åœ¨æ‰§è¡Œsqlçš„ä¼ å…¥å¯¹åº”çš„å€¼ã€‚å¦‚æœæƒ³åœ¨å ä½ç¬¦å·è¾“å‡ºå˜é‡å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨textå‡½æ•°</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@if(!isEmpty(name))&#123;</div><div class="line">	and name = #name#</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³ä¿®æ”¹å®šç•Œç¬¦ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ª/btsql-ext.properties. è®¾ç½®å¦‚ä¸‹å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DELIMITER_PLACEHOLDER_START=#</div><div class="line">DELIMITER_PLACEHOLDER_END=#</div><div class="line">DELIMITER_STATEMENT_START=@</div><div class="line">DELIMITER_STATEMENT_END=</div></pre></td></tr></table></figure>
<p>beetlsql çš„å…¶ä»–å±æ€§ä¹Ÿå¯ä»¥åœ¨æ­¤æ–‡ä»¶é‡Œè®¾ç½®</p>
<h4 id="13-2-å˜é‡"><a href="#13-2-å˜é‡" class="headerlink" title="13.2. å˜é‡"></a>13.2. å˜é‡</h4><p>é€šè¿‡ç¨‹åºä¼ å…¥çš„å˜é‡å«å…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨sqlæ¨¡æ¿é‡Œä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å˜é‡ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">var</span> count = <span class="number">3</span>;</div><div class="line">@<span class="keyword">var</span> status = &#123;<span class="string">"a"</span>:<span class="number">1</span>&#125;  <span class="comment">//jsonå˜é‡</span></div></pre></td></tr></table></figure>
<h4 id="13-3-ç®—æ•°è¡¨è¾¾å¼"><a href="#13-3-ç®—æ•°è¡¨è¾¾å¼" class="headerlink" title="13.3. ç®—æ•°è¡¨è¾¾å¼"></a>13.3. ç®—æ•°è¡¨è¾¾å¼</h4><p>åŒjsï¼Œå¦‚a+1-b%30, i++ ç­‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> #<span class="string">'%'</span>+<span class="keyword">name</span>+<span class="string">'%'</span>#</div></pre></td></tr></table></figure>
<h4 id="13-4-é€»è¾‘è¡¨è¾¾å¼"><a href="#13-4-é€»è¾‘è¡¨è¾¾å¼" class="headerlink" title="13.4. é€»è¾‘è¡¨è¾¾å¼"></a>13.4. é€»è¾‘è¡¨è¾¾å¼</h4><p>æœ‰â€œ&amp;&amp;â€ â€œ||â€ ï¼Œè¿˜æœ‰ â€œï¼â€ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸ï¼Œæˆ–ï¼Œéï¼Œ beetlä¹Ÿæ”¯æŒä¸‰å…ƒè¡¨è¾¾å¼</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">#user.gender==1?'å¥³':'ç”·'#</span></div></pre></td></tr></table></figure>
<h4 id="13-5-æ§åˆ¶è¯­å¥"><a href="#13-5-æ§åˆ¶è¯­å¥" class="headerlink" title="13.5. æ§åˆ¶è¯­å¥"></a>13.5. æ§åˆ¶è¯­å¥</h4><ul>
<li>if else è¿™ä¸ªåŒjavaï¼Œcï¼Œjsã€‚</li>
<li>for,å¾ªç¯è¯­å¥ï¼Œå¦‚for(id:ids){}</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">select * from user where status in (</div><div class="line">@for(id in ids)&#123;</div><div class="line"><span class="section">#id#  #text(idLP.last?"":"," )#</span></div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<blockquote>
<h4 id="æ³¨æ„-3"><a href="#æ³¨æ„-3" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><ul>
<li>å˜é‡åï¼‹LP æ˜¯ä¸€ä¸ªå†…ç½®å˜é‡ï¼ŒåŒ…å«äº†å¾ªç¯çŠ¶æ€ï¼Œå…·ä½“è¯·å‚è€ƒbeetlæ–‡æ¡£ï¼Œtextæ–¹æ³•è¡¨ç¤ºç›´æ¥è¾“å‡ºæ–‡æœ¬è€Œä¸æ˜¯ç¬¦å·â€œï¼Ÿâ€</li>
<li>å…³äº sqlä¸­çš„inï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„joinæ–¹æ³•æ›´åŠ æ–¹ä¾¿</li>
</ul>
</blockquote>
<ul>
<li>while å¾ªç¯è¯­å¥ ï¼Œå¦‚while(i&lt;count))</li>
</ul>
<h4 id="13-6-è®¿é—®å˜é‡å±æ€§"><a href="#13-6-è®¿é—®å˜é‡å±æ€§" class="headerlink" title="13.6. è®¿é—®å˜é‡å±æ€§"></a>13.6. è®¿é—®å˜é‡å±æ€§</h4><ul>
<li>å¦‚æœæ˜¯å¯¹è±¡ï¼Œç›´æ¥è®¿é—®å±æ€§åï¼Œuser.name</li>
<li>å¦‚æœæ˜¯Mapï¼Œç”¨keyè®¿é—® map[â€œkeyâ€];</li>
<li>å¦‚æœæ˜¯æ•°ç»„æˆ–è€…listï¼Œç”¨ç´¢å¼•è®¿é—®ï¼Œå¦‚list[1],list[i];</li>
<li>å¯ä»¥ç›´é‡‡ç”¨javaæ–¹å¼è®¿é—®å˜é‡çš„æ–¹æ³•å’Œå±æ€§ï¼Œå¦‚é™æ€ç±»Constatns</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constatns</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> 	RUNNING = <span class="number">0</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›´æ¥ä»¥javaæ–¹å¼è®¿é—®ï¼Œéœ€è¦å†å˜é‡ç¬¦å·å‰åŠ ä¸Š@ï¼Œå¯ä»¥åœ¨æ¨¡æ¿é‡Œè®¿é—®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">status</span> = #@Constatns.RUNNING# <span class="keyword">and</span> <span class="keyword">id</span> = #@Constatns.getUser().getId()#</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œå¦‚æœConstants ç±» æ²¡æœ‰å¯¼å…¥è¿›beetlï¼Œåˆ™éœ€è¦å¸¦åŒ…åï¼Œå¯¼å…¥beetlæ–¹æ³•æ˜¯é…ç½®IMPORT_PACKAGE=åŒ…å.;åŒ…å.</p>
<h4 id="13-7-åˆ¤æ–­å¯¹è±¡éç©ºç©º"><a href="#13-7-åˆ¤æ–­å¯¹è±¡éç©ºç©º" class="headerlink" title="13.7. åˆ¤æ–­å¯¹è±¡éç©ºç©º"></a>13.7. åˆ¤æ–­å¯¹è±¡éç©ºç©º</h4><p>å¯ä»¥é‡‡ç”¨isEmptyåˆ¤æ–­å˜é‡è¡¨è¾¾å¼æ˜¯å¦ä¸ºç©º(ä¸ºnull)ï¼Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(isEmpty(user)||isEmpty(role.name))</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç”¨ä¼ ç»Ÿæ–¹æ³•åˆ¤æ–­ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(user==<span class="literal">null</span>) or <span class="keyword">if</span>(role.name!=<span class="literal">null</span>))</div></pre></td></tr></table></figure>
<p>å˜é‡æœ‰å¯èƒ½ä¸å­˜åœ¨ï¼Œå¯ç”¨hasHå‡½æ•°æˆ–è€…éœ€è¦ä½¿ç”¨å®‰å…¨è¾“å‡ºç¬¦å·ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="literal">null</span>==user.name!))</div><div class="line"><span class="comment">//or</span></div><div class="line"><span class="keyword">if</span>(has(user))</div></pre></td></tr></table></figure>
<p>å˜é‡è¡¨è¾¾å¼åé¢è·Ÿä¸Šâ€!â€ è¡¨ç¤ºå¦‚æœå˜é‡ä¸å­˜åœ¨ï¼Œåˆ™ä¸ºï¼åé¢çš„å€¼ï¼Œå¦‚æœï¼åé¢æ²¡æœ‰å€¼ï¼Œåˆ™ä¸ºnull</p>
<h4 id="13-8-è°ƒç”¨æ–¹æ³•"><a href="#13-8-è°ƒç”¨æ–¹æ³•" class="headerlink" title="13.8. è°ƒç”¨æ–¹æ³•"></a>13.8. è°ƒç”¨æ–¹æ³•</h4><p>åŒjsï¼Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å ä½ç¬¦é‡Œè°ƒç”¨textæ–¹æ³•ï¼Œä¼šç›´æ¥è¾“å‡ºå˜é‡è€Œä¸æ˜¯â€œï¼Ÿâ€ï¼Œå…¶ä»–ä»¥dbå¼€å¤´çš„æ–¹å¼ä¹Ÿæ˜¯è¿™æ ·ã€‚æ¶æ„å¸ˆå¯ä»¥è®¾ç½®SQLPlaceholderST.textFunList.add(xxxx) æ¥å†³å®šé‚£äº›æ–¹æ³•åœ¨å ä½ç¬¦å·é‡Œå¯ä»¥ç›´æ¥è¾“å‡ºæ–‡æœ¬è€Œä¸æ˜¯ç¬¦å·â€?â€</p>
<p>beetlæä¾›äº†å¾ˆå¤šå†…ç½®æ–¹æ³•ï¼Œå¦‚printï¼Œdebug,isEmpty,dateç­‰ï¼Œå…·ä½“è¯·å‚è€ƒæ–‡æ¡£</p>
<h4 id="13-9-è‡ªå®šä¹‰æ–¹æ³•"><a href="#13-9-è‡ªå®šä¹‰æ–¹æ³•" class="headerlink" title="13.9. è‡ªå®šä¹‰æ–¹æ³•"></a>13.9. è‡ªå®šä¹‰æ–¹æ³•</h4><p>é€šè¿‡é…ç½®btsql-ext.properties, å¯ä»¥æ³¨å†Œè‡ªå·±å®šä¹‰çš„æ–¹æ³•åœ¨beetlsqlé‡Œä½¿ç”¨ï¼Œå¦‚æ³¨å†Œä¸€ä¸ªè¿”å›å½“å‰å¹´ä»½çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨btsql-ext.propertiesåŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FN.db.year= com.xxx.YearFunction</div></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨æ¨¡æ¿é‡Œ,å¯ä»¥è°ƒç”¨db.year() è·å¾—å½“å‰å¹´ä»½ã€‚YearFunction éœ€è¦å®ç°Functionçš„ callæ–¹æ³•ï¼Œå¦‚ä¸‹æ˜¯ä¸ªç®€å•ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YearFunction</span> <span class="keyword">implements</span> <span class="title">Function</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(Object[] paras, Context ctx)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"2015"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…³äºå¦‚ä½•å®Œæˆè‡ªå®šä¹‰æ–¹æ³•ï¼Œè¯·å‚è€ƒ ibeetl å®˜æ–¹æ–‡æ¡£</p>
<h4 id="13-10-å†…ç½®æ–¹æ³•"><a href="#13-10-å†…ç½®æ–¹æ³•" class="headerlink" title="13.10. å†…ç½®æ–¹æ³•"></a>13.10. å†…ç½®æ–¹æ³•</h4><ul>
<li>print println è¾“å‡ºï¼ŒåŒjsï¼Œå¦‚print(â€œtable1â€);</li>
<li>hasï¼Œ åˆ¤æ–­æ˜¯å¦æœ‰æ­¤å…¨å±€å˜é‡;</li>
<li>isEmpty åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦ä¸ºç©ºï¼Œä¸å­˜åœ¨ï¼Œç©ºå­—ç¬¦ä¸²ï¼Œç©ºé›†åˆéƒ½è¿”å›true;</li>
<li>debug å°†å˜é‡è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¦‚ debug(user);</li>
<li>text è¾“å‡ºï¼Œä½†å¯ç”¨äºå ä½ç¬¦å·é‡Œ</li>
<li>page å‡½æ•°ï¼Œç”¨äºåœ¨PageQueryç¿»é¡µé‡Œï¼Œæ ¹æ®ä¸Šä¸‹é—®å†³å®šè¾“å‡ºcount(1) æˆ–è€…count(*),å¦‚æœæœ‰å‚æ•°ï¼Œåˆ™æŒ‰ç…§å‚æ•°è¾“å‡º</li>
<li>join, ç”¨é€—å·è¿æ¥é›†åˆæˆ–è€…æ•°ç»„ï¼Œå¹¶è¾“å‡ºï¼Ÿï¼Œç”¨äºinï¼Œå¦‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">status</span> <span class="keyword">in</span> ( #<span class="keyword">join</span>(ids)ï¼ƒ)</div><div class="line">			<span class="comment">-- è¾“å‡ºæˆ  select * from user where status in (?,?,?)</span></div></pre></td></tr></table></figure>
<ul>
<li>use å‚æ•°æ˜¯åŒä¸€ä¸ªmdæ–‡ä»¶çš„sqlidï¼Œç±»ä¼¼mybatisçš„ sqlåŠŸèƒ½ï¼Œå¦‚</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">condtion</span></div><div class="line">===</div><div class="line">where 1=1 and name = #name#</div><div class="line"></div><div class="line"><span class="section">selectUser</span></div><div class="line">===</div><div class="line">select * from user #use("condition")#</div></pre></td></tr></table></figure>
<p>globalUse å‚æ•°æ˜¯å…¶ä»–æ–‡ä»¶çš„globalUseï¼Œå¦‚globalUse(â€œshare.accessControlâ€),å°†è®¿é—®share.md(sql)æ–‡ä»¶çš„accessControlç‰‡æ®µ</p>
<ul>
<li>db.dynamicSqlç±»ä¼¼useåŠŸèƒ½,ä½†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯sqlç‰‡æ®µï¼Œè€Œä¸æ˜¯sqlId</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryUsers</span></div><div class="line">===</div><div class="line">@ var sql = "id=#xxx#";</div><div class="line">select #page("*")# from user where 1=1 and #db.dynamicSql(sql,&#123;xxx:1&#125;)#</div></pre></td></tr></table></figure>
<ul>
<li>page ç”¨äºpagequery,ä½†beetlsql ä½¿ç”¨pagequeryæŸ¥è¯¢,ä¼šå°†sqlæ¨¡æ¿ç¿»è¯‘æˆå¸¦æœ‰count(1),å’Œåˆ—è¡¨åçš„ä¿©ä¸ªsqlè¯­å¥,å› æ­¤å¿…é¡»ä½¿ç”¨pageå‡½æ•°æˆ–è€…pageTagæ ‡ç­¾</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select #page()# from user</div></pre></td></tr></table></figure>
<p>å¦‚æœæ— å‚æ•°,åˆ™åœ¨æŸ¥è¯¢çš„æ—¶å€™è§£é‡Šæˆ *,å¦‚æœæœ‰å‚æ•°,åˆ™è§£é‡Šæˆåˆ—å,å¦‚ page(â€œa.name,a.id,b.name role_nameâ€) ,å¦‚æœåˆ—åè¾ƒå¤š,å¯ä»¥ä½¿ç”¨pageTag</p>
<h4 id="13-11-æ ‡ç­¾åŠŸèƒ½"><a href="#13-11-æ ‡ç­¾åŠŸèƒ½" class="headerlink" title="13.11. æ ‡ç­¾åŠŸèƒ½"></a>13.11. æ ‡ç­¾åŠŸèƒ½</h4><ul>
<li>beetlsql æä¾›äº†trimæ ‡ç­¾å‡½æ•°ï¼Œç”¨äºåˆ é™¤æ ‡ç­¾ä½“æœ€åä¸€ä¸ªé€—å·ï¼Œè¿™å¯ä»¥å¸®åŠ©æ‹¼æ¥æ¡ä»¶sqlï¼Œå¦‚</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="section">updateStatus</span></div><div class="line">===</div><div class="line"></div><div class="line">update user set</div><div class="line">@trim()&#123;</div><div class="line">@if(!isEmpty(age)&#123;</div><div class="line">age = #age# ,</div><div class="line">@&#125; if(!isEmpty(status)&#123;</div><div class="line">status = #status#,</div><div class="line">@&#125;</div><div class="line">@&#125;</div><div class="line">where id = #id#</div></pre></td></tr></table></figure>
<p>trim æ ‡ç­¾å¯ä»¥åˆ é™¤ æ ‡ç­¾ä½“é‡Œçš„æœ€åä¸€ä¸ªé€—å·.trim ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼mybatisçš„åŠŸèƒ½ï¼Œé€šè¿‡ä¼ å…¥trimå‚æ•°prefixï¼ŒprefixOverridesæ¥å®Œæˆã€‚å…·ä½“å‚è€ƒæ ‡ç­¾api æ–‡æ¡£</p>
<ul>
<li>pageTag,åŒpageå‡½æ•°,ç”¨äºpageQuery,å¦‚</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select</div><div class="line">@pageTag()&#123;</div><div class="line">id,name,status</div><div class="line">@&#125;</div><div class="line">from user</div></pre></td></tr></table></figure>
<p>æ³¨:å¯ä»¥å‚è€ƒbeetlå®˜ç½‘ äº†è§£å¦‚ä½•å¼€å‘è‡ªå®šä¹‰æ ‡ç­¾ä»¥åŠæ³¨å†Œæ ‡ç­¾å‡½æ•°</p>
<ul>
<li>pageIgnoreTagï¼Œè¯¥æ ‡ç­¾çš„ä½œç”¨æ˜¯åœ¨ç”Ÿæˆåˆ†é¡µæŸ¥è¯¢çš„countè¯­å¥æ—¶ï¼Œå¿½ç•¥sqlè¯­å¥é‡Œçš„æŸäº›å†…å®¹ï¼Œå¦‚ï¼šorder by ã€‚pageIgnoreTagä¸pageTagæ ‡ç­¾ç»„åˆä½¿ç”¨ï¼Œç»„åˆå¦‚ä¸‹</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select</div><div class="line">@pageTag()&#123;</div><div class="line">id,name,status</div><div class="line">@&#125;</div><div class="line">from user</div><div class="line">@pageIgnoreTag()&#123;</div><div class="line">order by a.createTime</div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<p>å› ä¸ºcountè¯­å¥ï¼Œæ— éœ€è¦æ’åºè¯­å¥éƒ¨åˆ†ï¼Œè€Œä¸”ï¼Œæœ‰äº›æ•°æ®åº“ï¼Œå¦‚SQLServerå¹¶ä¸æ”¯æŒcountè¯­å¥è¢«æ’åºï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨pageIgnoreTagæ¥è§£å†³å¤¸æ•°æ®åº“é—®é¢˜</p>
<ul>
<li>whereTag</li>
</ul>
<p>è¯¥æ ‡ç­¾å¤ç”¨TrimTagï¼Œå…¶å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šåˆ¤æ–­whereTagé‡Œçš„sqlå†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±ä¸è¾“å‡ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­sqlæ˜¯å¦ä»¥ANDæˆ–ORå¼€å¤´ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å»æ‰ã€‚ä¾‹å¦‚æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="section">queryNewUser</span></div><div class="line">===</div><div class="line">select a.* from user a </div><div class="line">@whereTag()&#123;</div><div class="line">@if(!isEmpty(age)&#123;</div><div class="line"><span class="code">    and a.age=#age# </span></div><div class="line">@&#125;</div><div class="line">@if(!isEmpty(status)&#123;</div><div class="line"><span class="code">    and a.status=#status#</span></div><div class="line">@&#125;</div><div class="line">@&#125;</div></pre></td></tr></table></figure>
<p>å°†ç”Ÿæˆ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> a.* <span class="keyword">from</span> <span class="keyword">user</span> a </div><div class="line"><span class="keyword">where</span> </div><div class="line">a.age=? </div><div class="line"><span class="keyword">and</span> a.status=?</div></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œå¦‚æœä½ ä¸ç”¨whereTagï¼Œä¹Ÿå¯ç”¨where 1=1 æ¥è§£å†³ï¼Œæˆ‘çœ‹å¹¶æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚</p>
<h3 id="14-DebugåŠŸèƒ½"><a href="#14-DebugåŠŸèƒ½" class="headerlink" title="14. DebugåŠŸèƒ½"></a>14. DebugåŠŸèƒ½</h3><p>Debug æœŸæœ›èƒ½åœ¨æ§åˆ¶å°æˆ–è€…æ—¥å¿—ç³»ç»Ÿè¾“å‡ºæ‰§è¡Œçš„sqlè¯­å¥ï¼Œå‚æ•°ï¼Œæ‰§è¡Œç»“æœä»¥åŠæ‰§è¡Œæ—¶é—´ï¼Œå¯ä»¥é‡‡ç”¨ç³»ç»Ÿå†…ç½®çš„DebugInterceptor æ¥å®Œæˆï¼Œåœ¨æ„é€ SQLManagerçš„æ—¶å€™ï¼Œä¼ å…¥å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SqlManager sqlManager = <span class="keyword">new</span> SqlManager(source,mysql,loader,nc ,<span class="keyword">new</span> Interceptor[]&#123;<span class="keyword">new</span> DebugInterceptor() &#125;);</div></pre></td></tr></table></figure>
<p>æˆ–è€…é€šè¿‡springï¼Œjfianlè¿™æ ·æ¡†æ¶é…ç½®å®Œæˆã€‚ä½¿ç”¨åï¼Œæ‰§è¡Œbeetlsqlï¼Œä¼šæœ‰ç±»ä¼¼è¾“å‡º</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">â”â”â”â”â”â” Debug [user.selectUserAndDepartment] â”â”â”</div><div class="line">â”£ SQLï¼š	 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="number">1</span> = <span class="number">1</span></div><div class="line">â”£ å‚æ•°ï¼š	 []</div><div class="line">â”£ ä½ç½®ï¼š	 org.beetl.sql.test.QuickTest.main(QuickTest.java:<span class="number">47</span>)</div><div class="line">â”£ æ—¶é—´ï¼š	 <span class="number">23</span>ms</div><div class="line">â”£ ç»“æœï¼š	 [<span class="number">3</span>]</div><div class="line">â”—â”â”â”â”â” Debug [user.selectUserAndDepartment] â”â”â”</div></pre></td></tr></table></figure>
<p>beetlsqlä¼šåˆ†åˆ«è¾“å‡º æ‰§è¡Œå‰çš„sqlå’Œå‚æ•°ï¼Œä»¥åŠæ‰§è¡Œåçš„ç»“æœå’Œè€—è´¹çš„æ—¶é—´ã€‚ä½ å¯ä»¥å‚è€ƒDebugInterceptor å®ç°è‡ªå·±çš„è°ƒè¯•è¾“å‡º</p>
<h3 id="15-ç¼“å­˜åŠŸèƒ½"><a href="#15-ç¼“å­˜åŠŸèƒ½" class="headerlink" title="15. ç¼“å­˜åŠŸèƒ½"></a>15. ç¼“å­˜åŠŸèƒ½</h3><p>åŒDebugInterceptoræ„é€ æ–¹å¼ä¸€æ ·ï¼Œ SimpleCacheInterceptorèƒ½ç¼“å­˜æŒ‡å®šçš„sqlæŸ¥è¯¢ç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; lcs = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">lcs.add(<span class="string">"user"</span>);</div><div class="line">SimpleCacheInterceptor cache =<span class="keyword">new</span> SimpleCacheInterceptor(lcs);</div><div class="line">Interceptor[] inters = <span class="keyword">new</span> Interceptor[]&#123; <span class="keyword">new</span> DebugInterceptor(),cache&#125;;</div><div class="line">SQLManager 	sql = <span class="keyword">new</span> SQLManager(style,loader,cs,<span class="keyword">new</span> UnderlinedNameConversion(), inters);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</div><div class="line">	sql.select(<span class="string">"user.queryUser"</span>, User.class, <span class="keyword">null</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä¾‹å­ï¼ŒæŒ‡å®šæ‰€æœ‰namespaceä¸ºuseræŸ¥è¯¢éƒ½è®²è¢«ç¼“å­˜ï¼Œå¦‚æœæ­¤namepaceæœ‰æ›´æ–°æ“ä½œï¼Œåˆ™ç¼“å­˜æ¸…é™¤ï¼Œè¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">â”â”â”â”â”â” Debug [user.queryUser] â”â”â”</div><div class="line">â”£ SQLï¼š	 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">User</span> <span class="keyword">where</span> <span class="number">1</span> =<span class="number">1</span></div><div class="line">â”£ å‚æ•°ï¼š	 []</div><div class="line">â”£ ä½ç½®ï¼š	 org.beetl.sql.test.QuickTest.main(QuickTest.java:<span class="number">54</span>)</div><div class="line">â”£ æ—¶é—´ï¼š	 <span class="number">52</span>ms</div><div class="line">â”£ ç»“æœï¼š	 [<span class="number">9</span>]</div><div class="line">â”—â”â”â”â”â” Debug [user.queryUser] â”â”â”</div><div class="line"></div><div class="line">â”â”â”â”â”â” Debug [user.queryUser] â”â”â”</div><div class="line">â”£ <span class="keyword">SQL</span>ï¼š	 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">User</span> <span class="keyword">where</span> <span class="number">1</span> =<span class="number">1</span></div><div class="line">â”£ å‚æ•°ï¼š	 []</div><div class="line">â”£ ä½ç½®ï¼š	 org.beetl.sql.test.QuickTest.main(QuickTest.java:<span class="number">54</span>)</div><div class="line">â”£ æ—¶é—´ï¼š	 <span class="number">0</span>ms</div><div class="line">â”£ ç»“æœï¼š	 [<span class="number">9</span>]</div><div class="line">â”—â”â”â”â”â” Debug [user.queryUser] â”â”â”</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ¡æŸ¥è¯¢çš„æ—¶é—´ä¸º0ï¼Œè¿™æ˜¯å› ä¸ºç›´æ¥ä½¿ç”¨äº†ç¼“å­˜ç¼˜æ•…ã€‚</p>
<p>SimpleCacheInterceptor æ„é€ çš„æ—¶å€™æ¥å—ä¸€ä¸ªç±»åˆ—è¡¨ï¼Œæ‰€æœ‰sqlidçš„namespaceï¼Œæ¯”å¦‚â€œuser.queryUserâ€ çš„namespaceæ˜¯â€œuserâ€ï¼Œå¦‚æœbeetlsqlçš„æŸ¥è¯¢sqlidæ­¤åˆ—è¡¨é‡Œï¼Œå°†å‚ä¸ç¼“å­˜å¤„ç†ï¼Œå¦åˆ™ï¼Œä¸å‚ä¸ç¼“å­˜å¤„ç†</p>
<p>é»˜è®¤çš„ç¼“å­˜å®ç°æ˜¯ä½¿ç”¨å†…å­˜Mapï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å®ç°æ–¹å¼ï¼Œæ¯”å¦‚rediesï¼Œåªéœ€è¦å®ç°å¦‚ä¸‹æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">CacheManager</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initCache</span><span class="params">(String ns)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putCache</span><span class="params">(String ns,Object key,Object value)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getCache</span><span class="params">(String ns,Object key)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearCache</span><span class="params">(String ns)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containCache</span><span class="params">(String ns,Object key)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="16-InterceptoråŠŸèƒ½"><a href="#16-InterceptoråŠŸèƒ½" class="headerlink" title="16. InterceptoråŠŸèƒ½"></a>16. InterceptoråŠŸèƒ½</h3><p>BeetlSqlå¯ä»¥åœ¨æ‰§è¡Œsqlå‰åæ‰§è¡Œä¸€ç³»åˆ—çš„Intercetorï¼Œä»è€Œæœ‰æœºä¼šæ‰§è¡Œå„ç§æ‰©å±•å’Œç›‘æ§ï¼Œè¿™æ¯”å·²çŸ¥çš„é€šè¿‡æ•°æ®åº“è¿æ¥æ± åšInterceptoræ›´åŠ å®¹æ˜“ã€‚å¦‚ä¸‹Interceptoréƒ½æ˜¯æœ‰å¯èƒ½çš„</p>
<ul>
<li>ç›‘æ§sqlæ‰§è¡Œè¾ƒé•¿æ—¶é—´è¯­å¥ï¼Œæ‰“å°å¹¶æ”¶é›†ã€‚TimeStatInterceptor ç±»å®Œæˆ</li>
<li>å¯¹æ¯ä¸€æ¡sqlè¯­å¥æ‰§è¡Œåè¾“å‡ºå…¶sqlå’Œå‚æ•°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æ¡ä»¶åªè¾“å‡ºç‰¹å®šsqlé›†åˆçš„sqlã€‚ä¾¿äºç”¨æˆ·è°ƒè¯•ã€‚DebugInterceptorå®Œæˆ</li>
<li>å¯¹sqlé¢„è®¡è§£æï¼Œæ±‡æ€»sqlæ‰§è¡Œæƒ…å†µï¼ˆæœªå®Œæˆï¼Œéœ€è¦é›†æˆç¬¬ä¸‰æ–¹sqlåˆ†æå·¥å…·ï¼‰</li>
</ul>
<p>ä½ ä¹Ÿå¯ä»¥è‡ªè¡Œæ‰©å±•Interceptorç±»ï¼Œæ¥å®Œæˆç‰¹å®šéœ€æ±‚ã€‚ å¦‚ä¸‹ï¼Œåœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œå‰ä¼šæ‰§è¡Œbeforï¼Œé€šè¿‡ctxå¯ä»¥è·å–æ‰§è¡Œçš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œæ•°æ®åº“æˆåŠŸæ‰§è¡Œåï¼Œä¼šæ‰§è¡Œafteræ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interceptor</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(InterceptorContext ctx)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(InterceptorContext ctx)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>InterceptorContext å¦‚ä¸‹ï¼ŒåŒ…å«äº†sqlIdï¼Œå®é™…å¾—sqlï¼Œå’Œå®é™…å¾—å‚æ•°, ä¹ŸåŒ…æ‹¬æ‰§è¡Œç»“æœresultã€‚å¯¹äºæŸ¥è¯¢ï¼Œæ‰§è¡Œç»“æœæ˜¯æŸ¥è¯¢è¿”å›çš„ç»“æœé›†æ¡æ•°ï¼Œå¯¹äºæ›´æ–°ï¼Œè¿”å›çš„æ˜¯æˆåŠŸæ¡æ•°ï¼Œå¦‚æœæ˜¯æ‰¹é‡æ›´æ–°ï¼Œåˆ™æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å¯ä»¥å‚è€ƒæºç DebugInterceptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorContext</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String sqlId;</div><div class="line">	<span class="keyword">private</span> String sql;</div><div class="line">	<span class="keyword">private</span>  List&lt;SQLParameter&gt; paras;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> isUpdate = <span class="keyword">false</span> ;</div><div class="line">	<span class="keyword">private</span> Object result ;</div><div class="line">	<span class="keyword">private</span> Map&lt;String,Object&gt; env  = <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="17-å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“"><a href="#17-å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“" class="headerlink" title="17. å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“"></a>17. å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“</h3><p>BeetlSqlç®¡ç†æ•°æ®æºï¼Œå¦‚æœåªæä¾›ä¸€ä¸ªæ•°æ®æºï¼Œåˆ™è®¤ä¸ºè¯»å†™å‡æ“ä½œæ­¤æ•°æ®æºï¼Œå¦‚æœæä¾›å¤šä¸ªï¼Œåˆ™é»˜è®¤ç¬¬ä¸€ä¸ªä¸ºå†™åº“ï¼Œå…¶ä»–ä¸ºè¯»åº“ã€‚ç”¨æˆ·åœ¨å¼€å‘ä»£ç çš„æ—¶å€™ï¼Œæ— éœ€å…³å¿ƒæ“ä½œçš„æ˜¯å“ªä¸ªæ•°æ®åº“ï¼Œå› ä¸ºè°ƒç”¨sqlScrip çš„ selectç›¸å…³apiçš„æ—¶å€™ï¼Œæ€»æ˜¯å»è¯»å–ä»åº“ï¼Œadd/update/delete çš„æ—¶å€™ï¼Œæ€»æ˜¯è¯»å–ä¸»åº“ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlManager.insert(User.class,user) <span class="comment">// æ“ä½œä¸»åº“ï¼Œå¦‚æœåªé…ç½®äº†ä¸€ä¸ªæ•°æ®æºï¼Œåˆ™æ— æ‰€è°“ä¸»ä»</span></div><div class="line">sqlManager.unique(id,User.class) <span class="comment">//è¯»å–ä»åº“</span></div></pre></td></tr></table></figure>
<p>ä¸»ä»åº“çš„é€»è¾‘æ˜¯ç”±ConnectionSourceæ¥å†³å®šçš„ï¼Œå¦‚ä¸‹DefaultConnectionSource çš„é€»è¾‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConn</span><span class="params">(String sqlId,<span class="keyword">boolean</span> isUpdate,String sql,List&lt;?&gt; paras)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.slaves==<span class="keyword">null</span>||<span class="keyword">this</span>.slaves.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	<span class="keyword">if</span>(isUpdate) <span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	<span class="keyword">int</span> status  = forceStatus.get();</div><div class="line">	<span class="keyword">if</span>(status ==<span class="number">0</span>||status==<span class="number">1</span>)&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getReadConn(sqlId, sql, paras);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>forceStatus å¯ä»¥å¼ºåˆ¶SQLManager ä½¿ç”¨ä¸»æˆ–è€…ä»æ•°æ®åº“ã€‚å‚è€ƒapi SQLManager.useMaster(DBRunner f) ï¼ŒSQLManager.useSlave(DBRunner f)</li>
</ul>
<p>å¯¹äºäºä¸åŒçš„ConnectionSource å®Œæˆé€»è¾‘ä¸ä¸€æ ·ï¼Œå¯¹äºspringï¼Œjfinalè¿™æ ·çš„æ¡†æ¶ï¼Œå¦‚æœsqlManageråœ¨äº‹åŠ¡ç¯å¢ƒé‡Œï¼Œæ€»æ˜¯æ“ä½œä¸»æ•°æ®åº“ï¼Œå¦‚æœæ˜¯åªè¯»äº‹åŠ¡ç¯å¢ƒ åˆ™æ“ä½œä»æ•°æ®åº“ã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡ç¯å¢ƒï¼Œåˆ™æ ¹æ®sqlæ˜¯æŸ¥è¯¢è¿˜æ˜¯æ›´æ–°æ¥å†³å®šã€‚</p>
<p>å¦‚ä¸‹æ˜¯SpringConnectionSource æä¾›çš„ä¸»ä»é€»è¾‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConn</span><span class="params">(String sqlId,<span class="keyword">boolean</span> isUpdate,String sql,List paras)</span></span>&#123;</div><div class="line">	<span class="comment">//åªæœ‰ä¸€ä¸ªæ•°æ®æº</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.slaves==<span class="keyword">null</span>||<span class="keyword">this</span>.slaves.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	<span class="comment">//å¦‚æœæ˜¯æ›´æ–°è¯­å¥ï¼Œä¹Ÿå¾—èµ°master</span></div><div class="line">	<span class="keyword">if</span>(isUpdate) <span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	<span class="comment">//å¦‚æœapiå¼ºåˆ¶ä½¿ç”¨</span></div><div class="line">	<span class="keyword">int</span> status  = forceStatus.get();</div><div class="line">	<span class="keyword">if</span>(status==<span class="number">1</span>)&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getReadConn(sqlId, sql, paras);</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(status ==<span class="number">2</span>)&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//åœ¨äº‹ç‰©é‡Œéƒ½ç”¨masterï¼Œé™¤äº†readonlyäº‹ç‰©</span></div><div class="line">	<span class="keyword">boolean</span> inTrans = TransactionSynchronizationManager.isActualTransactionActive();</div><div class="line">	<span class="keyword">if</span>(inTrans)&#123;</div><div class="line">		<span class="keyword">boolean</span>  isReadOnly = TransactionSynchronizationManager.isCurrentTransactionReadOnly();</div><div class="line">		<span class="keyword">if</span>(!isReadOnly)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.getWriteConn(sqlId,sql,paras);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	 <span class="keyword">return</span> <span class="keyword">this</span>.getReadConn(sqlId, sql, paras);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œå¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œæ— éœ€å…³å¿ƒæœ¬èŠ‚è¯´çš„å†…å®¹ï¼Œä»…ä»…ä¾›è¦å®šåˆ¶ä¸»ä»é€»è¾‘çš„æ¶æ„å¸ˆã€‚</p>
<h3 id="18-å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘"><a href="#18-å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘" class="headerlink" title="18. å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘"></a>18. å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†åº“åˆ†è¡¨é€»è¾‘</h3><p>å¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡åœ¨Sql æ¨¡æ¿é‡Œå®Œæˆåˆ†è¡¨é€»è¾‘è€Œå¯¹ä½¿ç”¨è€…é€æ˜ï¼Œå¦‚ä¸‹sqlè¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span></div><div class="line">#<span class="built_in">text</span>(<span class="string">"log_"</span>+ getMonth(<span class="built_in">date</span>())#</div><div class="line"><span class="keyword">values</span> () ...</div></pre></td></tr></table></figure>
<p>æ³¨ï¼štextå‡½æ•°ç›´æ¥è¾“å‡ºè¡¨è¾¾å¼åˆ°sqlè¯­å¥ï¼Œè€Œä¸æ˜¯è¾“å‡ºï¼Ÿã€‚</p>
<p>logè¡¨ç¤ºæŒ‰ç…§ä¸€å®šè§„åˆ™åˆ†è¡¨ï¼Œtableå¯ä»¥æ ¹æ®è¾“å…¥çš„æ—¶é—´å»ç¡®å®šæ˜¯å“ªä¸ªè¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span></div><div class="line">#<span class="built_in">text</span>(<span class="string">"log"</span>+log.date)#</div><div class="line"><span class="keyword">where</span></div></pre></td></tr></table></figure>
<blockquote>
<h4 id="æ³¨æ„-4"><a href="#æ³¨æ„-4" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  textå‡½æ•°ç›´æ¥è¾“å‡ºè¡¨è¾¾å¼åˆ°sqlè¯­å¥ï¼Œè€Œä¸æ˜¯è¾“å‡ºï¼Ÿã€‚</p>
</blockquote>
<p>åŒæ ·ï¼Œæ ¹æ®è¾“å…¥æ¡ä»¶å†³å®šå»å“ªä¸ªè¡¨ï¼Œæˆ–è€…æŸ¥è¯¢æ‰€æœ‰è¡¨</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@ var tables = getLogTables();</div><div class="line">@ for(table in tables)&#123;</div><div class="line">select * from #text(table)#</div><div class="line">@		if(!tableLP.isLast) print("union");</div><div class="line">@&#125;</div><div class="line">where name = #name#</div></pre></td></tr></table></figure>
<h3 id="19-è·¨æ•°æ®åº“å¹³å°"><a href="#19-è·¨æ•°æ®åº“å¹³å°" class="headerlink" title="19. è·¨æ•°æ®åº“å¹³å°"></a>19. è·¨æ•°æ®åº“å¹³å°</h3><p>å¦‚å‰æ‰€è¿°ï¼ŒBeetlSql å¯ä»¥é€šè¿‡sqlæ–‡ä»¶çš„ç®¡ç†å’Œæœç´¢æ¥æ”¯æŒè·¨æ•°æ®åº“å¼€å‘ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå…ˆæœç´¢ç‰¹å®šæ•°æ®åº“ï¼Œç„¶åå†æŸ¥æ‰¾commonã€‚å¦å¤–BeetlSqlä¹Ÿæä¾›äº†ä¸€äº›å¤¸æ•°æ®åº“è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>DbStyle æè¿°äº†æ•°æ®åº“ç‰¹æ€§ï¼Œæ³¨å…¥insertè¯­å¥ï¼Œç¿»é¡µè¯­å¥éƒ½é€šè¿‡å…¶å­ç±»å®Œæˆï¼Œç”¨æˆ·æ— éœ€æ“å¿ƒ</li>
<li>æä¾›ä¸€äº›é»˜è®¤çš„å‡½æ•°æ‰©å±•ï¼Œä»£æ›¿å„ä¸ªæ•°æ®åº“çš„å‡½æ•°ï¼Œå¦‚æ—¶é—´å’Œæ—¶é—´æ“ä½œå‡½æ•°dateç­‰</li>
<li>MySqlStyle mysql æ•°æ®åº“æ”¯æŒ</li>
<li>OracleStyle oralceæ”¯æŒ</li>
<li>PostgresStyle postgresæ•°æ®åº“æ”¯æŒ</li>
<li>å…¶ä»–è¿˜æœ‰SQLServer,H2,SQLLite ï¼ŒDB2æ•°æ®åº“æ”¯æŒ</li>
</ul>
<h3 id="20-ä»£ç ç”Ÿæˆ"><a href="#20-ä»£ç ç”Ÿæˆ" class="headerlink" title="20. ä»£ç ç”Ÿæˆ"></a>20. ä»£ç ç”Ÿæˆ</h3><h4 id="20-1-ç”Ÿæˆpojo-å’Œ-mdæ–‡ä»¶"><a href="#20-1-ç”Ÿæˆpojo-å’Œ-mdæ–‡ä»¶" class="headerlink" title="20.1. ç”Ÿæˆpojo å’Œ mdæ–‡ä»¶"></a>20.1. ç”Ÿæˆpojo å’Œ mdæ–‡ä»¶</h4><p>â€‹beetsqlæ”¯æŒè°ƒç”¨SQLManager.genâ€¦ æ–¹æ³•ç”Ÿæˆè¡¨å¯¹åº”çš„pojoç±»ï¼Œå¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQLManager sqlManager = <span class="keyword">new</span> SQLManager(style,loader,cs,<span class="keyword">new</span> DefaultNameConversion(), <span class="keyword">new</span> Interceptor[]&#123;<span class="keyword">new</span> DebugInterceptor()&#125;);</div><div class="line"><span class="comment">//sql.genPojoCodeToConsole("userRole"); å¿«é€Ÿç”Ÿæˆï¼Œæ˜¾ç¤ºåˆ°æ§åˆ¶å°</span></div><div class="line"><span class="comment">// æˆ–è€…ç›´æ¥ç”Ÿæˆjavaæ–‡ä»¶</span></div><div class="line">GenConfig config = <span class="keyword">new</span> GenConfig();</div><div class="line">config.preferBigDecimal(<span class="keyword">true</span>);</div><div class="line">config.setBaseClass(<span class="string">"com.test.User"</span>);</div><div class="line">sqlManager.genPojoCode(<span class="string">"UserRole"</span>,<span class="string">"com.test"</span>,config);</div></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„è·¯å¾„ä½äºå·¥ç¨‹çš„scrç›®å½•ä¸‹ï¼Œbeetlsqlè‡ªåŠ¨åˆ¤æ–­æ˜¯ä¼ ç»Ÿjavaé¡¹ç›®è¿˜æ˜¯mavené¡¹ç›®ï¼Œä»¥ä½¿å¾—ç”Ÿæˆçš„ä»£ç å’Œsqlæ”¾åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨GenKit.setSrcPathRelativeToSrc æ¥è®¾ç½®ä»£ç ç”Ÿæˆè·¯å¾„ï¼Œè°ƒç”¨setResourcePathRelativeToSrcæ¥è®¾ç½®ç”Ÿæˆçš„sqlæ–‡ä»¶è·¯å¾„</p>
<p>config ç±»ç”¨æ¥é…ç½®ç”Ÿæˆå–œçˆ±,ç›®å‰æ”¯æŒç”Ÿæˆpojoæ˜¯å¦ç»§æ‰¿æŸä¸ªåŸºç±», æ˜¯å¦ç”¨BigDecimalä»£æ›¿Double,æ˜¯å¦é‡‡ç”¨Dateè€Œä¸æ˜¯Timestampæ¥è¡¨ç¤ºæ—¥æœŸï¼Œæ˜¯å¦æ˜¯ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°è€Œä¸æ˜¯æ–‡ä»¶ç­‰ ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.test;</div><div class="line"><span class="keyword">import</span> java.math.*;</div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRole</span> <span class="keyword">extends</span> <span class="title">com</span>.<span class="title">test</span>.<span class="title">User</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line"></div><div class="line">    <span class="comment">/* æ•°æ®åº“æ³¨é‡Š */</span></div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è‡ªå·±è®¾å®šè¾“å‡ºæ¨¡ç‰ˆï¼Œé€šè¿‡GenConfig.initTemplate(String classPath),æŒ‡å®šæ¨¡ç‰ˆæ–‡ä»¶åœ¨classpath çš„è·¯å¾„ï¼Œæˆ–è€…ç›´æ¥è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡ç‰ˆ GenConfig.initStringTemplate. ç³»ç»Ÿé»˜è®¤çš„æ¨¡ç‰ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> $&#123;<span class="keyword">package</span>&#125;;</div><div class="line">$&#123;imports&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">* $&#123;comment&#125;</div><div class="line">* gen by beetsql $&#123;date(),"yyyy-MM-dd"&#125;</div><div class="line">*/</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;className&#125; $&#123;!isEmpty(ext)?<span class="string">"extends "</span>+ext&#125; &#123;</div><div class="line">	<span class="meta">@for</span>(attr in attrs)&#123;</div><div class="line">	@		<span class="keyword">if</span>(!isEmpty(attr.comment))&#123;</div><div class="line">	<span class="comment">//$&#123;attr.comment&#125;</span></div><div class="line">	@		&#125;</div><div class="line">	<span class="keyword">private</span> $&#123;attr.type&#125; $&#123;attr.name&#125; ;</div><div class="line">	@&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœä½ éœ€è¦ç»™beetlæ¨¡æ¿æ³¨å†Œå‡½æ•°ç­‰æ‰©å±•ï¼Œå¯ä»¥åœ¨ç”ŸæˆsqlManager.genPojoCodeä¹‹å‰ï¼Œå…ˆæ³¨å†Œæ‰©å±•å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SourceGen.gt.registerFunction(<span class="string">"xxx"</span>,yourFunction)</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥å†ä»£ç æ¨¡æ¿é‡Œä½¿ç”¨æ‰©å±•å‡½æ•°äº†</p>
<h4 id="20-2-ç”Ÿæˆæ›´å¤šçš„ä»£ç "><a href="#20-2-ç”Ÿæˆæ›´å¤šçš„ä»£ç " class="headerlink" title="20.2. ç”Ÿæˆæ›´å¤šçš„ä»£ç "></a>20.2. ç”Ÿæˆæ›´å¤šçš„ä»£ç </h4><p>å¯ä»¥å®ç°MapperCodeGençš„genCodeæ¥å£ï¼Œç„¶åæ·»åŠ åˆ° GenConfigé‡Œï¼Œè¿™æ ·å†ç”Ÿæˆä»£ç åï¼Œä¹Ÿä¼šè°ƒç”¨è‡ªå®šä¹‰çš„MapperCodeGenæ¥ç”Ÿæˆæ›´å¤šä»£ç ã€‚å¦‚ç³»ç»Ÿå†…ç½®çš„ç”ŸæˆMapperçš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MapperCodeGen mapper = <span class="keyword">new</span> MapperCodeGen(<span class="string">"com.dao"</span>);</div><div class="line">config.codeGens.add(mapper);</div><div class="line">sql.genPojoCodeToConsole(<span class="string">"user"</span>, config);</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œé™¤äº†ç”Ÿæˆpojoä»£ç å¤–ï¼Œè¿˜ç”Ÿæˆmapperä»£ç ï¼Œå†…ç½®çš„mapperä»£ç å®ç°å¦‚ä¸‹ï¼Œä¾›å‚è€ƒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperCodeGen</span> <span class="keyword">implements</span> <span class="title">CodeGen</span> </span>&#123;</div><div class="line">	String pkg = <span class="keyword">null</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MapperCodeGen</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MapperCodeGen</span><span class="params">(String pkg)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.pkg = pkg;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String mapperTemplate=<span class="string">""</span>;</div><div class="line">	<span class="keyword">static</span> &#123;</div><div class="line">		mapperTemplate = GenConfig.getTemplate(<span class="string">"/org/beetl/sql/ext/gen/mapper.btl"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">genCode</span><span class="params">(String entityPkg, String entityClass, TableDesc tableDesc,GenConfig config,<span class="keyword">boolean</span> isDisplay)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span>(pkg==<span class="keyword">null</span>)&#123;</div><div class="line">			pkg = entityPkg;</div><div class="line">		&#125;</div><div class="line">		Template template = SourceGen.gt.getTemplate(mapperTemplate);</div><div class="line">		String mapperClass = entityClass+<span class="string">"Dao"</span>;</div><div class="line">		template.binding(<span class="string">"className"</span>, mapperClass);</div><div class="line">		template.binding(<span class="string">"package"</span>,pkg);</div><div class="line">		template.binding(<span class="string">"entityClass"</span>, entityClass);</div><div class="line"></div><div class="line">		String mapperHead = <span class="string">"import "</span>+entityPkg+<span class="string">".*;"</span>+SourceGen.CR;</div><div class="line">		template.binding(<span class="string">"imports"</span>, mapperHead);</div><div class="line">		String mapperCode = template.render();</div><div class="line">		<span class="keyword">if</span>(isDisplay)&#123;</div><div class="line">			System.out.println();</div><div class="line">			System.out.println(mapperCode);</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				SourceGen.saveSourceFile(GenKit.getJavaSRCPath(), pkg, mapperClass, mapperCode);</div><div class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"mapperä»£ç ç”Ÿæˆå¤±è´¥"</span>,e);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="21-ç›´æ¥ä½¿ç”¨SQLResult"><a href="#21-ç›´æ¥ä½¿ç”¨SQLResult" class="headerlink" title="21. ç›´æ¥ä½¿ç”¨SQLResult"></a>21. ç›´æ¥ä½¿ç”¨SQLResult</h3><p>æœ‰æ—¶å€™ï¼Œä¹Ÿè®¸ä½ åªéœ€è¦SQLåŠå…¶å‚æ•°åˆ—è¡¨ï¼Œç„¶åä¼ ç»™ä½ è‡ªå·±çš„daoå·¥å…·ç±»ï¼Œè¿™æ—¶å€™ä½ éœ€è¦SQLResultï¼Œå®ƒåŒ…å«äº†ä½ éœ€è¦çš„sqlï¼Œå’Œsqlå‚æ•°ã€‚ SQLManager æœ‰å¦‚ä¸‹æ–¹æ³•ï¼Œä½ éœ€è¦ä¼ å…¥sqlidï¼Œå’Œå‚æ•°å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> SQLResult <span class="title">getSQLResult</span><span class="params">(String id, Map&lt;String, Object&gt; paras)</span></span></div></pre></td></tr></table></figure>
<p>paras æ˜¯ä¸€ä¸ªmapï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªpojoä½œä¸ºå‚æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ_rootâ€ ä½œä¸ºkeyï¼Œè¿™æ ·sqlæ¨¡ç‰ˆæ‰¾ä¸åˆ°åç§°å¯¹åº”çš„å±æ€§å€¼çš„æ—¶å€™ï¼Œä¼šå¯»æ‰¾_root å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å–å…¶åŒåå±æ€§ã€‚</p>
<p>SQLResult å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SQLResult</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> String jdbcSql;</div><div class="line">	<span class="keyword">public</span> List&lt;SQLParameter&gt; jdbcPara;</div><div class="line">  	<span class="keyword">public</span> Object[] toObjectArray()&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jdbcSqlæ˜¯æ¸²æŸ“è¿‡åçš„sqlï¼ŒjdbcPara æ˜¯å¯¹åº”çš„å‚æ•°æè¿°ï¼ŒtoObjectArray æ˜¯sqlå¯¹åº”çš„å‚æ•°å€¼ã€‚</p>
<p>SQLParameter ç”¨æ¥æè¿°å‚æ•°ï¼Œä¸»è¦åŒ…å«äº†</p>
<ul>
<li>value: å‚æ•°å€¼</li>
<li>expression ï¼Œå‚æ•°å¯¹åº”çš„è¡¨è¾¾å¼,å¦‚ä¸‹sql</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = #<span class="keyword">id</span>#</div></pre></td></tr></table></figure>
<p>åˆ™expression å°±æ˜¯å­—ç¬¦ä¸²id</p>
<ul>
<li><p>typeï¼Œexpression ç±»å‹ï¼Œå› ä¸ºsqlé‡Œæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œå› æ­¤typeæœ‰å¦‚ä¸‹å€¼</p>
<p>NAME_GENEARL:ç®€å•çš„è¡¨è¾¾å¼ï¼Œå¦‚id</p>
<p>NAME_EXPRESSIONï¼šå¤æ‚è¡¨è¾¾å¼ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨ï¼Œé€»è¾‘è¿ç®—è¡¨è¾¾å¼</p>
</li>
</ul>
<p>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåªéœ€å‘€å…³å¿ƒsqlå¯¹åº”çš„å‚æ•°å€¼å³å¯ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨toObjectArrayå¾—åˆ°ã€‚</p>
<h3 id="22-Hibernate-MyBatis-BeetlSQL-å¯¹æ¯”"><a href="#22-Hibernate-MyBatis-BeetlSQL-å¯¹æ¯”" class="headerlink" title="22. Hibernate,MyBatis,BeetlSQL å¯¹æ¯”"></a>22. Hibernate,MyBatis,BeetlSQL å¯¹æ¯”</h3><p><a href="https://my.oschina.net/xiandafu/blog/617542" target="_blank" rel="external">https://my.oschina.net/xiandafu/blog/617542</a> æä¾›äº†12é¡¹å¯¹æ¯”å¹¶ç»™ä¸è¯„åˆ†ã€‚åœ¨çŠ¹è±«ä½¿ç”¨BeetlSQLï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªå…¨é¢çš„å¯¹æ¯”æ–‡ç« </p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="static/beetlsql1.png" alt="beetlsql1" title="">
                </div>
                <div class="image-caption">beetlsql1</div>
            </figure>
<h3 id="23-ORM"><a href="#23-ORM" class="headerlink" title="23. ORM"></a>23. ORM</h3><blockquote>
<h4 id="æ³¨æ„-5"><a href="#æ³¨æ„-5" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><ul>
<li>BeetlSqlçš„Pojoç±»ä¸æ•°æ®åº“è¡¨å¯¹åº”ï¼Œæ²¡æœ‰å…³ç³»æ˜ å°„ç›¸å…³ç‰¹æ€§ï¼Œé™¤éPojoå®ç°@Tail æˆ–è€…ç»§æ‰¿TailBeanï¼ˆæˆ–è€…å®ç°Tailæ¥å£ï¼‰ï¼Œé¢å¤–çš„å…³ç³»æ˜ å°„æ‰ä¼šæ”¾åˆ°tailå±æ€§é‡Œä¾›æŸ¥è¯¢çš„æ—¶å€™è°ƒç”¨ã€‚</li>
<li>è¦æ³¨æ„çš„æ˜¯ï¼Œbeetlsqlçš„orm ä»…ä»…é™äºæŸ¥è¯¢ç»“æœé›†ï¼Œè€Œä¸åŒ…æ‹¬æ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤ã€‚è¿™äº›éœ€è¦è°ƒç”¨sqlManagerçš„apiç›´æ¥æ“ä½œå°±è¡Œäº†è€Œä¸åƒJPAé‚£æ ·è¿˜éœ€è¦æˆä¸ºå®¹å™¨ç®¡ç†å¯¹è±¡æ‰èƒ½æ›´æ–°</li>
<li>æ— è®ºæ˜¯sqlè¯­å¥é‡Œé…ç½®ormæŸ¥è¯¢,è¿˜æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½®ormæŸ¥è¯¢,éƒ½ä¸å¼ºæ±‚æ•°æ®åº“ä¸€å®šæœ‰æ­¤æ˜ å°„å…³ç³»,åªè¦å½“è¿è¡Œè°ƒç”¨çš„æ—¶å€™æ‰ä¼šè§¦å‘ormæŸ¥è¯¢.å¯¹äºeageræŸ¥è¯¢,å½“è°ƒç”¨beetlsqlçš„æ—¶å€™,ä¼šè§¦å‘ORMæŸ¥è¯¢,å¯¹äºlazyæŸ¥è¯¢,å¹¶ä¸ä¼šè§¦å‘,åªä¼šåœ¨è·å–å…³ç³»å±æ€§çš„æ—¶å€™çš„,å†è§¦å‘.</li>
</ul>
</blockquote>
<h4 id="23-1-sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢"><a href="#23-1-sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢" class="headerlink" title="23.1. sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢"></a>23.1. sqlè¯­å¥é‡Œçš„ORMæŸ¥è¯¢</h4><p>beetlsql å…³ç³»æ˜ å°„æ˜¯åœ¨sqlè¯­å¥é‡Œé€šè¿‡orm.singleå’Œ orm.many,orm.lazySingle,orm.lazyMany å‡½æ•°è¿›è¡Œç”³æ˜ã€‚beetlsqlä¼šæ ¹æ®è¿™äº›ç”³æ˜æ¥å®Œæˆå…³ç³»æ˜ å°„</p>
<p>orm.single,orm.many ,orm.lazySingle,orm.lazyManyå‡½æ•°åå­—æœ¬èº«è¯´æ˜äº†æ˜¯ä¸€å¯¹ä¸€ï¼Œè¿˜æ˜¯ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šã€‚ä»¥åŠæ˜¯ç›´æ¥åŠ è½½è¿˜æ˜¯æ‡’åŠ è½½ã€‚å‡½æ•°å¯ä»¥æ”¾åœ¨sqlè¯­å¥ä»»ä½•åœ°æ–¹ï¼Œå»ºè®®æ”¾åˆ°å¤´éƒ¨æˆ–è€…å°¾éƒ¨ï¼Œå‚æ•°æ ¼å¼æœ‰ä¿©ç§å½¢å¼ï¼Œ</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ¿æ–¹å¼æŸ¥è¯¢å…³ç³»å¯¹è±¡ï¼Œorm.single({â€œdepartmentIdâ€,â€idâ€},â€Departmentâ€) ç¬¬ä¸€ä¸ªå‚æ•°ç”³æ˜äº†å…³ç³»æ˜ å°„ï¼Œå³sqlæŸ¥è¯¢ç»“æœé‡Œå±æ€§ï¼ˆéå­—æ®µå)ï¼Œå¯¹åº”åˆ°å…³ç³»è¡¨çš„æŸ¥è¯¢å±æ€§ï¼Œ å¦‚Userå¯¹è±¡é‡Œï¼ŒdepartmentIdåº”åˆ°Departmentå¯¹è±¡çš„idï¼Œbeetlsqlä¼šæ ¹æ®æ­¤å…³ç³»å‘èµ·ä¸€æ¬¡templateæŸ¥è¯¢ã€‚æ˜ å°„çš„ç»“æœé›†æ”¾åœ¨ç¬¬äºŒä¸ªå‚æ•°Departmentç±»é‡Œï¼Œå¦‚æœDepartmentä¸Userç±»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œå¯ä»¥çœç•¥åŒ…åï¼Œå¦åˆ™éœ€è¦åŠ ä¸Šç±»åŒ…å</li>
<li>ä½¿ç”¨sqlIdæ¥æŸ¥è¯¢å…³ç³»å¯¹è±¡ï¼Œorm.single({â€œdepartmentIdâ€,â€idâ€},â€user.selectDepatmentâ€,â€Departmentâ€) ç¬¬ä¸€ä¸ªå‚æ•°è¿˜æ˜¯æ˜ å°„å…³ç³»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€sqlæŸ¥è¯¢idï¼Œbeetlsqlå°†æŸ¥è¯¢æ­¤sqlè¯­å¥ï¼Œå°†ç»“æœé›†æ”¾åˆ°ç¬¬ä¸‰ä¸ªå‚æ•°Deparmtentç±»é‡Œ</li>
<li>lazy æ„å‘³ç€å½“è°ƒç”¨çš„æ—¶å€™å†åŠ è½½ã€‚å¦‚æœåœ¨äº‹åŠ¡å¤–è°ƒç”¨ï¼Œå¹¶ä¸ä¼šåƒhibernateï¼ŒJPAé‚£æ ·æŠ¥é”™ï¼Œbeetlsqlä¼šå†ç”¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥å»æŸ¥è¯¢ã€‚ä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœä¸šåŠ¡ä»£ç ç¡®å®šè¦ç”¨ï¼Œå»ºè®®ä¸ç”¨lazyæ–¹å¼ã€‚å› ä¸ºlazyä¸ä¼šæœ‰æŸ¥è¯¢ä¼˜åŒ–ï¼Œæ€§èƒ½å¯èƒ½æ…¢ä¸€äº›</li>
</ul>
<p>å¦‚ä¸ŠæŸ¥è¯¢å…³ç³»å¯¹è±¡ï¼Œå‡æ”¾åˆ°tailå±æ€§é‡Œï¼Œåç§°å°±æ˜¯ç±»åå°å†™å¼€å¤´ï¼Œå¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">User user = sqlManager.select(<span class="string">"user.selectUserAndDepartment"</span>,User.class,paras); Department dept = user.get(<span class="string">"department"</span>);</div></pre></td></tr></table></figure>
<p>å¦‚ä¸‹æ˜¯ä¸ªä¾‹å­ï¼Œå‡è®¾userè¡¨ä¸departmentè¡¨ç¤ºä¸€å¯¹ä¸€å…³ç³»ï¼Œuser.departmentIdå¯¹åº”äºdeparment.id,å› æ­¤å…³ç³»æ˜ å°„æ˜¯{â€œdepartmentIdâ€:â€idâ€} userä¸ roleè¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼Œé€šè¿‡user_roleåšå…³è”</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="section">selectUserAndDepartment</span></div><div class="line">===</div><div class="line"><span class="code">	select * from user where user_id=#userId#</span></div><div class="line"><span class="code">	@ orm.single(&#123;"departmentId":"id"&#125;,"Department");</span></div><div class="line"><span class="code">	@ orm.many(&#123;"id":"userId"&#125;,"user.selectRole","Role");</span></div><div class="line"></div><div class="line"><span class="section">user.selectRole</span></div><div class="line">===</div><div class="line"></div><div class="line"><span class="code">	select r.* from user_role ur left join role r on ur.role_id=r.id</span></div><div class="line"></div><div class="line"><span class="code">	where ur.user_id=#userId#</span></div></pre></td></tr></table></figure>
<p>javaä»£ç çš„æ ·å­:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User user = sqlManager.select(<span class="string">"user.selectUserAndDepartment"</span>,User.class,paras);</div><div class="line">Department dept = user.get(<span class="string">"department"</span>);</div><div class="line">List&lt;Role&gt; roles = user.get(<span class="string">"role"</span>);</div></pre></td></tr></table></figure>
<p>å®Œæ•´çš„ormæŸ¥è¯¢ä¾‹å­å¯ä»¥å‚è€ƒ <a href="https://code.csdn.net/xiandafu/beetlsql_orm_sample/tree/master" target="_blank" rel="external">https://code.csdn.net/xiandafu/beetlsql_orm_sample/tree/master</a> è¿˜æœ‰æ–‡æ¡£</p>
<p><a href="http://my.oschina.net/xiandafu/blog/735809" target="_blank" rel="external">http://my.oschina.net/xiandafu/blog/735809</a></p>
<blockquote>
<h4 id="æ³¨æ„-6"><a href="#æ³¨æ„-6" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  lazyæ–¹å¼åªèƒ½ç»§æ‰¿TailBeanæ‰è¡Œï¼Œå¦‚æœå®ç°Tailæ¥å£ï¼Œæˆ–è€…@Tailï¼Œä½ å–å‡ºæ¥çš„å¯¹è±¡å¹¶ä¸æ˜¯ä½ æœŸæœ›çš„Pojoï¼Œè€Œæ˜¯LazyEntityï¼Œä½ è¿˜éœ€è¦è°ƒç”¨get()æ–¹æ³•è·å–åˆ°æœŸæ•°æ®åº“æŸ¥è¯¢ç»“æœ ï¼Œå¯ä»¥å‚çœ‹TailBeanä»£ç æ¥å®ç°ä½ çš„Lazyæ”¯æŒ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TailBean</span> <span class="keyword">implements</span> <span class="title">Tail</span> </span>&#123;</div><div class="line">	<span class="keyword">protected</span> Map&lt;String,Object&gt; extMap = <span class="keyword">new</span> HashMap&lt;String,Object&gt;();</div><div class="line">	<span class="keyword">boolean</span> hasLazy = <span class="keyword">false</span> ;</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(hasLazy)&#123;</div><div class="line">			Object o = extMap.get(key);</div><div class="line">			<span class="keyword">if</span>(o <span class="keyword">instanceof</span> LazyEntity )&#123;</div><div class="line">				LazyEntity lazyEntity = (LazyEntity)o;</div><div class="line">				<span class="keyword">try</span>&#123;</div><div class="line">					Object real = lazyEntity.get();</div><div class="line">					extMap.put(key, real);</div><div class="line">					<span class="keyword">return</span> real;</div><div class="line">				&#125;<span class="keyword">catch</span>(RuntimeException ex)&#123;</div><div class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> BeetlSQLException(BeetlSQLException.ORM_LAZY_ERROR,<span class="string">"Lazy Load Error:"</span>+key+<span class="string">","</span>+ex.getMessage(),ex);</div><div class="line">				&#125;</div><div class="line">			&#125;<span class="keyword">else</span>&#123;</div><div class="line">				<span class="keyword">return</span> o;</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> extMap.get(key);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key,Object value)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(value <span class="keyword">instanceof</span> LazyEntity )&#123;</div><div class="line">			hasLazy = <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">this</span>.extMap.put(key, value);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="23-2-ORM-æ³¨è§£"><a href="#23-2-ORM-æ³¨è§£" class="headerlink" title="23.2. ORM æ³¨è§£"></a>23.2. ORM æ³¨è§£</h4><p>ä¸å¿…è¦ä¸ºæ¯ä¸ªsqlè¯­å¥å†™æ˜ å°„å…³ç³»æˆ–è€…æ˜¯ä½¿ç”¨ä¸€ä¸ªå…¬å…±çš„æ˜ å°„å…³ç³»,å¯ä»¥åœ¨æ˜ å°„çš„å®ä½“ç±»ä¸Šæ³¨è§£æ˜ å°„å…³ç³»ä»è€Œå®ç°æ‡’åŠ è½½æœºåˆ¶,å¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@OrmQuery</span>(</div><div class="line">value=&#123;</div><div class="line">	<span class="meta">@OrmCondition</span>(target=Department.class,attr=<span class="string">"departmentId"</span>,targetAttr=<span class="string">"id"</span>,type=OrmQuery.Type.ONE),</div><div class="line">	<span class="meta">@OrmCondition</span>(target=ProductOrder.class,attr=<span class="string">"id"</span>,targetAttr=<span class="string">"userId"</span> ,type=OrmQuery.Type.MANY),</div><div class="line">	<span class="meta">@OrmCondition</span>(target=Role.class,attr=<span class="string">"id"</span>,targetAttr=<span class="string">"userId"</span> ,sqlId=<span class="string">"user.selectRole"</span>,type=OrmQuery.Type.MANY)</div><div class="line"></div><div class="line">&#125;</div><div class="line">)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>   <span class="keyword">extends</span> <span class="title">TailBean</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Integer id ;</div><div class="line">	<span class="keyword">private</span> String name ;</div><div class="line">	<span class="keyword">private</span> Integer departmentId;</div><div class="line"></div><div class="line">	<span class="comment">//å¿½ç•¥getter setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>OrmQuery æ ‡æ³¨åœ¨ç±»ä¸Š,OrmCondition å£°æ˜äº†ä¸€ä¸ªæ‡’åŠ è½½å…³ç³».å› æ­¤,åœ¨ä»¥åbeetlsqlçš„å…³äºæ­¤å®ä½“çš„æŸ¥è¯¢,éƒ½å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨æ‡’åŠ è½½æŸ¥è¯¢.</p>
<p>å¦‚æœsqlè¯­å¥é‡Œä¹Ÿç”³æ˜äº†ORMæŸ¥è¯¢,åˆ™ä¼šå’Œæ³¨è§£çš„é‡ŒORMæ³¨è§£åšåˆå¹¶,é‡åˆ°æ˜ å°„åŒä¸€ä¸ªå®ä½“,åˆ™ä»¥sqlè¯­å¥é‡Œçš„æ˜ å°„é…ç½®ä¸ºå‡†</p>
<h3 id="24-é›†æˆå’ŒDemo"><a href="#24-é›†æˆå’ŒDemo" class="headerlink" title="24. é›†æˆå’ŒDemo"></a>24. é›†æˆå’ŒDemo</h3><h4 id="24-1-Springé›†æˆå’ŒDemo"><a href="#24-1-Springé›†æˆå’ŒDemo" class="headerlink" title="24.1. Springé›†æˆå’ŒDemo"></a>24.1. Springé›†æˆå’ŒDemo</h4><p>é›†æˆæä¾›äº†Mapperç±»çš„è‡ªåŠ¨æ³¨å…¥ä»¥åŠSQLManagerçš„è‡ªåŠ¨æ³¨å…¥,ä»¥åŠä¸springäº‹åŠ¡é›†æˆ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- DAOæ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"beetlSqlScannerConfigurer"</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.ext.spring4.BeetlSqlScannerConfigurer"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- å“ªäº›ç±»å¯ä»¥è‡ªåŠ¨æ³¨å…¥ --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"org.beetl.sql.ext.spring4"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- é€šè¿‡ç±»åç¼€ æ¥è‡ªåŠ¨æ³¨å…¥Dao --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"daoSuffix"</span> <span class="attr">value</span>=<span class="string">"Dao"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlManagerFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlManagerFactoryBean"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlManagerFactoryBean"</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.ext.spring4.SqlManagerFactoryBean"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cs"</span> &gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">"org.beetl.sql.ext.spring4.BeetlSqlDataSource"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"masterSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dbStyle"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.core.db.H2Style"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlLoader"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.core.ClasspathLoader"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlRoot"</span> <span class="attr">value</span>=<span class="string">"/sql"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nc"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.core.UnderlinedNameConversion"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptors"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.beetl.sql.ext.DebugInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>BeetlSqlScannerConfigurer æ ¹æ®åŒ…åå’Œç±»åç¼€æ¥è‡ªåŠ¨æ³¨å…¥Daoç±»,å¦‚æœæ²¡æœ‰Dao,å¯ä»¥ä¸é…ç½®æ­¤é¡¹</li>
<li>cs: æŒ‡å®šConnectionSourceï¼Œå¯ä»¥ç”¨ç³»ç»Ÿæä¾›çš„DefaultConnectionSourceï¼Œæ”¯æŒæŒ‰ç…§CRUDå†³å®šä¸»ä»ã€‚ä¾‹å­é‡Œåªæœ‰ä¸€ä¸ªmasteråº“</li>
<li>dbStyle: æ•°æ®åº“ç±»å‹ï¼Œç›®å‰åªæ”¯æŒorg.beetl.sql.core.db.MySqlStyleï¼Œä»¥åŠOralceSytleï¼ŒPostgresStyleï¼ŒSQLiteStyleï¼ŒSqlServerStyleï¼ŒH2Style</li>
<li>sqlLoader: sqlè¯­å¥åŠ è½½æ¥æº</li>
<li>nc: å‘½åè½¬åŒ–ï¼Œæœ‰é»˜è®¤çš„DefaultNameConversionï¼Œæ•°æ®åº“è·Ÿç±»åä¸€è‡´ï¼Œè¿˜æœ‰æœ‰æ•°æ®åº“ä¸‹åˆ’çº¿çš„UnderlinedNameConversion,JPANameConversion,</li>
<li>interceptors:DebugInterceptor ç”¨æ¥æ‰“å°sqlè¯­å¥ï¼Œå‚æ•°å’Œæ‰§è¡Œæ—¶é—´</li>
</ul>
<p>æ³¨æ„ï¼š ä»»ä½•ä½¿ç”¨äº†Transactional æ³¨è§£çš„ï¼Œå°†ç»Ÿä¸€ä½¿ç”¨Masteræ•°æ®æºï¼Œä¾‹å¤–çš„æ˜¯@Transactional(readOnly=true),è¿™å°†è®©Beetsqlé€‰æ‹©ä»æ•°æ®åº“ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title">MyService</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">    UserDao dao; <span class="comment">// mapper</span></div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    SQLManager sql;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="meta">@Transactional</span>()</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> total = list .size();</div><div class="line">		dao.deleteById(User.class, <span class="number">3</span>);</div><div class="line">		User u =<span class="keyword">new</span> User();</div><div class="line">		u.id = <span class="number">3</span>;</div><div class="line">		u.name=<span class="string">"hello"</span>;</div><div class="line">		u.age = <span class="number">12</span>;</div><div class="line">		dao.insert(User.class, u);</div><div class="line">		<span class="keyword">return</span> total;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä»–é›†æˆé…ç½®è¿˜åŒ…æ‹¬:</p>
<ul>
<li>functions é…ç½®æ‰©å±•å‡½æ•°</li>
<li>tagFactorys é…ç½®æ‰©å±•æ ‡ç­¾</li>
<li>configFileResource æ‰©å±•é…ç½®æ–‡ä»¶ä½ç½®ï¼Œbeetlsqlå°†è¯»å–æ­¤é…ç½®æ–‡ä»¶è¦†ç›–beetlsqlé»˜è®¤é€‰é¡¹</li>
<li>defaultSchema æ•°æ®åº“è®¿é—®schema</li>
</ul>
<blockquote>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p>å¯ä»¥å‚è€ƒdemo <a href="https://git.oschina.net/xiandafu/springbeetlsql" target="_blank" rel="external">https://git.oschina.net/xiandafu/springbeetlsql</a></p>
</blockquote>
<h4 id="24-2-SpringBooté›†æˆ"><a href="#24-2-SpringBooté›†æˆ" class="headerlink" title="24.2. SpringBooté›†æˆ"></a>24.2. SpringBooté›†æˆ</h4><p>é‡‡ç”¨java configæ–¹å¼</p>
<p>å‚è€ƒ demo ï¼Œ<a href="http://git.oschina.net/xiandafu/springboot_beetl_beetlsql" target="_blank" rel="external">http://git.oschina.net/xiandafu/springboot_beetl_beetlsql</a></p>
<p>spring booté›†æˆéœ€è¦æ³¨æ„çš„æ˜¯è¦æ·»åŠ spring-devtools.propertiesæ–‡ä»¶,å¹¶é…ç½®å¦‚ä¸‹é€‰é¡¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">restart.include.beetl=/beetl-xxx.jar</div><div class="line">restart.include.beetlsql=/beetlsql-xxx..jar</div></pre></td></tr></table></figure>
<p>spring-devtools.properties ä¸ºspring bootçš„é…ç½®æ–‡ä»¶,ä½äºMETA-INFç›®å½•ä¸‹</p>
<h4 id="24-3-JFinalé›†æˆå’ŒDemo"><a href="#24-3-JFinalé›†æˆå’ŒDemo" class="headerlink" title="24.3. JFinalé›†æˆå’ŒDemo"></a>24.3. JFinalé›†æˆå’ŒDemo</h4><p>åœ¨configPlugin é‡Œé…ç½®BeetlSql</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">JFinalBeetlSql.init();</div></pre></td></tr></table></figure>
<p>é»˜è®¤ä¼šé‡‡ç”¨c3p0 ä½œä¸ºæ•°æ®æºï¼Œå…¶é…ç½®æ¥æºäºjfinal é…ç½®ï¼Œå¦‚æœä½ è‡ªå·±æä¾›æ•°æ®æºæˆ–è€…ä¸»ä»ï¼Œå¯ä»¥å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">JFinalBeetlSql.init(master,slaves);</div></pre></td></tr></table></figure>
<p>ç”±äºä½¿ç”¨äº†Beetlsqlï¼Œå› æ­¤ä½ æ— éœ€å†é…ç½® <strong>æ•°æ®åº“è¿æ¥æ± æ’ä»¶ï¼Œå’ŒActiveRecordPlugin</strong>,å¯ä»¥åˆ é™¤ç›¸å…³é…ç½®ã€‚</p>
<p>åœ¨controlleré‡Œï¼Œå¯ä»¥é€šè¿‡JFinalBeetlSql.dao æ–¹æ³•è·å–åˆ°SQLManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQLManager dao = JFinalBeetlSql.dao();</div><div class="line">BigBlog blog = getModel(BigBlog.class);</div><div class="line">dao.insert(BigBlog.class, blog);</div></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³æ§åˆ¶äº‹ç‰©ï¼Œè¿˜éœ€è¦æ³¨å†ŒTrans</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configInterceptor</span><span class="params">(Interceptors me)</span> </span>&#123;</div><div class="line">	me.addGlobalActionInterceptor(<span class="keyword">new</span> Trans());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åä¸šåŠ¡æ–¹æ³•ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Before</span>(Trans.class)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doXXX</span><span class="params">()</span></span>&#123;....&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•æ‰ä¼šæäº¤äº‹ç‰©ï¼Œä»»ä½•RuntimeExceptionå°†å›æ»šï¼Œå¦‚æœæƒ³æ‰‹å·¥æ§åˆ¶å›æ»š.ä¹Ÿå¯ä»¥é€šè¿‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Trans.commit()</div><div class="line">Trans.rollback()</div></pre></td></tr></table></figure>
<p>å¦‚æœä¹ æƒ¯äº†JFinal Recordæ¨¡å¼ï¼Œå»ºè®®ç”¨æˆ·åˆ›å»ºä¸€ä¸ªBaseBeanï¼Œå°è£…SQLManager CRUD æ–¹æ³•å³å¯ã€‚ç„¶åå…¶ä»–æ¨¡å‹ç»§æ‰¿æ­¤BaseBean</p>
<blockquote>
<h4 id="æ³¨æ„-7"><a href="#æ³¨æ„-7" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>  å¯ä»¥é€šè¿‡jfinalå±æ€§æ–‡ä»¶æ¥é…ç½®sqlManagerï¼Œæ¯”å¦‚ PropKit.use(â€œconfig.txtâ€, â€œUTF-8â€),ç„¶åå¯ä»¥é…ç½® sql.nc,sql.rootï¼Œsql.interceptorï¼Œsql.dbStyleï¼Œå…·ä½“å‚è€ƒæºä»£ç </p>
<p>  JFinalBeetlSql.initProp</p>
<h4 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p>  å¯ä»¥å‚è€ƒdemo <a href="https://git.oschina.net/xiandafu/jfinal_beet_beetsql_btjson" target="_blank" rel="external">https://git.oschina.net/xiandafu/jfinal_beet_beetsql_btjson</a></p>
<p>  demo <a href="https://code.csdn.net/xiandafu/beetlsql_orm_sample/tree/master" target="_blank" rel="external">https://code.csdn.net/xiandafu/beetlsql_orm_sample/tree/master</a></p>
</blockquote>
<h3 id="25-é«˜çº§éƒ¨åˆ†"><a href="#25-é«˜çº§éƒ¨åˆ†" class="headerlink" title="25. é«˜çº§éƒ¨åˆ†"></a>25. é«˜çº§éƒ¨åˆ†</h3><p>è¿™ç« è¡¥å……ä¸€ä¸‹ç»“æœé›†å’Œjavaç±»å‹çš„æ˜ å°„ï¼Œä»¥åŠäº‹åŠ¡ç®¡ç†</p>
<h4 id="25-1-ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–"><a href="#25-1-ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–" class="headerlink" title="25.1. ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–"></a>25.1. ResultSetç»“æœé›†åˆ°Beançš„è½¬åŒ–</h4><p>æ•°æ®åº“è¿”å›çš„ResultSetå°†æ ¹æ®Pojoå¯¹è±¡çš„å±æ€§æ¥åšé€‚å½“çš„è½¬åŒ–ï¼Œæ¯”å¦‚å¯¹äºæ•°æ®åº“å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæµ®ç‚¹ç±»å‹ï¼Œè€ŒJavaç«¯å±æ€§å¦‚æœæ˜¯doubleï¼Œåˆ™è½¬æˆdoubleï¼Œå¦‚æœæ˜¯BigDecimalï¼Œåˆ™è½¬æˆBigDecial,å¦‚æœå®šä¹‰ä¸ºintç±»å‹ï¼Œåˆ™è½¬ä¸ºintç±»å‹ã€‚BeanProcessor ç±»è´Ÿè´£å¤„ç†è¿™ç§è½¬åŒ–ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„BeanProcessoræ¥ä¸ºç‰¹å®šçš„sqlåšè½¬åŒ–ï¼Œæ¯”å¦‚å°†æ•°æ®åº“æ—¥æœŸç±»å‹è½¬ä¸ºJavaçš„Longç±»å‹ã€‚<br>å¦‚åœ¨BeanProcessor.createBeanä»£ç é‡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Class&lt;?&gt; propType = prop.getPropertyType();</div><div class="line">tp.setTarget(propType);</div><div class="line">JavaSqlTypeHandler handler = <span class="keyword">this</span>.handlers.get(propType);</div><div class="line"><span class="keyword">if</span>(handler==<span class="keyword">null</span>)&#123;</div><div class="line">	handler = <span class="keyword">this</span>.defaultHandler;</div><div class="line">&#125;</div><div class="line">Object value = handler.getValue(tp);</div><div class="line"><span class="keyword">this</span>.callSetter(bean, prop, value,propType);</div></pre></td></tr></table></figure>
<p>BeanProcessor ä¼šæ ¹æ®å±æ€§ç±»å‹å–å‡ºå¯¹åº”çš„å¤„ç†ç±»ï¼Œç„¶åå¤„ç†ResultSetï¼Œå¦‚æœä½ å…ˆè‡ªå®šä¹‰å¤„ç†ç±»ï¼Œä½ å¯ä»¥é‡æ–°æ·»åŠ ä¸€ä¸ªJavaSqlTypeHandleråˆ°handlers</p>
<h4 id="25-2-ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–"><a href="#25-2-ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–" class="headerlink" title="25.2. ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–"></a>25.2. ResultSetç»“æœé›†åˆ°Mapçš„è½¬åŒ–</h4><p>ResultSetè½¬ä¸ºMapçš„æ—¶å€™ï¼Œæœ‰ä¸ä¸€æ ·åˆ™ï¼Œæ ¹æ®æ•°æ®åº“è¿”å›çš„åˆ—ç±»å‹æ¥åšè½¬åŒ–ï¼Œæ•°æ®åº“å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæµ®ç‚¹ç±»å‹ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„BigDecimalç±»å‹</p>
<p>å¦‚åœ¨BeanProcessor.toMapä»£ç é‡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">String columnName = rsmd.getColumnLabel(i);</div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> == columnName || <span class="number">0</span> == columnName.length()) &#123;</div><div class="line">  columnName = rsmd.getColumnName(i);</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> colType = rsmd.getColumnType(i);</div><div class="line">Class  classType = JavaType.jdbcJavaTypes.get(colType);</div><div class="line">JavaSqlTypeHandler handler = handlers.get(classType);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(handler==<span class="keyword">null</span>)&#123;</div><div class="line">	handler = <span class="keyword">this</span>.defaultHandler;</div><div class="line">&#125;</div><div class="line">tp.setIndex(i);</div><div class="line">tp.setTarget(classType);</div><div class="line">Object value = handler.getValue(tp);</div></pre></td></tr></table></figure>
<p>JavaType å®šä¹‰äº†é»˜è®¤çš„æ•°æ®åº“ç±»å‹åˆ°Javaç±»å‹çš„è½¬åŒ–ï¼Œä»è€Œè·å–é€‚å½“çš„ JavaSqlTypeHandlerï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„handlerï¼Œä»…ä»…ä½¿ç”¨resultSet.getObject(i)æ¥è·å–å€¼<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤resultSet.getObject(i)æ¥å–å€¼ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸åŒæ•°æ®åº“å–çš„ç±»å‹ä¸ä¸€æ ·å¯¼è‡´ä¸å…¼å®¹ä¸åŒæ•°æ®åº“ã€‚<br>JavaTypeå·²ç»å®šä¹‰äº†ç»å¤§éƒ¨åˆ†æ•°æ®åº“ç±»å‹åˆ°Javaç±»å‹çš„è½¬åŒ–ï¼Œå°‘é‡å¾ˆå°‘ä½¿ç”¨çš„ç±»å‹æ²¡æœ‰å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨resultSet.getObject(i)å–å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//JavaType.java</span></div><div class="line"></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.LONGNVARCHAR), String.class); <span class="comment">// -16</span></div><div class="line">																			<span class="comment">// å­—ç¬¦ä¸²</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.NCHAR), String.class); <span class="comment">// -15 å­—ç¬¦ä¸²</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.NVARCHAR), String.class); <span class="comment">// -9 å­—ç¬¦ä¸²</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.ROWID), String.class); <span class="comment">// -8 å­—ç¬¦ä¸²</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.BIT), Boolean.class); <span class="comment">// -7 å¸ƒå°”</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.TINYINT), Integer.class); <span class="comment">// -6 æ•°å­—</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.BIGINT), Long.class); <span class="comment">// -5 æ•°å­—</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.LONGVARBINARY), <span class="keyword">byte</span>[].class); <span class="comment">// -4</span></div><div class="line">																	<span class="comment">// äºŒè¿›åˆ¶</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.VARBINARY), <span class="keyword">byte</span>[].class); <span class="comment">// -3 äºŒè¿›åˆ¶</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.BINARY), <span class="keyword">byte</span>[].class); <span class="comment">// -2 äºŒè¿›åˆ¶</span></div><div class="line">jdbcJavaTypes.put(<span class="keyword">new</span> Integer(Types.LONGVARCHAR), String.class); <span class="comment">// -1</span></div><div class="line"></div><div class="line">......</div></pre></td></tr></table></figure>
<p>æœ‰äº›æ¡†æ¶ï¼Œåœ¨ä½¿ç”¨Mapçš„æ—¶å€™ï¼Œæ·»åŠ äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œæ¯”å¦‚é€šè¿‡columnName æ¥ç‰‡æ®µæ˜¯å¦è¯¥å­—æ®µæ˜¯å­—å…¸å­—æ®µï¼Œæ¯”å¦‚è±†æ²¹åç¼€â€_dictâ€,å¦‚æœæ˜¯ï¼Œåˆ™ä»ç¼“å­˜æˆ–è€…æŸ¥è¯¢å“åº”çš„å­—å…¸æ•°æ®ï¼Œæ”¾åˆ°ThreadLocalé‡Œï¼Œä»¥ä¸€æ¬¡æ€§å°†æŸ¥è¯¢ç»“æœï¼Œç›¸å…³å­—å…¸æ•°æ®è¿”å›</p>
<h4 id="25-3-PreparedStatment"><a href="#25-3-PreparedStatment" class="headerlink" title="25.3. PreparedStatment"></a>25.3. PreparedStatment</h4><p>BeanProcessor.setPreparedStatementParaç”¨äºJDBCè®¾ç½®å‚æ•°ï¼Œå†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">setPreparedStatementPara</span><span class="params">(String sqlId,PreparedStatement ps,List&lt;SQLParameter&gt; objs)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objs.size(); i++) &#123;</div><div class="line">			SQLParameter para = objs.get(i);</div><div class="line">			Object o = para.value;</div><div class="line">			<span class="keyword">if</span>(o==<span class="keyword">null</span>)&#123;</div><div class="line">				ps.setObject(i + <span class="number">1</span>, o);</div><div class="line">				<span class="keyword">continue</span> ;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// å…¼å®¹æ€§ä¿®æ”¹ï¼šoralce é©±åŠ¨ ä¸è¯†åˆ«util.Date</span></div><div class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.dbName.equals(<span class="string">"oracle"</span>))&#123;</div><div class="line">				Class c = o.getClass();</div><div class="line">				<span class="keyword">if</span>(c== java.util.Date.class)&#123;</div><div class="line">					o = <span class="keyword">new</span> Timestamp(((java.util.Date) o).getTime());</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			<span class="keyword">if</span>(Enum.class.isAssignableFrom(o.getClass()))&#123;</div><div class="line">				o = EnumKit.getValueByEnum(o);</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			<span class="comment">//clob or text</span></div><div class="line">			<span class="keyword">if</span>(o.getClass()==<span class="keyword">char</span>[].class)&#123;</div><div class="line">				o = <span class="keyword">new</span> String((<span class="keyword">char</span>[])o);</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			</div><div class="line">			<span class="keyword">int</span> jdbcType = para.getJdbcType();</div><div class="line">			<span class="keyword">if</span>(jdbcType==<span class="number">0</span>)&#123;</div><div class="line">				ps.setObject(i + <span class="number">1</span>, o);</div><div class="line">			&#125;<span class="keyword">else</span>&#123;</div><div class="line">				<span class="comment">//é€šå¸¸ä¸€äº›ç‰¹æ®Šçš„å¤„ç†</span></div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(jdbcType+<span class="string">",é»˜è®¤å¤„ç†å™¨å¹¶æœªå¤„ç†æ­¤jdbcç±»å‹"</span>);</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>#### </p>
<p>SQLParameter åŒ…å«äº†sqlå¯¹åº”å‚æ•°çš„å€¼ï¼Œä¹ŸåŒ…å«å‚æ•°å¯¹åº”çš„å˜é‡åï¼Œå¦‚æœè¯¥å˜é‡è¿˜æœ‰ç±»å‹è¯´æ˜ï¼Œåˆ™jdbcTypeä¸ä¸º0ï¼Œå¦‚ä¸‹æŸä¸ªsql</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from user where create_time&gt;#createTime,typeofDate#</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼ŒSQLParameter.value æ˜¯createTimeå¯¹åº”çš„å€¼ï¼ŒSQLParameter.expressionæ˜¯å­—ç¬¦ä¸²â€createTimeâ€,</p>
<p>ç”±äºä½¿ç”¨äº†typeofå¼€å¤´çš„æ ¼å¼åŒ–å‡½æ•°ï¼ŒtypeofDate æ„æ€æ˜¯æŒ‡æ­¤å€¼åº”å½“ç€java.sql.Types.Date æ¥å¤„ç†ï¼ˆç„¶è€Œï¼Œé»˜è®¤çš„BeanProcessor å¹¶ä¸ä¼šå¤„ç†SQLParameter.jdbcTypeï¼‰</p>
<h4 id="25-4-è‡ªå®šä¹‰BeanProcessor"><a href="#25-4-è‡ªå®šä¹‰BeanProcessor" class="headerlink" title="25.4. è‡ªå®šä¹‰BeanProcessor"></a>25.4. è‡ªå®šä¹‰BeanProcessor</h4><p>ä½ å¯ä»¥ä¸ºBeeetsqlæŒ‡å®šä¸€ä¸ªé»˜è®¤çš„BeanProcessorï¼Œä¹Ÿå¯ä»¥ä¸ºæŸäº›ç‰¹å®šçš„sqlidæŒ‡å®šBeanProcessorï¼ŒSqlManageræä¾›äº†ä¿©ä¸ªæ–¹æ³•æ¥å®Œæˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultBeanProcessors</span><span class="params">(BeanProcessor defaultBeanProcessors)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.defaultBeanProcessors = defaultBeanProcessors;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProcessors</span><span class="params">(Map&lt;String, BeanProcessor&gt; processors)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.processors = processors;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="25-5-äº‹åŠ¡ç®¡ç†"><a href="#25-5-äº‹åŠ¡ç®¡ç†" class="headerlink" title="25.5. äº‹åŠ¡ç®¡ç†"></a>25.5. äº‹åŠ¡ç®¡ç†</h4><p>BeetlSql æ˜¯ä¸€ä¸ªç®€å•çš„Daoå·¥å…·ï¼Œä¸å«æœ‰äº‹åŠ¡ç®¡ç†ï¼Œå®Œå…¨ä¾èµ–webæ¡†æ¶çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œç›‘å¬å¼€å§‹äº‹åŠ¡ï¼Œç»“æŸäº‹åŠ¡ç­‰äº‹ä»¶ï¼Œå¦‚æœä½ ä½¿ç”¨Springï¼ŒJFinalæ¡†æ¶ï¼Œæ— éœ€æ‹…å¿ƒäº‹åŠ¡ï¼Œå·²ç»é›†æˆå¥½äº†ï¼Œå¦‚æœä½ æ²¡æœ‰è¿™äº›æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥ç”¨Beetlsq</p>
<p>æä¾›çš„DSTransactionManager æ¥æŒ‡å®šäº‹åŠ¡è¾¹ç•Œï¼Œæ˜¯äº‹å®ï¼ŒSpringçš„äº‹åŠ¡é›†æˆä¹Ÿä½¿ç”¨äº†DSTransactionManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQLManager 	sql = <span class="keyword">new</span> SQLManager(style,loader,cs,<span class="keyword">new</span> UnderlinedNameConversion(), inters);</div><div class="line">.......</div><div class="line">DSTransactionManager.start();</div><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">sql.insert(user);</div><div class="line">sql.insert(user);</div><div class="line">DSTransactionManager.commit();</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„:ConnectionSourceHelper.getSimple() è·å¾—çš„æ˜¯ä¸€ä¸ªç®€å•çš„csï¼Œæ²¡æœ‰äº‹åŠ¡ç®¡ç†å™¨å‚ä¸ï¼Œå»ºè®®ä½ ç”¨</p>
<p>getSingle(DataSource ds),è¿”å›DefaultConnectionSourceå…·å¤‡äº‹åŠ¡ç®¡ç†ã€‚</p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2017-04-19T12:55:38.000Z" itemprop="dateUpdated">2017-04-19 20:55:38</time>
</span><br>


        
        è¿™é‡Œå¯ä»¥å†™ä½œè€…ç•™è¨€ï¼Œæ ‡ç­¾å’Œ hexo ä¸­æ‰€æœ‰å˜é‡åŠè¾…åŠ©å‡½æ•°ç­‰å‡å¯è°ƒç”¨ï¼Œç¤ºä¾‹ï¼š<a href="/2017/04/19/beetlsql/" target="_blank" rel="external">http://yoursite.com/2017/04/19/beetlsql/</a>
        
    </div>
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="å¼ ç‘å®‡">
            å¼ ç‘å®‡
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">èµ</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql/">sql</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2017/04/19/beetlsql/&title=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&pic=http://yoursite.com/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2017/04/19/beetlsql/&title=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&source=æ·±äº•å®‡çš„..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2017/04/19/beetlsql/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&url=http://yoursite.com/2017/04/19/beetlsql/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2017/04/19/beetlsql/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/04/19/beetlsql 2/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">My New Post</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/04/19/androidè™šçº¿/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">androidè™šçº¿</h4>
      </a>
    </div>
  
</nav>



    

<div class="comments" id="comments">
    <div class="ds-thread" data-thread-key="beetlsql" data-title="My New Post" data-url="http://yoursite.com/2017/04/19/beetlsql/"></div>
</div>
<script>
lazyScripts.push('//cdn.bootcss.com/marked/0.3.6/marked.min.js');

var duoshuoQuery = {short_name:'ysblog', theme: 'none'};
lazyScripts.push('//unpkg.com/hexo-theme-material-indigo@latest/js/embed.min.js');


</script>










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        è°¢è°¢å¤§çˆ·~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechat.jpg" title="å¾®ä¿¡æ‰“èµäºŒç»´ç " alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <p>å¾®ä¿¡</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.jpg" title="æ”¯ä»˜å®æ‰“èµäºŒç»´ç " alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
            <p>æ”¯ä»˜å®</p>
        </li>
        
    </ul>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>åšå®¢å†…å®¹éµå¾ª<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>å¼ ç‘å®‡ &copy; 2015 - 2017</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2017/04/19/beetlsql/&title=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&pic=http://yoursite.com/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2017/04/19/beetlsql/&title=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&source=æ·±äº•å®‡çš„..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2017/04/19/beetlsql/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMy New Postã€‹ â€” å¼ å¤§å¤´çš„åšå®¢&url=http://yoursite.com/2017/04/19/beetlsql/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2017/04/19/beetlsql/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://yoursite.com/2017/04/19/beetlsql/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'æ­»é¬¼å»å“ªé‡Œäº†ï¼';
            clearTimeout(titleTime);
        } else {
            document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
